<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Changelog &mdash; OSS AtlasDB develop documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/release-notes.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Release Process" href="release-process.html" />
    <link rel="prev" title="Releases" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> OSS AtlasDB
          </a>
              <div class="version">
                develop
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schemas/index.html">Schemas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transactions/index.html">Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster_management/index.html">Cluster Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miscellaneous/index.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Releases</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Changelog</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="release-process.html">Release Process</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OSS AtlasDB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Releases</a> &raquo;</li>
      <li>Changelog</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/palantir/atlasdb/blob/develop/docs/source/release_notes/release-notes.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="changelog">
<span id="change-log"></span><h1>Changelog<a class="headerlink" href="#changelog" title="Permalink to this headline"></a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For versions of AtlasDB above v0.151.1, please refer to GitHub’s
<a class="reference external" href="https://github.com/palantir/atlasdb/releases">releases page</a> for release notes. This page is kept around as a
document of changes up to v0.151.1 inclusive.</p>
</div>
<section id="v0-151-1">
<h2>v0.151.1<a class="headerlink" href="#v0-151-1" title="Permalink to this headline"></a></h2>
<p>2 Jul 2019</p>
<p>Identical to v0.151.0. This version was released owing to deployment infrastructure issues with v0.151.0.</p>
</section>
<section id="v0-151-0">
<h2>v0.151.0<a class="headerlink" href="#v0-151-0" title="Permalink to this headline"></a></h2>
<p>28 Jun 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Upgraded gradle-baseline to improve compile time static analysis checks.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3974">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">KeyValueService</span></code> implementations now have a new endpoint <code class="docutils literal notranslate"><span class="pre">deleteRows()</span></code> that allows row-level deletes to be performed.
Users who extend <code class="docutils literal notranslate"><span class="pre">KeyValueService</span></code> will need to implement this method, but can refer to <code class="docutils literal notranslate"><span class="pre">AbstractKeyValueService</span></code> for a functional implementation (as this method can be written in terms of <code class="docutils literal notranslate"><span class="pre">deleteRange()</span></code>).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4094">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Targeted Sweep now supports reading write information and dedicated row information from multiple partitions at a time; the same overall sweep batch limit is still respected.
This is expected to be particularly relevant at installations where write information is sparsely distributed over many partitions (e.g. transactions2 deployments, especially such deployments with thorough tables).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4097">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-150-0">
<h2>v0.150.0<a class="headerlink" href="#v0-150-0" title="Permalink to this headline"></a></h2>
<p>20 Jun 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><span class="changetype changetype-new">NEW</span></p></th>
<th class="head"><p>Added ability for timelock to rate limit targeted sweep lock requests to 2 per second. This is to reduce load on timelock for bad atlas clients.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4096">Pull Request</a>)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Relaxed concurrency model of <code class="docutils literal notranslate"><span class="pre">MetricsManager</span></code> allowing for more concurrency.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4098">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-149-0">
<h2>v0.149.0<a class="headerlink" href="#v0-149-0" title="Permalink to this headline"></a></h2>
<p>11 Jun 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Added runtime configurable behavior to targeted sweep to allow multiple consecutive iterations on the same targeted sweep shard, all while holding the relevant lock. This option
should improve targeted sweep throughput without adding additional load on Timelock for places where the downtime between targeted sweep iterations is a bottleneck.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4086">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-148-0">
<h2>v0.148.0<a class="headerlink" href="#v0-148-0" title="Permalink to this headline"></a></h2>
<p>11 Jun 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The default value for the length of pause between targeted sweep iterations, <code class="docutils literal notranslate"><span class="pre">pauseMillis</span></code>, has been changed back to 500ms.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4084">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-147-0">
<h2>v0.147.0<a class="headerlink" href="#v0-147-0" title="Permalink to this headline"></a></h2>
<p>10 Jun 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Cassandra clients are now required to supply credentials in the KVS config.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4076">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-146-0">
<h2>v0.146.0<a class="headerlink" href="#v0-146-0" title="Permalink to this headline"></a></h2>
<p>7 Jun 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Async initialization callbacks are run with an instrumented TransactionManager.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4081">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>If using DbKVS or JDBC KVS, we no longer spin up a background thread attempting to install new transaction schema versions.
Furthermore, we now log at WARN if configuration indicates that a new schema version should be installed in these cases where it won’t be respected.
Previously, we would always read to and write from transactions1, even though the installer might actually have installed a non-1 schema version (and logged that this happened!).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4070">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-145-0">
<h2>v0.145.0<a class="headerlink" href="#v0-145-0" title="Permalink to this headline"></a></h2>
<p>4 Jun 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug causing connection leaks to timelock.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4052">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The default value for the length of pause between targeted sweep iterations, <code class="docutils literal notranslate"><span class="pre">pauseMillis</span></code>, has been reduced to 50ms.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4067">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Changed the default values in <code class="docutils literal notranslate"><span class="pre">PaxosRuntimeConfiguration</span></code> as (<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3943">#3943</a>) changed it on test configs only.
<code class="docutils literal notranslate"><span class="pre">leader-ping-response-wait-in-ms</span></code> was reduced to 2000 ms from 5000 ms.
<code class="docutils literal notranslate"><span class="pre">maximum-wait-before-proposal-in-ms</span></code> was reduced to 300 ms from 1000 ms.
<code class="docutils literal notranslate"><span class="pre">ping-rate-in-ms</span></code> was reduced to 50 ms from 5000 ms.
These settings have empirically improved the performance of timelock when the leader node goes down without negatively affecting stability.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4055">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Clients now log at most once every 10 seconds when a <code class="docutils literal notranslate"><span class="pre">TimelockService</span></code> level request is slow.
Please see the JavaDocs of <code class="docutils literal notranslate"><span class="pre">ProfilingTimelockService</span></code> for more information.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4QQQ">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-144-0">
<h2>v0.144.0<a class="headerlink" href="#v0-144-0" title="Permalink to this headline"></a></h2>
<p>20 May 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">AutoDelegate</span></code> only works on interfaces now.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4045">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug in <code class="docutils literal notranslate"><span class="pre">TransactionManagers</span></code> introduced by a recently added caching layer, causing NPE’s.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4044">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The pause time between iterations of targeted sweep for each background thread is now configurable by the targeted sweep runtime configuration <code class="docutils literal notranslate"><span class="pre">pauseMillis</span></code>.
The default value has also changed from 5000 milliseconds to 500.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4046">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-143-1">
<h2>v0.143.1<a class="headerlink" href="#v0-143-1" title="Permalink to this headline"></a></h2>
<p>16 May 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">InsufficientConsistencyException</span></code> and <code class="docutils literal notranslate"><span class="pre">NoSuchElementException</span></code> will now not cause nodes to be blacklisted from the Cassandra client pool.
Previously this could happen - even though these exceptions are not reflective of the individual node in question being unable to service requests.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4038">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Removed the DB username from the Hikari connection pool name.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3949">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed incorrect delegation that took place in AutoDelegate transaction managers.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4041">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-143-0">
<h2>v0.143.0<a class="headerlink" href="#v0-143-0" title="Permalink to this headline"></a></h2>
<p>16 May 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-deprecated">DEPRECATED</span></p></td>
<td><p>Replaced all usages of Guava Supplier by Java Supplier. Please note that while Guava Supplier endpoints may still exist, they will be removed in a future release.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3978">Pull Request 1</a>,
<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3995">Pull Request 2</a> and
<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4034">Pull Request 3</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Coordination service metrics no longer throw <code class="docutils literal notranslate"><span class="pre">NullPointerException</span></code> when attempting to read the metric value before reading anything from the coordination store.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4031">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB now maintains a finite length for the delete executor’s work queue, to avoid OOMs on services with high conflict rates for transactions.
In the event the queue length is reached, we will not proactively schedule cleanup of values written by a transaction that was rolled back.
Note that it is not essential that these deletes are carried out immediately, as targeted sweep will eventually clear them out.
Previously, this queue was unbounded, meaning that service nodes could end up using lots of memory.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/4037">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The coordination store now retries when reading a value at a given sequence number that no longer exists (as opposed to throwing).
This is necessary for supporting cleanup of the coordination store.
Note that if one is performing rolling upgrades to a version that sweeps the coordination store, one MUST upgrade from at least this version.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3990">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-142-2">
<h2>v0.142.2<a class="headerlink" href="#v0-142-2" title="Permalink to this headline"></a></h2>
<p>14 May 2019</p>
<p>This version is equivalent to v0.142.0, but was re-tagged because of publishing issues.</p>
</section>
<section id="v0-142-1">
<h2>v0.142.1<a class="headerlink" href="#v0-142-1" title="Permalink to this headline"></a></h2>
<p>14 May 2019</p>
<p>This version is equivalent to v0.142.0, but was re-tagged because of publishing issues.</p>
</section>
<section id="v0-142-0">
<h2>v0.142.0<a class="headerlink" href="#v0-142-0" title="Permalink to this headline"></a></h2>
<p>14 May 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The default configuration for the number of targeted sweep shards has been increased to 8.
This enables us to increase the speed of targeted sweep if processing the queue starts falling behind.
Previously, we could only increase the speed of processing future entries, as we cannot sweep entries with higher parallelism than the number of shards active when the writes were made.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3997">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB now throws an <code class="docutils literal notranslate"><span class="pre">IllegalArgumentException</span></code> when attempting to create a column range selection that is invalid (has end before start).
Previously, exceptions were thrown from the underlying KVS, but these were implementation-dependent.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3993">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">AtlasDbHttpClients.createProxyWithFailover()</span></code> now requires <code class="docutils literal notranslate"><span class="pre">UserAgent</span></code> parameter.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3996">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-141-0">
<h2>v0.141.0<a class="headerlink" href="#v0-141-0" title="Permalink to this headline"></a></h2>
<p>9 May 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TransactionManagers</span></code> now has a new builder option <code class="docutils literal notranslate"><span class="pre">lockImmutableTsOnReadOnlyTransactions()</span></code>.
If it is set to <code class="docutils literal notranslate"><span class="pre">true</span></code> all transactions (including read-only ones) will grab immutable ts lock, enabling migrating to thorough sweep without downtime.
Please contact the AtlasDB team before using this feature.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3987">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The Timelock Availability Health check should not timeout if we can’t reach other nodes. This should stop
the health check firing erroneously.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3988">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Setting <code class="docutils literal notranslate"><span class="pre">lockImmutableTsOnReadOnlyTransactions()</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> disables background sweep. This aims to prevent Cassandra load caused by Conservative to Thorough sweep migration.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3992">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-140-0">
<h2>v0.140.0<a class="headerlink" href="#v0-140-0" title="Permalink to this headline"></a></h2>
<p>8 May 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-metrics">METRICS</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Client side tombstone filtering is now instrumented more exhaustively.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3977">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TimelockDeprecatedConfig</span></code> and <code class="docutils literal notranslate"><span class="pre">TimeLockServerConfiguration</span></code> have been removed.
Note that these configurations were only used for the dropwizard timelock server, which should only be used in tests.
Now, the dropwizard server launcher uses a similar setup to the use in production, forcing the use of client request limits and lock time limiter.
Note that this requires converting your existing <code class="docutils literal notranslate"><span class="pre">TimeLockServerConfiguration</span></code> to a <code class="docutils literal notranslate"><span class="pre">CombinedTimeLockServerConfiguration</span></code>.
For an example of this conversion, refer to the PR below.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3971">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Changed the default values in <code class="docutils literal notranslate"><span class="pre">PaxosConfiguration</span></code>.
<code class="docutils literal notranslate"><span class="pre">leader-ping-response-wait-in-ms</span></code> was reduced to 2000 ms from 5000 ms.
<code class="docutils literal notranslate"><span class="pre">maximum-wait-before-proposal-in-ms</span></code> was reduced to 300 ms from 1000 ms.
<code class="docutils literal notranslate"><span class="pre">ping-rate-in-ms</span></code> was reduced to 50 ms from 5000 ms.
These settings have empirically improved the performance of timelock when the leader node goes down without negatively affecting stability.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3943">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-139-0">
<h2>v0.139.0<a class="headerlink" href="#v0-139-0" title="Permalink to this headline"></a></h2>
<p>30 Apr 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-metrics">METRICS</span> <span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>All instrumentation AtlasDB metrics now use a <code class="docutils literal notranslate"><span class="pre">SlidingTimeWindowArrayReservoir</span></code>.
Previously, they used an exponentially decaying reservoir.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3937">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-138-0">
<h2>v0.138.0<a class="headerlink" href="#v0-138-0" title="Permalink to this headline"></a></h2>
<p>25 Apr 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>AtlasDB Cassandra KVS now depends on rescue 4.4.0 (was previously 3.22.0).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3954">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-137-0">
<h2>v0.137.0<a class="headerlink" href="#v0-137-0" title="Permalink to this headline"></a></h2>
<p>25 Apr 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Coordination service now checks for semantic equality of <code class="docutils literal notranslate"><span class="pre">VersionedInternalSchemaMetadata</span></code> payloads as opposed to byte equality when deciding whether to reuse an existing value agreed on.
Previously, using byte equality meant that multi-node clusters could end up spuriously writing the stored value many times, causing unnecessarily wide rows.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3954">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-136-1">
<h2>v0.136.1<a class="headerlink" href="#v0-136-1" title="Permalink to this headline"></a></h2>
<p>23 Apr 2019</p>
<p>This release is equivalent to v0.136.0 but was re-tagged due to a publishing issue.</p>
</section>
<section id="v0-136-0">
<h2>v0.136.0<a class="headerlink" href="#v0-136-0" title="Permalink to this headline"></a></h2>
<p>23 Apr 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Usage metrics for the coordination store have been added.
Users should provide a MetricsRegistry when creating their coordination services.
Also, <code class="docutils literal notranslate"><span class="pre">CoordinationService.createDefault()</span></code> now handles instrumentation of both the coordination service and store.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3894">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>lock-api now declares a minimum dependency on timelock-server 0.59.0.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3894">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-135-0">
<h2>v0.135.0<a class="headerlink" href="#v0-135-0" title="Permalink to this headline"></a></h2>
<p>19 Apr 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Coordination service now only initiates one request to perpetuate the bound forward at a time.
This should avoid unnecessarily many CAS operations taking place when we need to do this.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3953">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-134-0">
<h2>v0.134.0<a class="headerlink" href="#v0-134-0" title="Permalink to this headline"></a></h2>
<p>18 Apr 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>We now close Cassandra clients properly when verifying that one’s Cassandra configuration makes sense.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3944">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-133-0">
<h2>v0.133.0<a class="headerlink" href="#v0-133-0" title="Permalink to this headline"></a></h2>
<p>16 Apr 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB now logs diagnostic information about usage of classes that utilise smart batching (e.g. when starting transactions, verifying leadership, _transactions2 put-unless-exists, etc.).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3924">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-132-0">
<h2>v0.132.0<a class="headerlink" href="#v0-132-0" title="Permalink to this headline"></a></h2>
<p>11 Apr 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Stop memoizing the <code class="docutils literal notranslate"><span class="pre">Supplier</span></code> of <code class="docutils literal notranslate"><span class="pre">TimestampService</span></code>, as we <strong>must</strong> get a fresh instance on each <code class="docutils literal notranslate"><span class="pre">Supplier.get()</span></code> call to ensure correctness after leadership elections.
Without it, there is a possibility of data corruption if you are running atlas with a leader block in a multi-node configuration.
Services using External Timelock, Embedded or Leader with 1 node will not be affected.
Dev break to force <code class="docutils literal notranslate"><span class="pre">AtlasDbFactory</span></code> and <code class="docutils literal notranslate"><span class="pre">ServiceDiscoveringAtlasSupplier</span></code> to return <code class="docutils literal notranslate"><span class="pre">ManagedTimestampService</span></code> which unifies <code class="docutils literal notranslate"><span class="pre">TimestampService</span></code> and <code class="docutils literal notranslate"><span class="pre">TimestampManagementService</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3911">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Removed unnecessary memory allocations in the lock refresher, and in several other classes, by using Lists.partition(…) instead of Iterables.partition(…).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3918">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-131-0">
<h2>v0.131.0<a class="headerlink" href="#v0-131-0" title="Permalink to this headline"></a></h2>
<p>9 Apr 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Cassandra client input and output transports are now properly closed.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3892">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-130-0">
<h2>v0.130.0<a class="headerlink" href="#v0-130-0" title="Permalink to this headline"></a></h2>
<p>4 Apr 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now supports _transactions2 if backed by Cassandra KVS or In-Memory KVS.
This is expected to improve transaction performance by making <code class="docutils literal notranslate"><span class="pre">putUnlessExists</span></code> faster, and increase stability by avoiding hotspotting of the transactions table in Cassandra.
This is a beta feature; please contact the AtlasDB team if you are interested to use _transactions2.
(Many PRs; key PRs include <a class="reference external" href="https://github.com/palantir/atlasdb/pull/3706">Pull Request 1</a>,
<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3707">Pull Request 2</a>,
<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3726">Pull Request 3</a>,
<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3732">Pull Request 4</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">putUnlessExists</span></code> in Cassandra KVS now produces correct cell names when failing with a <code class="docutils literal notranslate"><span class="pre">KeyAlreadyExistsException</span></code>.
Previously, Cassandra KVS used to produce incorrect cell names (that were the concatenation of the correct cell name and an encoding of the AtlasDB timestamp).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3882">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>A new configuration option <code class="docutils literal notranslate"><span class="pre">lockImmutableTsOnReadOnlyTransactions</span></code> is added under <code class="docutils literal notranslate"><span class="pre">atlas-runtime.transaction</span></code>. Default value for this flag is <code class="docutils literal notranslate"><span class="pre">false</span></code>, and setting it to <code class="docutils literal notranslate"><span class="pre">true</span></code>
enables running read-only transactions on thorough sweep tables; but introduces a perf overhead to read-only transactions on conservative sweep tables. This is an experimental feature,
please do not change the default value for this flag without talking to AtlasDB team.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3888">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">WriteBatchingTransactionService</span></code> now tries requests for duplicated timestamps in subsequent batches.
Previously, we would immediately throw a <code class="docutils literal notranslate"><span class="pre">SafeIllegalStateException</span></code> when seeing a duplicate in a single batch, which was causing unnecessary failures in transactions which could handle the <code class="docutils literal notranslate"><span class="pre">KeyAlreadyExistsException</span></code> safely.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3879">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a rare situation in which interrupting a thread could possibly leave dangling locks.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3805">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Coordination services now only perpetuate an existing value on value-preserving transformations if the existing bound is invalid at a fresh sequence number.
Previously, we would perpetuate the bound regardless, meaning that when the bound is crossed in a multi-threaded environment, each in-flight transaction that tries to determine its transaction schema version will independently attempt to perpetuate the bound.
This may lead to multiple unnecessary updates to the coordinated value in a short space of time.
Note that updates that do change the value will be applied regardless, and could potentially still race if applied in parallel.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3889">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LockRefresher</span></code> now logs at INFO when locks cannot be refreshed in that the server does not indicate that they were refreshed, along with a sample of the lock tokens involved.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3866">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Reduced dependency footprint by replacing dependency on groovy-all with dependencies on groovy, groovy-groovysh, and groovy-json.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3886">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-129-0">
<h2>v0.129.0<a class="headerlink" href="#v0-129-0" title="Permalink to this headline"></a></h2>
<p>28 Mar 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Oracle KVS now deletes old entries correctly if using targeted sweep.
Previously, there were situations where it would not delete values that could safely be deleted.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3870">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The Cassandra KVS <code class="docutils literal notranslate"><span class="pre">CellLoader</span></code> now supports cross-column batching for requests which query a variety of columns for a few rows.
Previously, we would make separate requests for each of these columns in parallel, creating additional load on Cassandra.
Internal benchmarks reflect a 4-5x improvement in read p99s for such workflows (e.g. small numbers of rows with static columns, or rows with dynamic columns when the column key is varied and known in advance).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3860">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Concurrent calls to <cite>TimelockService.startIdentifiedAtlasDbTransaction()</cite> now coalesced into a single Timelock rpc to reduce load on Timelock.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3844">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><cite>RemoteTimelockServiceAdapter</cite> is now closeable. Users of this class should invoke <cite>close()</cite> before termination to avoid thread leaks.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3844">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span> <span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB Cassandra KVS now depends on sls-cassandra 3.31.0 (was 3.31.0-rc3).
We do not want to stay on an RC version now that a full release is available.
Note that this means that you must use this version of the sls-cassandra server if you want to use Cassandra KVS.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3872">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-128-0">
<h2>v0.128.0<a class="headerlink" href="#v0-128-0" title="Permalink to this headline"></a></h2>
<p>27 Mar 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>AtlasDB Cassandra KVS now depends on sls-cassandra 3.31.0-rc3 (was 3.27.0).
This version of Cassandra KVS supports a <code class="docutils literal notranslate"><span class="pre">multiget_multislice</span></code> operation which retrieves different columns across different rows in a single query.
Note that this means that you must use this version of the sls-cassandra server if you want to use Cassandra KVS.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3849">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Callbacks specified in TransactionManagers will no longer be run synchronously when <code class="docutils literal notranslate"><span class="pre">initializeAsync</span></code> is set to true, even if initialization succeeds in the first, synchronous attempt.
Previously, we would attempt to run the callbacks synchronously when synchronous initialization succeeds, but this prevented use cases where the callback must block until an external resource is available.
Consequently, even if the initialization of a transaction manager created with asynchronous initialization succeeds synchronously, readiness of the returned object must be checked because transaction managers are not ready to be used until callbacks successfully run.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3865">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Postgres 9.5.2+ requirement temporarily rescinded.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3862">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Added extra debug/trace logging to log the state of the Cassandra pool / application when running into cassandra pool exhaustion errors.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3863">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-127-0">
<h2>v0.127.0<a class="headerlink" href="#v0-127-0" title="Permalink to this headline"></a></h2>
<p>25 Mar 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue where the <code class="docutils literal notranslate"><span class="pre">transformAgreedValue</span></code> of the <code class="docutils literal notranslate"><span class="pre">KeyValueServiceCoordinationStore</span></code> would throw an NPE when check and set fails on KVSs that do not support detail on CAS failure (DbKvs).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3848">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>Background Sweep will now continue to prioritise tables accordingly, if writes to the sweep queue are enabled but targeted sweep is disabled on startup.
Previously, Background Sweep would not prioritise new writes for sweeping if writes to the sweep queue were enabled.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3824">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>We’ve rolled back the change from 0.117.0 that introduces an extra delay after leader election as we are no longer pursuing leadership leases.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3836">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><cite>AtlasDbHttpClients</cite>, <cite>FeignOkHttpClients</cite> and <cite>AtlasDbFeignTargetFactory</cite> are refactored to get rid of deprecated methods and overused overloads.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3837">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-126-0">
<h2>v0.126.0<a class="headerlink" href="#v0-126-0" title="Permalink to this headline"></a></h2>
<p>18 Mar 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span> <span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>Removed functionality for marking tables as deprecated as part of the schema definition and automatically dropping deprecated tables on startup.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3829">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Improved the startup check that verifies the correctness of the timestamp source to impose tighter constraints. Now uses a recent value from the puncher store
rather than the unreadable timestamp.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3825">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">KeyValueService</span></code> and <code class="docutils literal notranslate"><span class="pre">CassandraKeyValueService</span></code> in particular now has tighter consistency guarantees in the presence of failures.
Previously, inconsistent deletes to thoroughly swept tables could result in readers serving stale versions of cells.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3807">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>The contract of <code class="docutils literal notranslate"><span class="pre">deleteAllTimestamps</span></code> has been strengthened, and the default implementation has been removed.
Please contact the AtlasDB team if you think this affects your workflows.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3807">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug in <code class="docutils literal notranslate"><span class="pre">PaxosQuorumChecker</span></code> causing a new timelock leader to block for 5 seconds before being able to serve requests if another node was unreachable.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3811">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-125-0">
<h2>v0.125.0<a class="headerlink" href="#v0-125-0" title="Permalink to this headline"></a></h2>
<p>07 Mar 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">CassandraKeyValueService</span></code> now exposes a lightweight method for obtaining row keys.
If you believe you need to use this method, you should reach out to the AtlasDB team first to assess your options.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3757">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-changed">CHANGED</span> <span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>The minimum Postgres version is now 9.5.2
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3786">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Some race conditions in <code class="docutils literal notranslate"><span class="pre">TableRemappingKeyValueService</span></code> and <code class="docutils literal notranslate"><span class="pre">KvTableMappingService</span></code> have been fixed.
Previously, it was possible to run into unexpected instances of <code class="docutils literal notranslate"><span class="pre">NullPointerException</span></code> and <code class="docutils literal notranslate"><span class="pre">IllegalStateException</span></code> when reading from tables, even when other (completely disjoint) sets of tables were created or dropped.
It is likely that there remain more bugs here, though we have fixed several more egregious ones.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3803">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-122-0">
<h2>v0.122.0<a class="headerlink" href="#v0-122-0" title="Permalink to this headline"></a></h2>
<p>22 Feb 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Clients talking to Timelock will now throw instead of making a request with a payload larger than 50MB.
This addresses several internal issues concerning Timelock stability.
This is a devbreak in several AtlasDB utility classes used to create clients, where an additional boolean parameter has been added controlling whether its requests should be limited.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3772">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Timelock clients now use leased lock tokens to reduce number of RPC’s to Timelock server, and improve transaction performance.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3760">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><cite>startIdentifiedAtlasDbTransaction()</cite> and <cite>lockImmutableTimestamp()</cite> now being called without an <cite>IdentifiedTimeLockRequest</cite> parameter.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3769">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-121-0">
<h2>v0.121.0<a class="headerlink" href="#v0-121-0" title="Permalink to this headline"></a></h2>
<p>21 Feb 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>We now use jetty-alpn-agent 2.0.9
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3763">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>All usage of remoting-api and remoting3 have been replaced by their equivalents in <cite>com.palantir.tracing</cite>, <cite>com.palantir.conjure.java.api</cite>, and <cite>com.palantir.conjure.java.runtime</cite>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3764">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-120-0">
<h2>v0.120.0<a class="headerlink" href="#v0-120-0" title="Permalink to this headline"></a></h2>
<p>19 Feb 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>The deprecated <cite>startAtlasDbTransaction()</cite> method is removed from <cite>TimelockService</cite>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3758">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><cite>startIdentifiedAtlasDbTransaction</cite> now accepts <cite>IdentifiedTimeLockRequest</cite> as a parameter rather than <cite>StartIdentifiedAtlasDbTransactionRequest</cite>. Moving the requestorId
information to TimelockClient from the caller.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3758">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">FailoverFeignTarget</span></code> now retries correctly if calls to individual nodes take a long time and eventually fail with an exception.
Previously, we could fail out without having tried all nodes under certain circumstances, even when there existed a node that could legitimately service a request.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3752">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed cases where column range scans could result in NullPointerExceptions when there were concurrent writes to the same range.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3756">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-119-0">
<h2>v0.119.0<a class="headerlink" href="#v0-119-0" title="Permalink to this headline"></a></h2>
<p>13 Feb 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>TimeLock will now no longer create its high level paxos directory at configuration de-serialization time.
Instead it waits until creating each individual learner or acceptor log directory, allowing timelock to rely more accurately on directory existence as a proxy for said timelock node being new or not.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3745">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-118-0">
<h2>v0.118.0<a class="headerlink" href="#v0-118-0" title="Permalink to this headline"></a></h2>
<p>8 Feb 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>AtlasDB Cassandra KVS now depends on <code class="docutils literal notranslate"><span class="pre">com.palantir.cassandra</span></code> instead of <code class="docutils literal notranslate"><span class="pre">org.apache.cassandra</span></code>.
This version of Cassandra thrift client supports a <code class="docutils literal notranslate"><span class="pre">put_unless_exists</span></code> operation that can update multiple columns in the same row simultaneously.
The Cassandra KVS putUnlessExists method has been updated to use the above call.
Note that this means that you must use sls-cassandra server 3.27.0 if you want to use Cassandra KVS.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3726">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The <cite>TableMetadata</cite> class has been refactored to use Immutables.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3624">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Transaction services now expose timer metrics indicating how long committing or getting values takes.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3733">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Entries with the same value in adjacent ranges in a timestamp partitioning map will now be properly coalesced, and for the purposes of coordination will not be written as new values.
Previously, these were stored as separate entries, meaning that unnecessary values may have been written to the coordination store; this does not affect correctness, but is unperformant.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3733">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB now allows you to enable a new transaction retry strategy with exponential backoff via configs.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3749">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-117-0">
<h2>v0.117.0<a class="headerlink" href="#v0-117-0" title="Permalink to this headline"></a></h2>
<p>28 Jan 2019</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Timelock service no longer supports synchronous lock endpoints. Users who explicitly stated timelock to use synchronous resources by setting <cite>install.asyncLock.useAsyncLockService</cite> to <cite>false</cite> (default is <cite>true</cite>) should migrate to <cite>AsyncLockService</cite> before taking this upgrade.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3718">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Key value services now require their <code class="docutils literal notranslate"><span class="pre">CheckAndSetCompatibility</span></code> to be specified.
Refer to the contract of <code class="docutils literal notranslate"><span class="pre">KeyValueService#getCheckAndSetCompatibility</span></code> and the <code class="docutils literal notranslate"><span class="pre">CheckAndSetCompatibility</span></code> enum class to guide this decision.
Please be very careful if you are explicitly setting this to <code class="docutils literal notranslate"><span class="pre">CheckAndSetCompatibility.SUPPORTED_DETAIL_ON_FAILURE</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3713">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB now has an extra delay after leader elections; this lays the groundwork for leadership leases.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3701">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>We now correctly handle host restart in the clock skew monitor.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3716">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-116-1">
<h2>v0.116.1<a class="headerlink" href="#v0-116-1" title="Permalink to this headline"></a></h2>
<p>20 Dec 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The completion service in the Paxos leader election service should be more resilient to individual nodes being slow.
Previously, if one individual node had a full thread pool, the service would throw a <code class="docutils literal notranslate"><span class="pre">RejectedExecutionException</span></code> even if other nodes were able to service the request.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3687">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-116-0">
<h2>v0.116.0<a class="headerlink" href="#v0-116-0" title="Permalink to this headline"></a></h2>
<p>14 Dec 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now writes to the _coordination table, a new table which is used to coordinate changes to schema metadata internal to AtlasDB across a multi-node cluster.
Services which want to adopt _transactions2 will need to go through this version, to ensure that nodes are able to reach a consensus on when to switch the transaction schema version forwards.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3686">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB transaction services no longer throw exceptions when performing Thorough Sweep on tables with sentinels.
Previously, the services would throw when trying to delete the sentinel, meaning that Background and Targeted Sweep would become stuck if sweeping thorough tables that used to be conservative, or tables that had undergone hard delete via the scrubber.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3704">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>AtlasDB transaction services now no longer support negative timestamps.
Users are unlikely to be affected, since using transaction services with negative timestamps was already broken in the past owing to the use of negative numbers for special values (like sentinels or a marker meaning that a transaction was rolled back).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3709">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>With the introduction of _coordination, creation of <code class="docutils literal notranslate"><span class="pre">TransactionService</span></code> now requires a <code class="docutils literal notranslate"><span class="pre">CoordinationService&lt;InternalSchemaMetadata&gt;</span></code>.
Users may create a <code class="docutils literal notranslate"><span class="pre">CoordinationService</span></code> via the <code class="docutils literal notranslate"><span class="pre">CoordinationServices</span></code> factory, if needed, or retrieve it from the relevant <code class="docutils literal notranslate"><span class="pre">TransactionManager</span></code>.
Generally speaking, <code class="docutils literal notranslate"><span class="pre">TransactionService</span></code> should not be directly used by standard AtlasDB consumers; abusing it can result in <strong>SEVERE DATA CORRUPTION</strong>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3686">Pull Request 1</a> and <a class="reference external" href="https://github.com/palantir/atlasdb/pull/3689">Pull Request 2</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Transaction Managers now expose a <code class="docutils literal notranslate"><span class="pre">getTransactionService()</span></code> method.
Users with custom subclasses of <code class="docutils literal notranslate"><span class="pre">TransactionManager</span></code> will need to implement this.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3689">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>With the introduction of _coordination, we expose new metrics indicating the point (in logical timestamps) till which the coordination service knows what has been agreed, as well as the transactions schema version that will eventually be applied.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3691">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>Cassandra KVS <cite>getMetadataForTables</cite> method now returns a map where table reference keys have capitalisation matching the table names in Cassandra.
Previously there was no strict guarantee on the keys’ capitalisation, but it was in most cases all lowercase.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3649">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Cassandra KVS <cite>getMetadataForTables</cite> method now does not contain entries for tables that do not exist in Cassandra.
Previously, when a table was dropped, an empty byte array would be written into the _metadata table to mark it as deleted.
Now, we delete all rows of the _metadata table containing entries pertaining to the dropped table.
Note that this involves a range scan over a part of the _metadata table.
While it is not expected that this significantly affects performance of table dropping, please contact the AtlasDB team if this causes issues.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3649">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-115-0">
<h2>v0.115.0<a class="headerlink" href="#v0-115-0" title="Permalink to this headline"></a></h2>
<p>07 Dec 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Cassandra KVS now correctly decommissions servers from the client pool that do not appear in the current token range if autoRefreshNodes is set to true (default value).
Previously, refresh would only add discovered new servers, but never remove decommissioned hosts.
The new behaviour enables live decommissioning of Cassandra nodes, without having to update the configuration and restart of AtlasDB to stop trying to talk to that server.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3661">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The &#64;AutoDelegate annotation now works correctly for interfaces which have static methods, and for simple cases of generics.
Previously, the annotation processor would generate code that wouldn’t compile.
Note that some cases (e.g. sub-interfaces of generics that refine type parameters) are still not supported correctly.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3670">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>TimeLock Server now logs that a new client has been registered the first time a service makes a request (for each lifetime of each server).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3676">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Adds com.palantir.common.collect.IterableView#stream method for simplified conversion to Java Stream API usage.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3703">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-114-0">
<h2>v0.114.0<a class="headerlink" href="#v0-114-0" title="Permalink to this headline"></a></h2>
<p>03 Dec 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>As part of preparatory work to migrate to a new transactions table, this version of AtlasDB and all versions going forward expect to be using a version of TimeLock that supports the <code class="docutils literal notranslate"><span class="pre">startIdentifiedAtlasDbTransaction</span></code> endpoint.
Support for previous versions of TimeLock has been dropped; please update your TimeLock server.
Products should depend on TimeLock 0.51.0 or higher, or ignore this dependency altogether if they do not expect to use TimeLock.
Note that new versions of the TimeLock server still expose the old endpoints, so old clients may still safely use a new TimeLock server.
Also note that some momentary issues may be faced if one is performing a rolling upgrade of embedded services, though once the upgrades settle services should work normally.
Note that for or across this version, blue-green deployment of embedded services is not supported.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3597">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-113-0">
<h2>v0.113.0<a class="headerlink" href="#v0-113-0" title="Permalink to this headline"></a></h2>
<p>03 Dec 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>KVS Migration CLI no longer migrates the checkpoint table if it exists on the source KVS.
Previously, existence of an old checkpoint table on the source KVS could cause a migration to silently skip migrating data.
Furthermore, in the cleanup stage of migration, the checkpoint table is now dropped instead of truncated.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3587">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Read transactions on thoroughly swept tables requires one less RPC to timelock now.
This improves the read performance and reduces load on timelock.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3651">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fix warning in stream-store generated code.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3667">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-112-1">
<h2>v0.112.1<a class="headerlink" href="#v0-112-1" title="Permalink to this headline"></a></h2>
<p>26 Nov 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Wrap shutdown callback running in try-catch.
This guards against any shutdown hooks throwing unchecked exceptions,
which would cause other hooks to not run.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3654">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-112-0">
<h2>v0.112.0<a class="headerlink" href="#v0-112-0" title="Permalink to this headline"></a></h2>
<p>26 Nov 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Remove a memory leak due to usages of Runtime#addShutdownHook to cleanup resources.
This only applies where multiple <cite>TransactionManager</cite> s might exist in a single VM
and they are created an shutdown repeatedly.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3653">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-111-0">
<h2>v0.111.0<a class="headerlink" href="#v0-111-0" title="Permalink to this headline"></a></h2>
<p>20 Nov 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug where lock and timestamp services were not closed when transaction managers were closed.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3644">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-110-0">
<h2>v0.110.0<a class="headerlink" href="#v0-110-0" title="Permalink to this headline"></a></h2>
<p>20 Nov 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Numerous small internal improvements that did not include release notes.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-109-0">
<h2>v0.109.0<a class="headerlink" href="#v0-109-0" title="Permalink to this headline"></a></h2>
<p>14 Nov 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>PaxosQuorumChecker now takes an ExecutorService as opposed to an Executor.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3596">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Re-introduced the distinct bounded thread pools to PaxosLeaderElectionService for communication with other PaxosLearners and PingableLeaders.
Previously, a single unbounded thread pool was used, which could cause starvation and OOMs under high load if any learners or leaders in the cluster were slow to fulfil requests.
This change also improves visibility as to which specific communication workflows may be suffering from issues.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3596">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Targeted sweep now handles table truncations with conservative sweeps correctly.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3610">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>No longer calls deprecated OkHttpClient.Builder().sslSocketFactory() method, now passes in X509TrustManager.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3627">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Sha256Hash now caches its Java hashCode method.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3633">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The version of javapoet had previously been bumped to 1.11.1 from 1.9.0. However this was not done consistently across the repository. The atlasdb-client and atlasdb-processors subprojects now also use the newer version.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3631">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-108-0">
<h2>v0.108.0<a class="headerlink" href="#v0-108-0" title="Permalink to this headline"></a></h2>
<p>7 Nov 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Cassandra KVS no longer uses the schema mutation lock and instead creates tables using an id deterministically generated from the Cassandra keyspace and the table name.
As part of this change, table deletion now truncates the table before dropping it in Cassandra, therefore requiring all Cassandra nodes to be available to drop tables.
This fixes a bug where it was possible to create two instances of the same table on two different Cassandra nodes, resulting in schema version inconsistency that required manual intervention.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3620">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Introduced runtime checks on the client side for timestamps retrieved from timelock. This aims to prevent data corruption if timestamps go back in time, possibly caused by a misconducted timelock migration. This is a best effort for catching abnormalities on timestamps at runtime, and does not provide absolute protection.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3568">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>Qos Service: The experimental QosService for rate-limiting clients has been removed.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3586">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug in the <code class="docutils literal notranslate"><span class="pre">AsyncInitializer.cancelInitialization</span></code> method that caused asynchronously initialized <code class="docutils literal notranslate"><span class="pre">CassandraKeyValueServiceImpl</span></code> and <code class="docutils literal notranslate"><span class="pre">CassandraClientPoolImpl</span></code> objects unable to be closed and shut down, respectively.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3578">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Targeted sweep now deletes certain sweep queue rows faster than before, which should
reduce table bloat (particularly on space constrained systems).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3581">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Schema mutations against the Cassandra KVS are now HA.
Previously, Cassandra KVS required that after some schema mutations all cassandra nodes must agree on the schema version.
Now, all reachable nodes must agree and at least a quorum of nodes must be reachable, instead.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3480">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>The AutoDelegate annotation no longer supports a typeToExtend parameter.
Users should instead annotate the desired class or interface directly.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3579">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Targeted sweep does better with missing tables, and also with the empty namespace.
Previously, it would just cycle on the error and never sweep. A highly undesirable condition.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3577">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">KeyValueServicePuncherStore``s</span> <span class="pre">``getMillisForTimestamp</span></code> method now does a much more efficient <code class="docutils literal notranslate"><span class="pre">_punch</span></code> table lookup.
This affects the performance of calculating the <code class="docutils literal notranslate"><span class="pre">millisSinceLastSweptTs</span></code> metric for targeted sweep.
Also, the above mentioned metric will now consistently report falling behind if no new entries are being punhed into the punch table.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3570">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The HikariConnectionClientPool now allows specification of a use-case.
If specified, threads created will have the use-case in their name, and log messages about pool statistics will be prefaced by the use-case as well.
This may be useful for debugging when users run multiple such pools.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3588">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Old deprecated tables can now be added to a schema to be cleaned up on startup.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3569">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug where <code class="docutils literal notranslate"><span class="pre">AwaitingLeadershipProxy</span></code> stops trying to gain leadership, causing client calls to leader to throw <code class="docutils literal notranslate"><span class="pre">NotCurrentLeaderException</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3582">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>TimeLock now exposes a <code class="docutils literal notranslate"><span class="pre">startIdentifiedAtlasDbTransaction</span></code> endpoint.
This may be used by AtlasDB clients for some key value services to achieve better data distribution and performance as far as the transactions table is concerned.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3529">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>The schema metadata service has been removed, as the AtlasDB team does not intend to pursue extracting sweep to its own separate service in the short to medium term, and it was causing support issues.
If you were consuming this service, please contact the AtlasDB team.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3605">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>On Oracle backed DbKvs, schema changes that would require the addition of an overflow column will now throw upon application.
Previously, puts would instead fail at runtime when the column did not exist.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3604">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The index cleanup task for stream stores now only fetches the first column for each stream ID when determining whether the stream is still in use.
Previously, we would fetch the entire row which is unnecessary and causes read pressure on the key-value-service for highly referenced streams.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3423">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Live-reloading HTTP proxies and HTTP proxies with failover now refresh themselves after encountering a large number of cumulative requests or consecutive exceptions.
This was previously implemented to work around several issues with our usage of OkHttp, but was not implemented for the proxies with failover (which includes proxies to TimeLock).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3629">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-107-0">
<h2>v0.107.0<a class="headerlink" href="#v0-107-0" title="Permalink to this headline"></a></h2>
<p>10 Oct 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Targeted sweep now stores even less data in the sweepable cells table due to dictionary encoding table references instead of storing them as strings.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3533">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The legacy lock service’s lock state logger now logs additional information about the lock service’s internal synchronization state.
This includes details of queueing threads on each underlying sync object, as well as information on the progress of inflight requests.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3554">Pull Request 1</a> and
<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3565">Pull Request 2</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-106-0">
<h2>v0.106.0<a class="headerlink" href="#v0-106-0" title="Permalink to this headline"></a></h2>
<p>2 Oct 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Reverted the PR #3505, which was modifying PaxosLeaderElectionService to utilise distinct bounded thread pools, as this PR uncovered some resiliency issues with PaxosLeaderElectionService.
It will be re-merged after fixing those issues.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3536">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Targeted sweep now stores much less data in the sweepable cells table due to more efficient encoding.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3516">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TransactionManager``s</span> <span class="pre">now</span> <span class="pre">expose</span> <span class="pre">a</span> <span class="pre">``TimestampManagementService</span></code>, allowing clients to fast-forward timestamps when necessary.
This functionality is intended for libraries that extend AtlasDB functionality; it is unlikely that users should directly require the TimestampManagementService.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3524">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Targeted sweep no longer chokes if a table in the queue no longer exists, and was deleted by a different host while this host was online and sweeping.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3516">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Add versionId to SimpleTokenInfo to improve logging for troubleshooting.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3521">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Increase maximum allowed rescue dependency version to 4.X.X.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3525">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-logs">LOGS</span> <span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Changed the origin for logs when queries were slow from <cite>kvs-slow-log</cite> to <cite>kvs-slow-log-2</cite>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3549">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-105-0">
<h2>v0.105.0<a class="headerlink" href="#v0-105-0" title="Permalink to this headline"></a></h2>
<p>20 Sep 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Improved threading for MetricsManager’s metricsRegistry
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3497">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-logs">LOGS</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Improved visibility into sources of high DB load.
We log when a query returns a high number of timestamps that need to be looked up in the database, and tag some additional metrics with the tablename we were querying.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3488">Pull Request</a>)
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3504">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Upgrade http-remoting 3.41.1 -&gt; 3.43.0 to make tracing delegate nicely.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3494">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Users may now provide their own executors to instances of <code class="docutils literal notranslate"><span class="pre">BasicSQL</span></code> and to <code class="docutils literal notranslate"><span class="pre">BasicSQLUtils.runUninterruptably</span></code>.
Previously users were forced to use a default executor which had an unbounded thread-pool and fixed keep-alive timeouts.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3487">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>TargetedSweepMetrics#millisSinceLastSweptTs updates periodically, even if targeted sweep is failing to successfully run.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3507">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Targeted sweep no longer chokes if a table in the queue no longer exists.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3508">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Targeted sweep threads will no longer die if Timelock unlock calls fail.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3510">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>PaxosLeaderElectionService now utilises distinct bounded thread pools for communication with other PaxosLearners and PingableLeaders.
Previously, a single unbounded thread pool was used, which could cause starvation and OOMs under high load if any learners or leaders in the cluster were slow to fulfil requests.
This change also improves visibility as to which specific communication workflows may be suffering from issues.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3505">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue in timelock where followers were publishing metrics with <code class="docutils literal notranslate"><span class="pre">isCurrentSuspectedLeader</span></code> tag set to <code class="docutils literal notranslate"><span class="pre">true</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3509">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Background sweep will now choose between priority tables uniform randomly if there are multiple priority tables.
Previously, if multiple priority tables were specified, background sweep would repeatedly pick the same table to be swept, meaning that the other priority tables would all never be swept.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3512">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>A few timelock ops edge cases have been removed. Timelock users must now indicate whether they are booting their
servers for the first time or subsequent times, to avoid the situation where a timelock node becomes newly
misconfigured and thinks it is booting up for the first time again. Additionally, timestamps no longer overflow
when they hit Long.MAX_VALUE; this would only happen due to a bug, but at least now the DB will become read only
and not corrupt.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3498">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>PaxosQuorumChecker now takes an ExecutorService as opposed to an Executor.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3505">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-104-0">
<h2>v0.104.0<a class="headerlink" href="#v0-104-0" title="Permalink to this headline"></a></h2>
<p>4 Sep 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The Jepsen tests no longer assume that users have installed Python or DateUtil, and will install these itself if needed.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3461">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Bumps com.palantir.remoting3 dependency to 3.41.1 from 3.22.0.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3482">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-103-0">
<h2>v0.103.0<a class="headerlink" href="#v0-103-0" title="Permalink to this headline"></a></h2>
<p>30 Aug 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Targeted sweep queue now hard fails if it is unable to read table metadata to determine sweep strategy.
Previously, we assumed the strategy was conservative, which could result in sweeping tables that should never be swept.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3477">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue where targeted sweep would fail to increase the number of shards and error out if the default number of shards was ever persisted into the progress table.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3473">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Several exceptions (such as when creating cells with overly long names or executors in illegal configurations) now contain numerical parameters correctly.
Previously, the exceptions thrown would erroneously contain <code class="docutils literal notranslate"><span class="pre">{}</span></code> values.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3468">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Cassandra Key Value Service now no longer logs spurious ERROR warning messages when failing to read new-format table metadata.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3478">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Throw more specific CommittedTransactionException when operating on a committed transaction.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3460">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-102-0">
<h2>v0.102.0<a class="headerlink" href="#v0-102-0" title="Permalink to this headline"></a></h2>
<p>24 Aug 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>CQL queries are now logged correctly (with safe and unsafe arguments respected).
Previously, these versions would log all arguments as part of the format string as it eagerly did the string substitution.
AtlasDB versions 0.100.0 through 0.101.0 (inclusive both ends) are affected.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3469">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>CqlQuery is now an abstract class and must now be created through its builder.
This makes the intention that the query string provided is safe considerably more explicit.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3469">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>DbKvs now implements its own version of <code class="docutils literal notranslate"><span class="pre">deleteAllTimestamps</span></code> instead of using the default AbstractKvs implementation.
This facilitates better performance of targeted sweep on DbKvs.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3379">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>LockRefreshingLockService now batches calls to refresh locks in batches of 650K.
Previously, trying to refresh a larger number of locks could trigger the 50MB limit in payload size.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3450">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Reduce logging level for locks not being refreshed.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3458">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-101-0">
<h2>v0.101.0<a class="headerlink" href="#v0-101-0" title="Permalink to this headline"></a></h2>
<p>16 Aug 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Targeted Sweep is now enabled by default.
Products using atlasdb-cassandra library need to declare a dependency on Rescue 3 or ignore that dependency altogether.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3451">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug that when filtering the row results for <code class="docutils literal notranslate"><span class="pre">getRows</span></code> in <code class="docutils literal notranslate"><span class="pre">SnapshotTransaction</span></code> could cause an exception due to duplicate keys in a map builder.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3445">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB now correctly closes the targeted sweeper on shutdown, and logs less by default.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3447">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>The atlasdb-commons package has had its dependency tree greatly pruned of unused cruft.
This may introduce a devbreak to users transitively relying on these old dependencies.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3439">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">CassandraRequestExceptionHandler</span></code> is set to use <code class="docutils literal notranslate"><span class="pre">Conservative</span></code> exception handler by default. Main differences are:</p>
<blockquote>
<div><ul class="simple">
<li><p>Conservative exception handler backs off for larger subset of exceptions</p></li>
<li><p>Backoff period is exponentially increasing (but cannot go beyond <code class="docutils literal notranslate"><span class="pre">MAX_BACKOFF</span></code>)</p></li>
<li><p>Retries are executed on a different host rather than the same host for a larger subset of exceptions</p></li>
</ul>
</div></blockquote>
<p>(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3444">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>CassandraKVS’s <code class="docutils literal notranslate"><span class="pre">ExecutorService</span></code> is now instrumented.
This ExecutorService is responsible for submitting queries to the underlying DB. It being throttled will increase the latency of queries and transactions.
The following metrics are available:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.keyvalue.cassandra.CassandraKeyValueService.executorService.submitted</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.keyvalue.cassandra.CassandraKeyValueService.executorService.running</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.keyvalue.cassandra.CassandraKeyValueService.executorService.completed</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.keyvalue.cassandra.CassandraKeyValueService.executorService.duration</span></code></p></li>
</ul>
</div></blockquote>
<p>(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3416">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TransactionManagers</span></code> has a new builder option named <code class="docutils literal notranslate"><span class="pre">validateLocksOnReads()</span></code>; set to <code class="docutils literal notranslate"><span class="pre">true</span></code> by default. This option is passed to <code class="docutils literal notranslate"><span class="pre">TransactionManager</span></code>’s constructor, to be used in initialization of <code class="docutils literal notranslate"><span class="pre">Transaction</span></code>.
A transaction will validate pre-commit conditions and immutable ts lock after every read operation if underlying table is thoroughly swept (Default behavior). Setting <code class="docutils literal notranslate"><span class="pre">validateLocksOnReads</span></code> to <code class="docutils literal notranslate"><span class="pre">false</span></code> will stop transaction to do the mentioned validation on read operations; causing validations to take place only at commit time for the sake of reducing number of round-trips to improve overall transaction perf.
This change will cause a devbreak if you are constructing a <code class="docutils literal notranslate"><span class="pre">TransactionManager</span></code> outside of <code class="docutils literal notranslate"><span class="pre">TransactionManagers</span></code>. This can be resolved by adding an additional boolean parameter to the constructor (<code class="docutils literal notranslate"><span class="pre">true</span></code> if you would like to keep previous behaviour)
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3414">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-100-0">
<h2>v0.100.0<a class="headerlink" href="#v0-100-0" title="Permalink to this headline"></a></h2>
<p>2 Aug 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Cassandra KVS now correctly accepts check-and-set operations if one is working with multiple columns in the relevant row.
Previously, if there were multiple columns in the row where one was trying to do a CAS, the CAS would be rejected even if the column value matched the cell.
Similarly, for put-unless-exists, the PUE would be rejected if there were any other cells in the relevant row (even if they had a different column name).
We now perform the operations correctly only considering the value (or absence of value) in the relevant cell.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3388">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>We have removed the <code class="docutils literal notranslate"><span class="pre">sleepForBackoff(int)</span></code> method from <code class="docutils literal notranslate"><span class="pre">AbstractTransactionManager</span></code> as there were no known users and its presence led to user confusion.
AtlasDB does not actually backoff between attempts of running a user’s transaction task.
If your service overrides this method, please contact the AtlasDB team.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3432">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Sequential sweep now sleeps longer between iterations if there was nothing to sweep.
Previously we would sleep for 2 minutes between runs, but it is unlikely that anything has changed dramatically in 2 minutes so we sleep for longer to prevent scanning the sweep priority table too often.  Going forward the most likely explanation for there being nothing to sweep is that we have switched to targeted sweep.
We don’t stop completely or sleep for too long just in case configuration changes and a table is eligible to sweep again.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3429">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>TimeLockAgent now exposes the number of active clients and the configured maximum.
This makes it easier for a service to expose these via a health check.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3431">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-99-0">
<h2>v0.99.0<a class="headerlink" href="#v0-99-0" title="Permalink to this headline"></a></h2>
<p>25 July 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue where a failure to punch a value into the _punch table would suppress any future attempts to punch.
Previously, if the asynchronous job that punches a timestamp every minute ever threw an exception, the unreadable timestamp would be stuck until the service is restarted.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3427">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>TimeLock by default now has a client limit of 500.
Previously, this used to be 100 - however we have run into issues internally where stacks legitimately reach this threshold.
Note that we still need to maintain the client limit to avoid a possible DOS attack with users creating arbitrarily many clients.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3413">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Added metrics for the number of active clients and maximum number of clients in TimeLock Server.
These are useful to identify stacks that may be in danger of breaching their maxima.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3413">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-98-0">
<h2>v0.98.0<a class="headerlink" href="#v0-98-0" title="Permalink to this headline"></a></h2>
<p>25 July 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Targeted sweep now exposes tagged metrics for the outcome of each iteration, analogous to the legacy sweep outcome metrics.
The reported outcomes for targeted sweep are: <code class="docutils literal notranslate"><span class="pre">SUCCESS</span></code>, <code class="docutils literal notranslate"><span class="pre">NOTHING_TO_SWEEP</span></code>, <code class="docutils literal notranslate"><span class="pre">DISABLED</span></code>, <code class="docutils literal notranslate"><span class="pre">NOT_ENOUGH_DB_NODES_ONLINE</span></code>, and <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3399">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Changed the range scan behavior for the sweep priority table so that reads scan less data in Cassandra.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3410">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-97-0">
<h2>v0.97.0<a class="headerlink" href="#v0-97-0" title="Permalink to this headline"></a></h2>
<p>20 July 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>TimeLock Server now exposes a <code class="docutils literal notranslate"><span class="pre">startAtlasDbTransaction</span></code> endpoint which locks an immutable timestamp and then gets a fresh timestamp (in a single round-trip call); new TimeLock clients call this endpoint.
This saves an estimated one TimeLock round-trip of latency when starting a transaction.
Note that the old endpoints are still exposed (so TimeLock remains compatible with older Atlas clients), and there is an automated adapter for new TimeLock clients to talk to old TimeLock servers that don’t have this endpoint.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3319">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Reduced the logging level of various log messages.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3101">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>CassandraClientPoolingContainer metrics are tagged by pool name. Previosly pool name was embedded in metric name.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3375">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">CallbackInitializable</span></code> interface to simplify asynchronous initialization of resources using transaction manager callbacks.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3360">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The timestamp cache size is now actually live reloaded, and uses Caffeine instead of Guava for better performance. The read only transaction manager
(almost unused) now no longer constructs a thread pool.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3351">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Transactions now have meters recording their outcomes (e.g. successful commits, lock expiry, being rolled back, read-write conflicts, etc.)
In the cases of write-write and read-write conflicts, the first table on which a conflict occurred will be tagged on to the conflict meter if it is safe for logging.
Note that some metric names have changed; in particular, <code class="docutils literal notranslate"><span class="pre">SerializableTransaction.SerializableTransactionConflict</span></code> and <code class="docutils literal notranslate"><span class="pre">SnapshotTransaction.SnapshotTransactionConflict</span></code> are now tracked as <code class="docutils literal notranslate"><span class="pre">readWriteConflicts</span></code> and <code class="docutils literal notranslate"><span class="pre">writeWriteConflicts</span></code> respectively under <code class="docutils literal notranslate"><span class="pre">TransactionOutcomeMetrics</span></code>.
This is also an improvement in terms of clarity, as serializable transactions that experienced write-write conflicts were previously marked as snapshot transaction conflicts.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3358">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-96-0">
<h2>v0.96.0<a class="headerlink" href="#v0-96-0" title="Permalink to this headline"></a></h2>
<p>11 July 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Targeted sweep metrics will no longer range scan the punch table if the last swept timestamp was issued more than one week ago.
Previously, we would range scan the table even if the last swept timestamp was -1, which would force a range scan of the entire table.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3364">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-deprecated">DEPRECATED</span></p></td>
<td><p>Atlas clients using Cassandra can specify type of kvs as <cite>cassandra</cite> rather then <cite>CassandraKeyValueServiceRuntimeConfig</cite> in runtime configuration.
The <cite>CassandraKeyValueServiceRuntimeConfig</cite> type is now deprecated.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3359">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Startup and schema change performance improved for Cassandra users with large numbers of tables.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3278">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-95-0">
<h2>v0.95.0<a class="headerlink" href="#v0-95-0" title="Permalink to this headline"></a></h2>
<p>9 July 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The atlas console metadata query now returns more table metadata, such as sweep strategy and conflict handler information.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3161">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">putUnlessExists</span></code> API has been removed from AtlasDB tables, as it was misleading (it only did the put if the given row, column and value triple were already present, as opposed to the more intuitive condition of the row and column value pair being present).
Please replace any uses of the table-level <code class="docutils literal notranslate"><span class="pre">putUnlessExists</span></code> with a get, check and put if appropriate - these will still be transactional because of the AtlasDB transaction protocol.
Note that this is not the same as the KVS <code class="docutils literal notranslate"><span class="pre">putUnlessExists</span></code> API, which is still used by the transaction protocol.
This API has already been deprecated since August 2017 (11 months from time of writing).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3340">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>We will no longer continue to update <code class="docutils literal notranslate"><span class="pre">sweep.priority</span></code> if writes are persisted to the targeted sweep queue.
This means that assuming <code class="docutils literal notranslate"><span class="pre">targetedSweep.enableSweepQueueWrites</span></code> remains on, the background sweeper will eventually run out of things to sweep without further intervention.
At this point, the background sweeper will start reporting <code class="docutils literal notranslate"><span class="pre">NOTHING_TO_SWEEP</span></code>, and the background sweeper may safely be disabled.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3349">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Writes to the targeted sweep queue are now done using the start timestamp of the transaction that makes the call.
Previously, the writes were done at timestamp 0, which was interfering with Cassandra compactions.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3342">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The sweep CLI will no longer perform in-process compactions after sweeping a table.
For DbKvs, this operation is handled by the background compaction thread; Cassandra performs its own compactions.
Note that the sweep CLI itself has been deprecated in favour of using the sweep priority override configuration, possibly in conjunction with the thread count (<a class="reference internal" href="../cluster_management/sweep/standard-sweep.html#sweep-tunable-parameters"><span class="std std-ref">Docs</span></a>).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3338">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Three new conflict handlers <code class="docutils literal notranslate"><span class="pre">SERIALIZABLE_CELL</span></code>, <code class="docutils literal notranslate"><span class="pre">SERIALIZABLE_INDEX</span></code> and <code class="docutils literal notranslate"><span class="pre">SERIALIZABLE_LOCK_LEVEL_MIGRATION</span></code> are added.
<code class="docutils literal notranslate"><span class="pre">SERIALIZABLE_CELL</span></code> conflict handler is same as <code class="docutils literal notranslate"><span class="pre">SERIALIZABLE</span></code>, but checks for conflicts by locking cells during commit instead of locking rows. Cell locks are more fine-grained, so this will produce less contention at the expense of requiring more locks to be acquired.
<code class="docutils literal notranslate"><span class="pre">SERIALIZABLE_INDEX</span></code> conflict handler is designed to be used by index tables. As any write/write conflict on an index table will necessarily also be a write/write conflict on base table, this conflict handler does not check write/write conflicts. Read/write conflicts should still need to be checked, since we do not need to read the index table with the main table. This conflict handler also locks at cell level.
If your schema already has a table with <code class="docutils literal notranslate"><span class="pre">SERIALIZABLE</span></code> conflict handler, and you would like to migrate it to <code class="docutils literal notranslate"><span class="pre">SERIALIZABLE_CELL</span></code> or <code class="docutils literal notranslate"><span class="pre">SERIALIZABLE_INDEX</span></code> with a rolling upgrade (without a shutdown); then you should first migrate it to <code class="docutils literal notranslate"><span class="pre">SERIALIZABLE_LOCK_LEVEL_MIGRATION</span></code> conflict handler to avoid data corruption.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3267">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Removed the token range skewness logger from the Cassandra KVS. We’ve not been relying on it to catch issues and it produces a very large output that is cumbersome.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3352">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-94-0">
<h2>v0.94.0<a class="headerlink" href="#v0-94-0" title="Permalink to this headline"></a></h2>
<p>28 June 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Snapshot transaction <code class="docutils literal notranslate"><span class="pre">getRowsColumnRange</span></code> performance has been improved by using an <code class="docutils literal notranslate"><span class="pre">ImmutableSortedMap.Builder</span></code> and constructing the map at the end.
We previously used a <code class="docutils literal notranslate"><span class="pre">SortedSet</span></code> which would incur overhead in rebalancing the underlying red-black tree as the data was already mostly sorted.
We have seen a 7 percent speedup for reading all columns from a wide row (50,000 columns).
We have also seen a 6 percent speedup for reading 50,000 columns from a wide row, where a random 2 percent of these rows are from uncommitted transactions.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3319">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Snapshot transactions now return immutable maps when calling <code class="docutils literal notranslate"><span class="pre">getRows</span></code> and <code class="docutils literal notranslate"><span class="pre">getRowsColumnRange</span></code>.
These used to return mutable maps - please make a copy of the map if you need it to be mutable.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3319">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Multiple <code class="docutils literal notranslate"><span class="pre">BackgroundSweeper</span></code> threads can now run simultaneously.
To enable this, set the runtime option <code class="docutils literal notranslate"><span class="pre">sweep/sweepThreads</span></code> to the desired number of threads and restart any Atlas client.
If running multiple clients, these threads will be randomly split across them.
Due to the load it may place on Cassandra, this option is not recommended for long-term use for Cassandra-backed installations.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3257">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Sweep progress is now stored per-table, meaning that if background sweep of a table is interrupted
(for example, because sweep priority config changed), next time the background sweeper selects that table, it will pick up where it left off.
Previously, the table would be swept from the start, potentially leading to several days of work being redone.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3257">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">BackgroundSweeper</span></code> is no longer a <code class="docutils literal notranslate"><span class="pre">Runnable</span></code>. Its job is now to manage <code class="docutils literal notranslate"><span class="pre">BackgroundSweeperThread</span></code> instances, which are <code class="docutils literal notranslate"><span class="pre">Runnable</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3257">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Targeted sweep now stops reading from the sweep queue immediately if it encounters an entry known to be committed after the sweep timestamp.
Previously, we would read an entire batch before checking commit timestamps so that lookups can be batched, but this is not necessary if the commit timestamp is cached from a previous iteration.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3325">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Write transactions now unlock their row locks and immutable timestamp locks asynchronously after committing.
This saves an estimated two TimeLock round-trips of latency when committing a transaction.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3303">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB clients now batch calls to unlock row locks and immutable timestamp locks across transactions.
This should reduce request volumes on TimeLock Server.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3303">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Snapshot transactions now write detailed profiling logs of the form <code class="docutils literal notranslate"><span class="pre">Committed</span> <span class="pre">{}</span> <span class="pre">bytes</span> <span class="pre">with</span> <span class="pre">locks...</span></code> only once every 5 seconds per <code class="docutils literal notranslate"><span class="pre">TransactionManager</span></code> used.
Previously, they were written on every transaction.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3326">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB Benchmarks, CLIs and Console now shutdown properly under certain read patterns.
Previously, if these tools needed to delete a value that a failed transaction had written, the delete executor was never closed, thereby preventing an orderly JVM shutdown.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3328">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug in C* retry logic where number of retries over all the hosts were used as number of retries on a single host, which may cause unexpected blacklisting behaviour.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3323">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-93-0">
<h2>v0.93.0<a class="headerlink" href="#v0-93-0" title="Permalink to this headline"></a></h2>
<p>25 June 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Snapshot Transaction metrics now track the post-commit step of unlocking the transaction row locks.
Also, the <code class="docutils literal notranslate"><span class="pre">nonPutOverhead</span></code> and <code class="docutils literal notranslate"><span class="pre">nonPutOverheadMillionths</span></code> metrics now account for this step as well.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3307">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Targeted sweep now uses timelock locks to synchronize background threads on multiple hosts.
This avoids multiple hosts doing the same sweeps.
Targeted sweep also no longer forcibly sets the number of shards to at least the number of threads.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3310">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Cassandra deleteRows now avoids reading any information in the case that we delete the whole row.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3312">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">scyllaDb</span></code> option in Cassandra KVS config has been removed.
Please contact the AtlasDB team if you deploy AtlasDB with scyllaDb (this was never supported).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3313">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Fixed a bug where Cassandra client pool was erroneously logging host removal from blacklist, even the host was not blacklisted in the first place.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3314">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-92-2">
<h2>v0.92.2<a class="headerlink" href="#v0-92-2" title="Permalink to this headline"></a></h2>
<p>22 June 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>With targeted sweep, we now only call timelock once per set of range tombstones we leave, rather than once per cell.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3305">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-92-1">
<h2>v0.92.1<a class="headerlink" href="#v0-92-1" title="Permalink to this headline"></a></h2>
<p>21 June 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>We now consider only one row at a time when getting rows from the KVS with sweepable cells.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3302">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Cassandra retry messages now log bounds on attempts correctly.
Previously, they would log the supplier of these bounds (instead of the actual bounds, which users are more likely to be interested in).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3291">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-92-0">
<h2>v0.92.0<a class="headerlink" href="#v0-92-0" title="Permalink to this headline"></a></h2>
<p>20 June 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>We now publish metrics for more individual stages of the commit stage in a SnapshotTransaction.
We also now publish metrics for the total non-KVS overhead - both the absolute time involved as well as a ratio of this to the total time spent in the commit stage.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3273">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Snapshot transactions now, up to once every 5 real-time seconds, log an overview of how long each step in the commit phase took.
These logs will help the Atlas team better understand which parts of committing transactions may be slow, so that we can improve on it.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3273">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-metrics">METRICS</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">millisSinceLastSweptTs</span></code> metric for targeted sweep now updates at the same frequency as the <code class="docutils literal notranslate"><span class="pre">lastSweptTimestamp</span></code> metric.
This will result in a much smoother graph for the former metric instead of the current sawtooth graph.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3265">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>We now page with a smaller batch size when looking at the sweepable cells.
We also batch targeted sweep deletes in smaller batches.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3283">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue in targeted sweep where reading from the sweep queue when there are more than the specified batch size entries can cause some entries to be skipped.
This is unlikely to have affected anyone because the default batch size used was very large.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3284">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>AtlasDB now publishes timers tracking time taken to setup a transaction task before it is run, and time taken to tear down the task after it is done before runTaskWith* returns.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3281">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Added logging for leadership election code.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3275">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-91-0">
<h2>v0.91.0<a class="headerlink" href="#v0-91-0" title="Permalink to this headline"></a></h2>
<p>18 June 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>AtlasDB metrics are no longer a static singleton, and are now created upon construction of relevant classes.
This allows internal users to construct multiple AtlasDBs and get meaningful metrics. Many constructors have
been broken due to this change.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3237">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Refactored the TransactionManager inheritance tree to consolidate all relevant methods into a single interface.
Functionally, any TransactionManager created using TransactionManagers will provide the serializable and snapshot
isolation guarantees provided by a SerializableTransactionManager. Constructing TransactionManagers via this class
should result in only a minor dev break as a result of this change. This will make it easier to transparently wrap
TransactionManagers to extend their functionality.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3188">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The delete executor now uses daemon threads, so is less likely to cause failure to shutdown.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3271">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue where starting an HA Oracle-backed client may fail due to constraint violation.
The issue occurred when multiple nodes attempted to insert the same metadata.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3269">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Sweep metrics have been reworked based on their observed usefulness in the field.
<code class="docutils literal notranslate"><span class="pre">tableBeingSwept</span></code> is removed, as it is observed that it is not ingested as expected. Users can use service logs to track the table being swept.
<code class="docutils literal notranslate"><span class="pre">cellTimestampPairsExamined</span></code>, <code class="docutils literal notranslate"><span class="pre">staleValuesDeleted</span></code> and <code class="docutils literal notranslate"><span class="pre">sweepTimeSweeping</span></code> are being tracked by counters, instead of meters now. This change is done as it is observed that periodically sampled gauge readings are not useful if the frequency is lower than gauge update frequency. Now, these values will be accumulating over time. Users can take the difference of values of two successive points to track the process.
Sweep now exposes the following metrics with the common prefix <code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.sweep.metrics.LegacySweepMetrics.</span></code> (To be better distinguished from <code class="docutils literal notranslate"><span class="pre">TargetedSweepMetrics</span></code>):</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cellTimestampPairsExamined</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">staleValuesDeleted</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sweepTimeSweeping</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sweepTimeElapsedSinceStart</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sweepError</span></code></p></li>
</ul>
</div></blockquote>
<p>(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3244">Pull Request</a>)</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="v0-90-0">
<h2>v0.90.0<a class="headerlink" href="#v0-90-0" title="Permalink to this headline"></a></h2>
<p>11 June 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>When writing to Cassandra, the internal write timestamp for writes of sweep sentinels, range tombstones and deletes to regular tables are now approximately fresh timestamps from the timestamp service, as opposed to being an arbitrary hardcoded value or related to the transaction’s start timestamp.
This should improve Cassandra’s ability to purge droppable tombstones at compaction time, particularly in tables that see heavy volumes of overwrites and sweeping.</p>
<p>Note that this only applies if you have created your Transaction Manager through the <code class="docutils literal notranslate"><span class="pre">TransactionManagers</span></code> factory.
If you are creating your transaction manager elsewhere, you should supply a suitable <code class="docutils literal notranslate"><span class="pre">freshTimestampProvider</span></code> in initialization.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3224">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Targeted sweep now also sweeps stream stores.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3240">Pull Request</a>)</p>
<p>Note that targeted sweep is considered a beta feature as it is not fully functional yet.
Consult with the AtlasDB team if you wish to use targeted sweep in addition to, or instead of, standard sweep.</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Targeted sweep will no longer sweep cells from transactions that were committed after the sweep timestamp.
Instead, targeted sweep will not proceed for that shard and strategy until the sweep timestamp progresses far enough.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3253">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue where <code class="docutils literal notranslate"><span class="pre">getRowsColumnRange</span></code> would return no results if the number of rows was more than the batch hint.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3249">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Dropwizard transitive dependencies have been removed from the <code class="docutils literal notranslate"><span class="pre">atlasdb-config</span></code> subproject.
Usages of <code class="docutils literal notranslate"><span class="pre">AtlasDbConfigs</span></code> for config parsing still support discovering subtypes of config, as we ship AtlasDB with an implementation of Dropwizard’s <a class="reference external" href="https://github.com/dropwizard/dropwizard/blob/master/dropwizard-jackson/src/main/java/io/dropwizard/jackson/DiscoverableSubtypeResolver.java">DiscoverableSubtypeResolver</a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3218">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">AtlasDbFactory</span></code> now takes an additional <code class="docutils literal notranslate"><span class="pre">LongSupplier</span></code> parameter when creating a key-value-service that is intended to be a source of fresh timestamps from the timestamp service.
Please contact the AtlasDB team if you are uncertain what should be passed here.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3224">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The unbounded <code class="docutils literal notranslate"><span class="pre">CommitTsLoader</span></code> has been renamed to <code class="docutils literal notranslate"><span class="pre">CommitTsCache</span></code> and now has an eviction policy to prevent memory leaks.
Background sweep now reuses this cache for iterations of sweep instead of recreating it every iteration.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3256">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Some users of AtlasDB rely on being able to abort transactions which are in progress. Until the last release of AtlasDB, this worked successfully, however this was only the case because before
an assert could throw an AssertionError, an NPE was thrown by different code. Now, the assertion error is not thrown.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3254">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-89-0">
<h2>v0.89.0<a class="headerlink" href="#v0-89-0" title="Permalink to this headline"></a></h2>
<p>6 June 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>When determining if large sets of candidate cells were part of committed transactions, Background and Targeted Sweep will now read smaller batches of timestamps from the transaction service in serial.
Previously, though these reads were re-partitioned into smaller batches, the batch requests were made in parallel which could monopolise Atlas client-side as well as KVS-side resources.
There may be a small performance regression here, though this change promotes better stability for the underlying key-value-service especially in the presence of wide rows.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3245">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>The size of batches that are used when the <code class="docutils literal notranslate"><span class="pre">CommitTsLoader</span></code> loads timestamps as part of sweep is now set to be a non-configurable 50,000.
This used to be configured via the <code class="docutils literal notranslate"><span class="pre">fetchBatchSize</span></code> parameter in Cassandra config.
Other workflows that use this parameter continue to respect it.
If you have a use case for configuring this specifically, please contact the AtlasDB team.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3245">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">Transaction.getRowsColumnRange</span></code> method that returns an iterator now throws for <code class="docutils literal notranslate"><span class="pre">SERIALIZABLE</span></code> conflict handlers.
This functionality was never implemented correctly and never offered the serializable guarantee.
The method now throws an <code class="docutils literal notranslate"><span class="pre">UnsupportedOperationException</span></code> in this case.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3200">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Due to lack of use, we have deleted the AtlasDB Dropwizard bundle.
Users who need Atlas Console and CLI functionality are encouraged to use the respective distributions.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3231">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Added a new tagged metric for targeted sweep showing approximate time in milliseconds since the last swept timestamp has been issued.
This metric can be used to estimate how far targeted sweep is lagging behind the current moment in time.
The metric is <code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.sweep.metrics.TargetedSweepMetrics.millisSinceLastSweptTs</span></code> and is tagged with the sweep strategy used.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3217">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Atlas no longer throws if you read the same column range twice in a serializable transaction.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3239">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>We no longer treat CAS failure in Cassandra as a Cassandra level issue, meaning that we won’t blacklist connections due to a failed CAS.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3215">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SnapshotTransaction</span></code> now asynchronously deletes values for transactions that get rolled back.
This restores the behaviour from before the previous <a class="reference external" href="https://github.com/palantir/atlasdb/pull/3199">fix</a>, except that the parent transaction no longer waits for the delete to finish.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3219">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue occurring during transaction commits, where a failure to putUnlessExists a commit timestamp caused an NPE, leading to a confusing error message.
Previously, the method determining whether the transaction had committed successfully or been aborted would hit a code path that would always result in an NPE.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3205">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Increased PTExecutors default thread timeout from 100 milliseconds to 5 seconds to avoid recreating threads unnecessarily.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3208">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-88-0">
<h2>v0.88.0<a class="headerlink" href="#v0-88-0" title="Permalink to this headline"></a></h2>
<p>30 May 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-new">NEW</span></p></td>
<td><p>KVS method <code class="docutils literal notranslate"><span class="pre">deleteAllTimestamps</span></code> now also takes a boolean argument specifying if garbage deletion sentinels should also be deleted.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3212">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now implements targeted sweep using a sweep queue.
As long as the <code class="docutils literal notranslate"><span class="pre">enableSweepQueueWrites</span></code> property of the <code class="docutils literal notranslate"><span class="pre">targetedSweep</span></code> configuration is set to true, information about each transactional write and delete will be persisted into the sweep queue.
If <code class="docutils literal notranslate"><span class="pre">targetedSweep</span></code> is enabled in AtlasDB runtime configurations, background threads will read the persisted information from the sweep queue and delete stale data from the kvs.
For more details on targeted sweep, please refer to the <a class="reference internal" href="../cluster_management/sweep/targeted-sweep.html#targeted-sweep"><span class="std std-ref">targeted sweep docs</span></a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3094">Pull Request</a>)</p>
<p>Note that targeted sweep is considered a beta feature as it is not fully functional yet.
Consult with the AtlasDB team if you wish to use targeted sweep in addition to, or instead of, standard sweep.</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Added tagged targeted sweep metrics for conservative and thorough sweep.
The metrics show the cumulative number of enqueued writes, entries read, tombstones put, and aborted cells deleted.
Additionally, there are metrics for the sweep timestamp of the last sweep iteration and for the lowest last swept timestamp across all shards.
The metrics, tagged with the sweep strategy used, are as follws (with the common prefix <code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.sweep.metrics.TargetedSweepMetrics.</span></code>):</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enqueuedWrites</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">entriesRead</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tombstonesPut</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">abortedWritesDeleted</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sweepTimestamp</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lastSweptTimestamp</span></code></p></li>
</ul>
</div></blockquote>
<p>(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3202">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Added logging of the values used to determine which table to sweep, provides more insight into why tables are being swept and others aren’t.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2829">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>http-remoting has been upgraded to 3.22.0 (was 3.14.0).
This release fixes several issues with communication between Atlas servers and a QoS service, if configured (especially in HA configurations).
Note that this change does not affect communication between timelock nodes, or between an Atlas client and timelock, as these do not currently use remoting.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3196">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-87-0">
<h2>v0.87.0<a class="headerlink" href="#v0-87-0" title="Permalink to this headline"></a></h2>
<p>25 May 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SnapshotTransaction</span></code> will no longer attempt to delete values for transactions that get rolled back.
The deletes were (necessarily) run at consistency <code class="docutils literal notranslate"><span class="pre">ALL</span></code>, meaning that if aborted data was present, read
transactions had significantly impaired performance if a database node was down.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3199">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-86-0">
<h2>v0.86.0<a class="headerlink" href="#v0-86-0" title="Permalink to this headline"></a></h2>
<p>23 May 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The Cassandra key value service is now guaranteed to return getRowsColumnRange results in the correct order.
Previously while paging over row dynamic columns, the first batchHint results are ordered lexicographically,
whilst the remainder are hashmap ordered in chunks of batchHint. In practice, when paging this can lead to
entirely incorrect, duplicate results being returned. Now, they are returned in order.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3184">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a race condition where requests to a node can fail with NotCurrentLeaderException,
even though that node just gained leadership.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3183">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-85-0">
<h2>v0.85.0<a class="headerlink" href="#v0-85-0" title="Permalink to this headline"></a></h2>
<p>18 May 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Snapshot transaction is now guaranteed to return getRowsColumnRange results in the correct order.
Previously while paging over row dynamic columns, if uncommitted or aborted transaction data was
seen, it would be placed at the end of the list, instead of at the start, meaning that the results
are mostly (but not entirely) in sorted order. In practice, this leads to duplicate results in paging,
and on serializable tables, transactions that paradoxically conflict with themselves.
Now, they are guaranteed to be returned in order, which removes this issue.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3174">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-84-0">
<h2>v0.84.0<a class="headerlink" href="#v0-84-0" title="Permalink to this headline"></a></h2>
<p>16 May 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Timelock will now have more debugging info if the paxos directories fail to be created on startup.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3156">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Move a complicated and elsewhere overridden method from AbstractKeyValueService into DbKvs
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3159">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The (Thrift-backed) <code class="docutils literal notranslate"><span class="pre">CassandraKeyValueService</span></code> now returns correctly for CQL queries that return null.
Previously, they would throw an exception when we attempted to log information about the response.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3158">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-83-0">
<h2>v0.83.0<a class="headerlink" href="#v0-83-0" title="Permalink to this headline"></a></h2>
<p>10 May 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>If we make a successful request to a Cassandra client, we now remove it from the overall Cassandra service’s blacklist.
Previously, removal from the blacklist would only occur after a background thread successfully refreshed the pool, meaning that requests may become stuck if Cassandra was rolling restarted.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3145">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The Cassandra client pool now respects the <code class="docutils literal notranslate"><span class="pre">maxRetriesOnHost</span></code> config option, and will not try a single operation beyond that many times on the same node.
Previously, under certain kinds of exceptions (such as <code class="docutils literal notranslate"><span class="pre">TTransportException</span></code>), we would repeatedly retry the operation on the same node up to <code class="docutils literal notranslate"><span class="pre">maxTriesTotal</span></code> times.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3145">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Any ongoing Cassandra schema mutations are now given two minutes to complete upon closing a transaction manager, decreasing the chance that the schema mutation lock is lost.
Some exceptions thrown due to schema mutation failures now have type <code class="docutils literal notranslate"><span class="pre">UncheckedExecutionException</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3152">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-82-2">
<h2>v0.82.2<a class="headerlink" href="#v0-82-2" title="Permalink to this headline"></a></h2>
<p>4 May 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SerializableTransaction</span></code> now initialises internal state correctly.
Previously, we would throw an exception if multiple equivalent column range selections for different rows needed to be checked in the same transaction.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3147">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-82-1">
<h2>v0.82.1<a class="headerlink" href="#v0-82-1" title="Permalink to this headline"></a></h2>
<p>1 May 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Specifying tables in configuration for sweep priority overrides now works properly.
Previously, attempting to deserialize configurations with these overrides would cause errors.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3136">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-82-0">
<h2>v0.82.0<a class="headerlink" href="#v0-82-0" title="Permalink to this headline"></a></h2>
<p>1 May 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB now partitions versions of cells to be swept into batches more robustly and more efficiently.
Previously, this could cause stack overflows when sweeping a very wide row, because the partitioning algorithm attempted to traverse a recursive hierarchy of sublists.
Also, previously, partitioning would require time quadratic in the number of versions present in the row; it now takes linear time.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3095">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Users can now explicitly specify specific tables for the background sweeper to (1) prioritise above other tables, or (2) blacklist.
This is done as part of live-reloadable configuration, though note that background sweep will conclude its current iteration before switching to a priority table / away from a blacklisted table, as appropriate.
Please see <a class="reference internal" href="../cluster_management/sweep/standard-sweep.html#sweep-priority-overrides"><span class="std std-ref">Sweep Priority Overrides</span></a> for more details.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3090">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Transaction managers now shut down threads associated with the QoS client and TimeLock lock refresher when they are closed.
Previously, these threads would continue running and needlessly using resources.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3096">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">_locks</span></code> table is now created with a deterministic column family ID.
This means that multi-node installations will no longer create multiple locks tables on first start-up.
Note that new installations using versions of Cassandra prior to 2.1.13, 2.2.5, 3.0.3 or 3.2 will fail to create this table, as we rely on syntax introduced by the fix to <a class="reference external" href="https://issues.apache.org/jira/browse/CASSANDRA-9179">CASSANDRA-9179</a>.
Existing installations will be unaffected.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3088">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>OkHttp is not handling <code class="docutils literal notranslate"><span class="pre">Thread.interrupt()</span></code> well, and calling interrupts repeatedly may cause corrupted http clients.
This would cause TimeLock clients to appear silent (requests would not be accepted or logged), but would not have affected data integrity.
To avoid this issue, our Feign client is now wrapped with an <code class="docutils literal notranslate"><span class="pre">ExceptionCountingRefreshingClient</span></code>, which will detect and refresh corrupted clients.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3121">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LoggingArgs::isSafeForLogging(TableReference,</span> <span class="pre">Cell)</span></code> was removed, as it behaved unexpectedly and could leak information.
Previously, it returned true only if the cell’s row matched the name of a row component which was declared as safe.
However, knowledge of the existence of such a cell may not actually be safe.
There currently isn’t an API for declaring specific row or dynamic column components as safe; please contact the AtlasDB team if you have such a use case.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3093">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Expired lock refreshes now tell you which locks expired, instead of just their refreshing token id.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3125">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The strategy for choosing the table to compact was adjusted to avoid the case when the same table is chosen multiple times in a row, even if it was not swept between compactions.
Previously, the strategy to choose the table to compact was:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>if possible choose a table that was swept but not compacted</p></li>
<li><p>otherwise choose a table for which the time passed between last compact and last swept was longer</p></li>
</ol>
</div></blockquote>
<p>When all tables are swept and afterward compacted, the last point above could choose to compact the same table because <code class="docutils literal notranslate"><span class="pre">lastSweptTime</span> <span class="pre">-</span> <span class="pre">lastCompactTime</span></code> is negative and largest among all tables.</p>
<p>The new strategy is:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>if possible choose a table that was swept but not compacted</p></li>
<li><p>if there is no uncompacted table then choose a table swept further after it was compacted</p></li>
<li><p>otherwise, randomly choose a table after filtering out the ones compacted in the past hour</p></li>
</ol>
</div></blockquote>
<p>(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3100">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">kvs-slow-log</span></code> messages now also include start time of the operation for easier debugging.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3117">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>AtlasDB internal tables will no longer produce warning messages about hotspotting.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3126">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-81-0">
<h2>v0.81.0<a class="headerlink" href="#v0-81-0" title="Permalink to this headline"></a></h2>
<p>19 April 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Async TimeLock Service metric timers are now tagged with (1) the relevant clients, and (2) whether the current node is the leader or not.
This allows for easier analysis and consumption of these metrics.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3075">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Common annotations can now be imported via the commons-annotations library, instead of needing to pull in atlasdb-commons.
Existing code that uses atlasdb-commons for the annotations will still be able to resolve them.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3089">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Logs in <code class="docutils literal notranslate"><span class="pre">CassandraRequestExceptionHandler</span></code> are logged using a logger named after that class instead of <code class="docutils literal notranslate"><span class="pre">CassandraClientPool</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3092">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Bumped several libraries to get past known security vulns:</p>
<ul class="simple">
<li><p>Cassandra Thrift and CQL libs</p></li>
<li><p>Jackson</p></li>
<li><p>Logback</p></li>
<li><p>Netty (indirectly via cassandra lib bump)</p></li>
</ul>
<p>(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3084">Pull Request</a>)</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="v0-80-0">
<h2>v0.80.0<a class="headerlink" href="#v0-80-0" title="Permalink to this headline"></a></h2>
<p>04 April 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Centralize how <code class="docutils literal notranslate"><span class="pre">PersistentLockManager</span></code> is created in a dagger context.
Also, removed the old constructor for <code class="docutils literal notranslate"><span class="pre">CellsSweeper</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3047">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Downgraded “Tried to connect to Cassandra {} times” logs from <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> to <code class="docutils literal notranslate"><span class="pre">WARN</span></code>, and stopped printing the stack trace.
An exception is thrown to the service who made the request; this service has the opportunity to log at a higher level if desired.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3069">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now supports runtime configuration of throttling for stream stores when streams are written block by block in a non-transactional fashion.
Previously, such streams would be written using a separate transaction for each block, though in cases where data volume is high this may still cause load on the key-value-service Atlas is using.
Please note that if you wish to use this feature, you will need to regenerate your Atlas schemas and suitably inject the stream persistence configuration into your stream stores.
However, if you do not intend to use this feature, no action is required, and your stream stores’ behaviour will not be changed.
Note that enabling throttling may make nontransactional <code class="docutils literal notranslate"><span class="pre">storeStream</span></code> operations take longer, though the length of constituent transactions should not be affected.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3073">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now schedules KVS compactions on a background thread, as opposed to triggering a compaction after each table was swept.
This allows for better control over KVS load arising from compactions.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3058">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now supports configuration of a maintenance mode for compactions.
If compactions are run in maintenance mode, AtlasDB may perform more costly operations which may be able to recover more space.
For example, for Oracle KVS, <code class="docutils literal notranslate"><span class="pre">SHRINK</span> <span class="pre">SPACE</span></code> (which acquires locks on the entire table) will only be run if compactions are carried out in maintenance mode.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3058">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug that causes Cassandra clients to return to the pool even if they have thrown blacklisted exceptions.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3063">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fix NPE if PaxosLeaderElectionServiceBuilder’s new field onlyLogOnQuorumFailure is never set.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3074">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>If using TimeLock, AtlasDB now checks the value of a fresh timestamp against the unreadable timestamp on startup, failing if the fresh timestamp is smaller.
That implies clocks went backwards; doing this mitigates the damage that a bogus TimeLock migration or other corruption of TimeLock can do.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3018">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Applications can now easily determine whether their Timelock cluster is healthy by querying <code class="docutils literal notranslate"><span class="pre">TransactionManager.getTimelockServiceStatus().isHealthy()</span></code>.
This returns true only if a healthy connection to timelock service is established.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3030">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-79-0">
<h2>v0.79.0<a class="headerlink" href="#v0-79-0" title="Permalink to this headline"></a></h2>
<p>20 March 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Guava has been updated from 21.0 to 23.6-jre.
This unblocks users using libraries which have dependencies on more recent versions of Guava, owing to API changes in <code class="docutils literal notranslate"><span class="pre">SimpleTimeLimiter</span></code>, among other classes.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3038">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Sweep metrics are now updated to the result value of the last run iteration of sweep instead of the cumulative values for the run of sweep on the table.
This has been done in order to improve the granularity of the metrics, since cumulative results can be several orders of magnitude larger, thus obfuscating the delta.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3055">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Added a new parameter <code class="docutils literal notranslate"><span class="pre">addressTranslation</span></code> to <code class="docutils literal notranslate"><span class="pre">CassandraKeyValueServiceConfig</span></code>.
This parameter is a static map specifying how internal Cassandra endpoints should be translated to InetSocketAddresses.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3040">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The Cassandra client pool is now cleaned up in the event of a failure to construct the Cassandra KVS (e.g. because we lost our connection to Cassandra midway).
Previously, the client pool was not shut down, leading to a thread leak.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3006">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Log an ERROR in the case of failure to create a Cell due to a key greater than 1500 bytes. Previously we logged at DEBUG.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3034">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">clean-cass-locks-state</span></code> command is now using Atlas namespace as Cassandra keyspace if provided.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3035">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Logging exceptions in the case of quorum is runtime configurable now, using <code class="docutils literal notranslate"><span class="pre">only-log-on-quorum-failure</span></code> flag, for external timelock services. Previously it was set to true by default.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3057">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-78-0">
<h2>v0.78.0<a class="headerlink" href="#v0-78-0" title="Permalink to this headline"></a></h2>
<p>2 March 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">TransactionManagers</span></code> builder now optionally accepts a <code class="docutils literal notranslate"><span class="pre">Callback</span></code> object.
If <code class="docutils literal notranslate"><span class="pre">initializeAsync</span></code> is set to true, then this callback will be run after all the initialization prerequisites for the TransactionManager have been met, and the TransactionManager will start returning true on calls to its <code class="docutils literal notranslate"><span class="pre">isInitialized()</span></code> method only once the callback has returned.
If <code class="docutils literal notranslate"><span class="pre">initializeAsync</span></code> is set to false, then this callback will be run just before the TransactionManager is returned, blocking until it is done.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3011">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>SerializableTransactionManager can now be closed even if it is not initialized yet.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3011">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-changed">CHANGED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Sweep metrics have been reworked based on their observed usefulness in the field.
In particular, histograms and most of the meters were replaced with gauges that expose last known values of tracked sweep results.
Tagged metrics have been removed as well, and were replaced by a gauge <code class="docutils literal notranslate"><span class="pre">tableBeingSwept</span></code> that exposes the name of the table being swept, if it is safe for logging.
Sweep metrics <code class="docutils literal notranslate"><span class="pre">cellTimestampPairsExamined</span></code> and <code class="docutils literal notranslate"><span class="pre">staleValuesDeleted</span></code> are now updated after every batch of deletes instead of waiting until all of the batches are processed.
Sweep now exposes the following metrics with the common prefix <code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.sweep.metrics.SweepMetric.</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tableBeingSwept</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cellTimestampPairsExamined</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">staleValuesDeleted</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sweepTimeSweeping</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sweepTimeElapsedSinceStart</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sweepError</span></code></p></li>
</ul>
</div></blockquote>
<p>(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2951">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>LoggingArgs no longer throws when it tries to hydrate invalid table metadata.
This fixes an issue that prevented AtlasDB to start after performing a KVS migration.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3006">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Changes the default scrubber behavior to aggressive scrub (synchronous with scrub request).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3009">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug that can causes the background sweep thread to fail to shut down cleanly, hanging the application.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3023">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Remove a round trip from read only transactions
not involving thoroughly swept tables.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3020">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-77-0">
<h2>v0.77.0<a class="headerlink" href="#v0-77-0" title="Permalink to this headline"></a></h2>
<p>16 February 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>AtlasDB migration CLI no longer drops the temporary table used during migration and instead truncates it.
This avoids an issue where AtlasDB would refuse to start after a migration because it would try to hydrate empty table metadata for the above table.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3000">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Upgraded Postgres jdbc driver to 42.2.1 (from 9.4.1209).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2985">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fix NPE when warming conflict detection cache if table is being created.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2993">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Introduced configurable <code class="docutils literal notranslate"><span class="pre">writeThreshold</span></code> and <code class="docutils literal notranslate"><span class="pre">writeSizeThreshold</span></code> parameters for when to write stats for the Sweep prioritization.
Also reduce the defaults to flush write stats on 32MB overall write size and 2k cells.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2998">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fix <code class="docutils literal notranslate"><span class="pre">SnapshotTransaction#getRows</span></code> to apply <code class="docutils literal notranslate"><span class="pre">ColumnSelection</span></code> when there are local writes.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/3008">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>CassandraKVS sstable size in MB was not being correctly set.
This resulted in requirements on the entire cluster being up during startup of certain stacks.
CF metadata mismatch messages are also now correctly safety marked for logging.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2989">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-76-0">
<h2>v0.76.0<a class="headerlink" href="#v0-76-0" title="Permalink to this headline"></a></h2>
<p>12 February 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug which would make sweep deletes not be compacted by Cassandra.
Over time this would lead to tombstones being accumulated in the DB and disk space not being reclaimed.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2968">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>When TransactionManagers doesn’t return successfully, we leaked resources depending on which step of the initialization failed.
Now resources are properly closed and freed.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2964">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug where Cassandra clients’ input buffers were left in an invalid state before returning the client to the pool, manifesting in NPEs in the Thrift layer.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2971">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-new">NEW</span></p></td>
<td><p>Added a new parameter <code class="docutils literal notranslate"><span class="pre">conservativeRequestExceptionHandler</span></code> to <code class="docutils literal notranslate"><span class="pre">CassandraKeyValueServiceRuntimeConfig</span></code>.
Setting this parameter to true will enable more conservative retrying logic for requests, including longer backoffs and not retrying on the same host when encoutering an exception that is indicative of high Cassandra load, e.g., TimeoutExceptions.
This parameter is live-reloadable, and reloading it will affect in-flight requests, with the caveat that once a request gives up on a node, it will not retry that node again even if we disable conservative retrying.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2960">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB CLIs now allow a runtime config to be passed in.
This allows the CLIs to be used with products that are configured to use timelock and have the timelock block in the runtime config.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2937">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>AtlasDbConfigs now supports parsing of both install and runtime configuration.
As part of these changes, <code class="docutils literal notranslate"><span class="pre">load</span></code>, <code class="docutils literal notranslate"><span class="pre">loadFromString</span></code> and other methods in <code class="docutils literal notranslate"><span class="pre">AtlasDbConfigs</span></code> now take a type parameter.
To fix existing usage, please pass in <code class="docutils literal notranslate"><span class="pre">AtlasDbConfig.class</span></code> as the type parameter to these functions.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2937">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug where the CleanCassLocksState CLI would not start because the Cassandra locks were in a bad state.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2948">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Close AsyncInitializer executors. This should reduce memory pressure of clients after startup.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2945">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Added a TimeLock healthcheck for signalling that no leader election has been triggered.
This will allow TimeLock itself to broadcast a HEALTHY status even without a leader.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2939">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Index tables can now be marked as safe for logging.
If you use indexes, please add <code class="docutils literal notranslate"><span class="pre">allSafeForLogging()</span></code> on their definition (where reasonable).
This makes all AtlasDB tables able to be marked as safe for logging.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2940">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Make some values of <code class="docutils literal notranslate"><span class="pre">CassandraKeyValueServiceConfig</span></code> live-reloadable.
To check which parameters are live-reloadable, check the <code class="docutils literal notranslate"><span class="pre">CassandraKeyValueServiceRuntimeConfig</span></code> class.
Docs about this config can be found <a class="reference internal" href="../configuration/index.html#atlas-config"><span class="std std-ref">here</span></a> and <a class="reference internal" href="../configuration/key_value_service_configs/cassandra_key_value_service_config.html#cassandra-configuration"><span class="std std-ref">here</span></a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2896">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Renamed the method used to create LockAndTimestampServices by the CLI commands and AtlasConsole.
Please update usages of <code class="docutils literal notranslate"><span class="pre">createLockAndTimestampServices</span></code> to <code class="docutils literal notranslate"><span class="pre">createLockAndTimestampServicesForCli</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2896">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Sweep now logs the number of cells it is deleting when performing a single batch of deletes.
This is useful for visibility of Sweep progress; previously, Sweep would only log when a top-level batch was complete, meaning that for highly versioned rows Sweep would only log after deleting all stale versions of said row.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2958">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The sweep-table endpoint now returns HTTP status 400 instead of 500, when asked to sweep a non-existent table.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2936">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Atlas now records the number of cells written over time, if you are using Cassandra KVS.
This metric is reported under <code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.keyvalue.cassandra.CassandraClient.cellsWritten</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2967">Pull Request</a>)
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2974">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ExecutorInheritableThreadLocal</span></code> from <code class="docutils literal notranslate"><span class="pre">commons-executors</span></code> has been split out into a <code class="docutils literal notranslate"><span class="pre">commons-executors-api</span></code> dependent project with no dependencies.
This allows api projects outside of atlasdb to use <code class="docutils literal notranslate"><span class="pre">ExecutorInheritableThreadLocal</span></code> without pulling in the dependencies of <code class="docutils literal notranslate"><span class="pre">commons-executors</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2961">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-75-0">
<h2>v0.75.0<a class="headerlink" href="#v0-75-0" title="Permalink to this headline"></a></h2>
<p>29 January 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>AtlasDB will now <em>fail to start</em> if a TimeLock block is included in the initial runtime configuration, but the install configuration is set up with a leader block or with remote timestamp and lock blocks.
Previously, AtlasDB would start successfully under these conditions, but the TimeLock block in the runtime configuration would be silently ignored.
Note that the decision on whether to use TimeLock or another source of timestamps and locks is made at install-time.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2850">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>AtlasDB users can now specify the usage of TimeLock Server purely by including a TimeLock block in the initial runtime configuration.
Previously, AtlasDB users would need to specify that they were using TimeLock in the install configuration, possibly with an empty object (<code class="docutils literal notranslate"><span class="pre">timelock:</span> <span class="pre">{}</span></code>).
This is a change from previous behaviour in cases where users specified an embedded install configuration but a TimeLock block in the runtime configuration; previously, the embedded configuration would have been selected, while now the TimeLock configuration will be selected.</p>
<p>Also, users with scripts that depend on supplying a default runtime configuration may need to be careful to ensure that TimeLock configuration is preserved when such scripts are run.
That said, AtlasDB will fail to start if trying to access a key-value service where TimeLock has been used as a source of timestamps without going through TimeLock, so we don’t think there is a risk of data corruption.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2850">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Fixed metric re-registration log spam in <code class="docutils literal notranslate"><span class="pre">TokenRangeWriteLogger</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2913">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>AtlasDB clients will receive a <code class="docutils literal notranslate"><span class="pre">QosException.Throttle</span></code> for requests that are throttled and http-remoting
should handle them appropriately based on the backOff strategy provided by the application. Note that this is
an experimental feature and we do not expect it to be enabled anywhere. This is a dev break as the exception type
has changed from <code class="docutils literal notranslate"><span class="pre">RateLimitExceededException</span></code> to <code class="docutils literal notranslate"><span class="pre">QosException.Throttle</span></code>.
(<a class="reference external" href="https://github.com/palantir/http-remoting/blob/a14a0894c2f5d1a415c5ee2727e9c79d73255b7b/okhttp-clients/src/main/java/com/palantir/remoting3/okhttp/RemotingOkHttpCall.java#L221-L233">Throttle</a>)
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2926">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Use tags in sweep outcome metrics instead of using each name per outcome.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2927">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Log message for leaked sweep/backup lock is now WARN rather than INFO.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2912">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TokenRangeWrite</span></code> metrics are calculated every 1000 writes so we can chart metrics for smaller tables.  Logging now happens every 6 hours regardless of number of writes (although there must be at least 1).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2910">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">CassandraClient</span></code> kvs-slow-logs have been improved. They now contain the duration of the call and information
about the results from the KVS.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2924">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Updated our Guava dependency from 18.0 to 20.0. This should unblock downstream products from upgrading to Guava 22.0.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2926">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Updated our http-remoting dependency from 3.5.1 to 3.14.0.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2926">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-74-0">
<h2>v0.74.0<a class="headerlink" href="#v0-74-0" title="Permalink to this headline"></a></h2>
<p>23 January 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>AtlasDB internal table names are now safe for logging.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2903">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BackgroundSweeperImpl</span></code> now logs if there’s an uncaught exception.  Added 2 new outcomes for normal and abnormal shutdown to allow closer monitoring.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2884">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">LockAwareTransactionManager</span></code> pre-commit checks that verify that locks are still held have been generalized to support arbitrary pre-commit checks.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2846">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">AtlasDbConstants.GENERIC_TABLE_METADATA</span></code> is now safe for logging, if you are using this as the metadata to
create table names that shouldn’t be logged in the internal logging framework, do not use this metadata.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2903">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">partitionStrategy</span></code> parameter in AtlasDB table metadata has been removed; products that explicitly specify partition strategies in their schemas will need to remove them.
The value of this parameter was never actually read; behaviour would have been identical regardless of what this was specified to (if at all).
This change was made to simplify the API and also remove any illusion that specifying the <code class="docutils literal notranslate"><span class="pre">partitionStrategy</span></code> would have done anything.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2864">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>The protobuf library has been upgraded to 3.5.1. Dependent projects will need to update their dependencies.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2887">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>V2 Schemas which use <code class="docutils literal notranslate"><span class="pre">ValueType.BLOB</span></code> will now compile.
Previously, compilation failed with an <code class="docutils literal notranslate"><span class="pre">IllegalArgumentException</span></code> from Java Poet, as we assumed Java versions of <code class="docutils literal notranslate"><span class="pre">ValueType</span></code> were always associated with object types.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2899">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TokenRangeWriteLogger</span></code> now registers different metric names per table even if all are unsafe.  We instead tag with an obfuscated version of the name which is safe for logging.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2889">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Stop sweeping when the sweep thread is interrupted.
Previously, when services were shutting down, the background sweeper thread continuously logged warnings
due to a closed <code class="docutils literal notranslate"><span class="pre">TransactionManager</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2900">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Removed <code class="docutils literal notranslate"><span class="pre">CassandraKeyValueServiceConfigManager</span></code>. If you’re affected by this, please contact the AtlasDB team.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2886">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-73-1">
<h2>v0.73.1<a class="headerlink" href="#v0-73-1" title="Permalink to this headline"></a></h2>
<p>16 January 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fix a NPE in that could happen in the Sweep background thread. In this scenario, sweep would get stuck and not be able to proceed.
The regression was introduced with (<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2860">#2860</a>), in version 0.73.0.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2883">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Qos clients will query the service every 2 seconds instead of every client request. This should prevent too many requests to the service.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2872">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>All Atlas executor services now run tasks wrapped in http-remoting utilities to preserve trace logging.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2868">Pull Request</a>)
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2874">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-73-0">
<h2>v0.73.0<a class="headerlink" href="#v0-73-0" title="Permalink to this headline"></a></h2>
<p>16 January 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>On Cassandra KVS, sweep reads data from Cassandra in parallel, resulting in improved performance.
The parallelism can be changed by adjusting <code class="docutils literal notranslate"><span class="pre">sweepReadThreads</span></code> in Cassandra KVS config (default 16).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2860">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB now throws an error during schema code generation stage if index table name length exceeds KVS table name length limits.
To override this, please specify <code class="docutils literal notranslate"><span class="pre">ignoreTableNameLengthChecks()</span></code> on your schema.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2862">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-73-0-rc2">
<h2>v0.73.0-rc2<a class="headerlink" href="#v0-73-0-rc2" title="Permalink to this headline"></a></h2>
<p>12 January 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Qos Service: AtlasDB now supports a QosService which can rate-limit clients.
Please note that this feature is currently experimental; if you wish to use it, please contact the AtlasDB team.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2700">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>The JDBC URL for Oracle can now be overridden in the configuration.
The parameter path is <code class="docutils literal notranslate"><span class="pre">keyValueService/connection/url</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2837">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-73-0-rc1">
<h2>v0.73.0-rc1<a class="headerlink" href="#v0-73-0-rc1" title="Permalink to this headline"></a></h2>
<p>11 January 2018</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Allow StreamStore table names to be marked as safe. This will make StreamStore tables appear correctly on our logs and metrics.
When building a StreamStore, please use <code class="docutils literal notranslate"><span class="pre">.tableNameLogSafety(TableMetadataPersistence.LogSafety.SAFE)</span></code> to mark the table name as safe.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2835">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Sweep stats are updated more often when large writes are being made.
<code class="docutils literal notranslate"><span class="pre">SweepStatsKVS</span></code> now tracks the size of modifications being made to the underlying KVS and will write when a threshold is passed.
Previously, sweep stats were updated every 65536 writes, but this could be a significant amount of data if written to the stream store.
We now also track the size of the writes and if this is greater than 1GB, we flush the stats.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2792">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Improvements to how sweep prioritises which tables to sweep; should allow better reclaiming of space from stream stores.
Stream store value tables are now more likely to be chosen because they contain lots of data per write.
We ensure we sweep index tables before value tables, and allow a gap after sweeping index tables and before sweeping value tables.
We wait 3 days between sweeps of a value table to prevent unnecessary work, allow other tables to be swept and tombstones to be compacted away.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2793">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SweepResults.getCellTsPairsExamined</span></code> now returns the correct result when sweep is run over multiple batches.
Previously, the result would only count cell-ts pairs examined in the last batch.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2830">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Further reduced memory pressure on sweep for Cassandra KVS, by rewriting one of the CQL queries.
This removes a significant cause of occurrences of Cassandra OOMs that have been seen in the field recently.
However, performance is significantly degraded on tables with few columns and few overwrites (fixed in 0.73.0).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2826">Pull Request 1</a> and <a class="reference external" href="https://github.com/palantir/atlasdb/pull/2826">Pull Request 2</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Safe and Unsafe table name logging args are now different, fixed unreleased bug where tables names were logged as Safe
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2838">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Messages to the <code class="docutils literal notranslate"><span class="pre">slow-lock-log</span></code> now log at <code class="docutils literal notranslate"><span class="pre">WARN</span></code> rather than <code class="docutils literal notranslate"><span class="pre">INFO</span></code>, these messages can indicate a problem so we should be sure they are visible.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2828">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>For clarity, we renamed <code class="docutils literal notranslate"><span class="pre">ForwardingLockService</span></code> to <code class="docutils literal notranslate"><span class="pre">SimplifyingLockService</span></code>, since this class also overwrote some of its parent’s methods.
Also, its <code class="docutils literal notranslate"><span class="pre">delegate</span></code> method is now public.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2729">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Tritium was upgraded to 0.9.0 (from 0.8.4), which provides functionality for de-registration of tagged metrics.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2823">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-72-0">
<h2>v0.72.0<a class="headerlink" href="#v0-72-0" title="Permalink to this headline"></a></h2>
<p>13 December 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-metrics">METRICS</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Sweep metrics were reworked. Sweep now exposes metrics indicating the total number of cells examined, cells deleted, time spent sweeping, and time elapsed since sweep started on the current table that are updated after each iteration of sweep and separate metrics that are updated after each table is fully swept.
Additionally, sweep now exposes metrics tagged with table names that expose the total number of cells examined, cells deleted, time spent sweeping per iteration for each table separately.
Logs will also include the new timing information.
Sweep now exposes the following metrics with the common prefix <code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.sweep.metrics.SweepMetric.</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cellTimestampPairsExamined.meter.currentIteration</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cellTimestampPairsExamined.histogram.currentTable</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cellTimestampPairsExamined.histogram.currentIteration</span></code> (tagged)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">staleValuesDeleted.meter.currentIteration</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">staleValuesDeleted.histogram.currentTable</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">staleValuesDeleted.histogram.currentIteration</span></code> (tagged)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sweepTimeSweeping.meter.currentIteration</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sweepTimeSweeping.histogram.currentTable</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sweepTimeSweeping.histogram.currentIteration</span></code> (tagged)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sweepTimeElapsedSinceStart.currentValue.currentIteration</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sweepTimeElapsedSinceStart.histogram.currentTable</span></code></p></li>
</ul>
</div></blockquote>
<p>(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2672">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB now provides a configurable <code class="docutils literal notranslate"><span class="pre">compactInterval</span></code> (0 by default) option for Postgres, in the Postgres DDL Config.
A vacuum will be kicked off an a table only if there hasn’t been one on the same table in the last <code class="docutils literal notranslate"><span class="pre">compactInterval</span></code>.
This will prevent increasing load on Postgres due to queued up vacuums. We would suggest a value of 1-2 days (e.g. <code class="docutils literal notranslate"><span class="pre">2d</span></code> or <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">days</span></code>) for this config option
and would encourage users to test this out and report the results back. We will modify the defaults once this has been field tested.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2767">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">LeaderPingHealthCheck</span></code> supplied by <code class="docutils literal notranslate"><span class="pre">PaxosLeadershipCreator</span></code> now correctly reports the leadership state of nodes that believe themselves to be the leader.
Previously, the health check would ping every <em>other</em> node in the cluster, resulting in leader nodes reporting that there are no leaders.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2805">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug in LockServiceImpl (caused by a bug in AbstractQueuedSynchronizer) where a race condition could cause a lock to become stuck indefinitely.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2799">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Deleted the TTL duration field from the <code class="docutils literal notranslate"><span class="pre">Cell</span></code> class.
The interface <code class="docutils literal notranslate"><span class="pre">ExpiringKeyValueService</span></code> and implementations <code class="docutils literal notranslate"><span class="pre">CassandraExpiringKeyValueService</span></code> and <code class="docutils literal notranslate"><span class="pre">CqlExpiringKeyValueService</span></code> have also been removed.
Additionally, <code class="docutils literal notranslate"><span class="pre">StreamTableDefinitionBuilder.expirationStrategy</span></code> has been removed.
We don’t believe that any of these fields or classes were used.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2599">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-71-1">
<h2>v0.71.1<a class="headerlink" href="#v0-71-1" title="Permalink to this headline"></a></h2>
<p>8 December 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Removed an unused dependency from <code class="docutils literal notranslate"><span class="pre">atlasdb-api</span></code>, fixing a dependency clash in a downstream product.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2798">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-71-0">
<h2>v0.71.0<a class="headerlink" href="#v0-71-0" title="Permalink to this headline"></a></h2>
<p>7 December 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p><strong>AtlasDB QoS</strong>: AtlasDB now allows clients to live-reloadably configure read and write limits (in terms of bytes) to rate-limit requests to Cassandra.
AtlasDB clients will receive a <code class="docutils literal notranslate"><span class="pre">RateLimitExceededException</span></code> for requests that are throttled and should handle them appropriately.
We provide an exception mapper <code class="docutils literal notranslate"><span class="pre">RateLimitExceededExceptionMapper</span></code> to map the throttling exceptions to <code class="docutils literal notranslate"><span class="pre">429</span></code>, but it is upto the application to register the exception mapper.
Note that this is an experimental feature and applications should generally not enable it by default yet, unless the application has hard read-write limits.
This should allow us to throttle dynamically in situations where the load on Cassandra is high.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2629">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB publish of new releases is now done through the internal circleCI build instead of external circleCI.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2783">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB no longer logs Cassandra retries at level WARN, thus reducing the volume of WARN logs by a significant factor. These logs are now available at INFO.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2776">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Sweep can now make progress after a restore and after the clean transactions CLI is run.
Earlier, it would fail throwing a <code class="docutils literal notranslate"><span class="pre">NullPointerException</span></code> due to failure to read the commit ts.
This would cause sweep to keep retrying without realising that it will never proceed forward.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2778">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Sweep will no longer run during KVS Migrations.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2784">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Cassandra KVS now records how many writes have been made into each token range for each table.
That information is logged at info every time a table is written to more than a threshold of times (currently 100 000 writes).
These logs will be invaluable in more easily identifying hotspotting and for using targeted sweep.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2718">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>New metric added which reports the probability that a table is being written to unevenly.  <code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.keyvalue.cassandra.TokenRangeWritesLogger.probabilityDistributionIsNotUniform</span></code> is tagged with the table reference (where safe) and is a probability from 0.0 to 1.0 that the token ranges are being written to unevenly.  Cassandra KVS only.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2764">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TimeLockAgent</span></code> exposes a new method, <code class="docutils literal notranslate"><span class="pre">getStatus()</span></code>, to be used by the internal TimeLock instance in order to provide a health check.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2730">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Removed several utility methods that are used by AtlasDB code. <code class="docutils literal notranslate"><span class="pre">MathUtils</span></code> has been moved to our large internal product, which was the only place to use it.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MathUtils</span></code> (entire class)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IterableUtils</span></code> (<code class="docutils literal notranslate"><span class="pre">getFirst(it,</span> <span class="pre">defaultValue)</span></code>, <code class="docutils literal notranslate"><span class="pre">mergeIterators</span></code>, <code class="docutils literal notranslate"><span class="pre">partitionByHash</span></code>, <code class="docutils literal notranslate"><span class="pre">prepend</span></code>, <code class="docutils literal notranslate"><span class="pre">transformIterator</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IteratorUtils.iteratorDifference</span></code></p></li>
</ul>
</div></blockquote>
<p>(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2782">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Added a CLI to read the punch table. The CLI receives an epoch time, in millis, and returns an approximation of the AtlasDB timestamp strictly before the given timestamp.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2775">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-70-1">
<h2>v0.70.1<a class="headerlink" href="#v0-70-1" title="Permalink to this headline"></a></h2>
<p>30 November 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">TransactionManagers</span></code> builder now hooks up the metric registries passed in so that AtlasDB metrics are registered on the specified metric registries.
Applications no longer should use the <code class="docutils literal notranslate"><span class="pre">AtlasDbMetrics.setMetricRegistry</span></code> method to specify a metric registry for AtlasDB.</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">TransactionManagers</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
    <span class="p">.</span><span class="na">config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="p">.</span><span class="na">userAgent</span><span class="p">(</span><span class="s">&quot;ete test&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="na">globalMetricRegistry</span><span class="p">(</span><span class="k">new</span> <span class="n">MetricRegistry</span><span class="p">())</span>
    <span class="p">.</span><span class="na">globalTaggedMetricRegistry</span><span class="p">(</span><span class="n">DefaultTaggedMetricRegistry</span><span class="p">.</span><span class="na">getDefault</span><span class="p">())</span>
    <span class="p">.</span><span class="na">registrar</span><span class="p">(</span><span class="n">environment</span><span class="p">.</span><span class="na">jersey</span><span class="p">()::</span><span class="n">register</span><span class="p">)</span>
    <span class="p">.</span><span class="na">addAllSchemas</span><span class="p">(</span><span class="n">ETE_SCHEMAS</span><span class="p">)</span>
    <span class="p">.</span><span class="na">build</span><span class="p">()</span>
    <span class="p">.</span><span class="na">serializable</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p>(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2760">Pull Request</a>)</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="v0-70-0">
<h2>v0.70.0<a class="headerlink" href="#v0-70-0" title="Permalink to this headline"></a></h2>
<p>30 November 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>When BackgroundSweeper decides to sweep a StreamStore VALUE table, first sweep the respective StreamStore
INDEX table.
Before we just swept the VALUE table, which ended up not deleting any values in the backing store.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2756">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>The method <code class="docutils literal notranslate"><span class="pre">AtlasDbMetrics.setMetricsRegistries</span></code> was added, to register both the MetricRegistry and the TaggedMetricRegistry.
Please use it instead of the old <code class="docutils literal notranslate"><span class="pre">AtlasDbMetrics.setMetricsRegistry</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2720">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>All logging in <code class="docutils literal notranslate"><span class="pre">SnapshotTransaction</span></code> now marks its placeholder log arguments as either safe or unsafe.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2755">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The previously deprecated <code class="docutils literal notranslate"><span class="pre">TransactionManagers.create()</span></code> methods have been removed.
To create a <code class="docutils literal notranslate"><span class="pre">SerializableTransactionManager</span></code> please use the <code class="docutils literal notranslate"><span class="pre">TransactionManagers.builder()</span></code> to create a <code class="docutils literal notranslate"><span class="pre">TransactionManagers</span></code> object and then call its <code class="docutils literal notranslate"><span class="pre">serializable()</span></code> method.
Furthermore, this builder now requires a <code class="docutils literal notranslate"><span class="pre">taggedMetricRegistry</span></code> argument, and is a staged builder, requiring all mandatory parameters to be specified in the following order:
<code class="docutils literal notranslate"><span class="pre">TransactionManagers.config().userAgent().metricRegistry().taggedMetricRegistry()</span></code>.
This avoid runtime errors due to failure to specify all required arguments.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2720">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug where setting <code class="docutils literal notranslate"><span class="pre">compressBlocksInDb</span></code> for stream store definitions would result in a much bigger than intended block size.
This option is also deprecated, as we recommend <code class="docutils literal notranslate"><span class="pre">compressStreamsInClient</span></code> instead.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2752">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an edge case where sweep would loop infinitely on tables that contained only tombstones.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2744">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MetricsManager</span></code> no longer outputs stack traces to WARN when a metric is registered for a second time.
The stack trace can still be accessed by turning on TRACE logging for <code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.util.MetricsManager</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2753">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>AtlasDB now wraps <code class="docutils literal notranslate"><span class="pre">NotCurrentLeaderException</span></code> in <code class="docutils literal notranslate"><span class="pre">AtlasDbDependencyException</span></code> when this exception is thrown by TimeLock.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2716">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Sweep no longer fetches any values from Cassandra in CONSERVATIVE mode. This results in significantly less data being transferred from Cassandra to the client when sweeping tables with large values, such as stream store tables.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2754">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-69-0">
<h2>v0.69.0<a class="headerlink" href="#v0-69-0" title="Permalink to this headline"></a></h2>
<p>23 November 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed the deletion of values from the StreamStore when configured to hash rowComponents.
Previously, due to a deserialization bug, we wouldn’t delete the streamed data.
If you think you’re affected by this bug, please contact the AtlasDB team to migrate away from this behavior.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2736">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>We now avoid Cassandra timeouts caused by running unbounded CQL range scans during sweep.
In order to assign a bound, we prefetch row keys using thrift, and use these bounds to page internally through rows.
This issue affected tables configured to use THOROUGH sweep strategy — which could accumulate many rows entirely made up of tombstones —
when Cassandra is configured as the backing store.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2732">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Applications can now easily determine whether their AtlasDB cluster is healthy by querying <code class="docutils literal notranslate"><span class="pre">TransactionManager.getKeyValueServiceStatus().isHealthy()</span></code>.
This returns true only if all key value service nodes are up; applications that have sweep and scrub disabled and do not perform schema mutations
can also treat <code class="docutils literal notranslate"><span class="pre">KeyValueServiceStatus.HEALTHY_BUT_NO_SCHEMA_MUTATIONS_OR_DELETES</span></code> as a healthy state.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2678">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>AtlasDB will now consistently throw an <code class="docutils literal notranslate"><span class="pre">AtlasDbDependencyException</span></code> when requests fail due to TimeLock being unavailable.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2677">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Throwables.createPalantirRuntimeException</span></code> once again throws <code class="docutils literal notranslate"><span class="pre">PalantirInterruptedException</span></code> if the original exception was either <code class="docutils literal notranslate"><span class="pre">InterruptedException</span></code> or <code class="docutils literal notranslate"><span class="pre">InterruptedIOException</span></code>.
This reverts behaviour introduced in 0.67.0, where we instead threw <code class="docutils literal notranslate"><span class="pre">PalantirRuntimeException</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2702">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Sweep now waits 1 day after generating a large number of tombstones before sweeping a table again. This behavior only applies when using Cassandra.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2733">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">CassandraKeyValueServiceImpl.compactInternally</span></code> no longer logs an error when no compaction manager is configured.
This message is instead logged once, when the CKVS is instantiated.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2727">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-68-0">
<h2>v0.68.0<a class="headerlink" href="#v0-68-0" title="Permalink to this headline"></a></h2>
<p>16 November 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>HTTP clients for endpoints relating to the Paxos protocols (<code class="docutils literal notranslate"><span class="pre">PingableLeader</span></code>, <code class="docutils literal notranslate"><span class="pre">PaxosAcceptor</span></code> and <code class="docutils literal notranslate"><span class="pre">PaxosLearner</span></code>) now reset themselves after 500 million requests have been executed.
This was implemented as a workaround for <a class="reference external" href="https://github.com/square/okhttp/issues/3670">OkHttp #3670</a> where HTTP/2 connections managed in OkHttp would fail after just over a billion requests owing to an unexpected integer overflow.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2680">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-67-0">
<h2>v0.67.0<a class="headerlink" href="#v0-67-0" title="Permalink to this headline"></a></h2>
<p>15 November 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB clients are now able to live reload TimeLock URLs.
This is required for internal work on running services in Kubernetes.
We still require that clients are configured to use TimeLock (as opposed to a leader, remote timestamp/lock or embedded service) at install time.
Note that this change does not affect TimeLock Server, which still requires knowledge of the entire cluster as well.
Please consult the <a class="reference internal" href="../configuration/external_timelock_service_configs/timelock_client_config.html#timelock-client-configuration"><span class="std std-ref">documentation</span></a> for more detail regarding the config changes needed.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2621">Pull Request 1</a> and
<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2622">Pull Request 2</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-deprecated">DEPRECATED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">servers</span></code> block within an AtlasDB <code class="docutils literal notranslate"><span class="pre">timelock</span></code> block is now deprecated.
Please use the live-reloadable <code class="docutils literal notranslate"><span class="pre">servers</span></code> block within the <code class="docutils literal notranslate"><span class="pre">timelockRuntime</span></code> block of the runtime configuration instead.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2622">Pull Request 2</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB clients using TimeLock can now start up with knowledge of zero TimeLock nodes.
Requests to TimeLock will throw <code class="docutils literal notranslate"><span class="pre">ServiceUnavailableException</span></code> until the config is live reloaded with one or more nodes.
If live reloading causes the number of nodes to fall to zero, we also fail gracefully; <code class="docutils literal notranslate"><span class="pre">ServiceUnavailableException</span></code> will be thrown until the config is live reloaded with one or more nodes.
Note that this does not affect remote timestamp, lock or leader configurations; those still require at least one server.
Also, note that if one is using TimeLock without async initialization, then one still needs to provide information about the TimeLock cluster on startup.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2647">Pull Request 3</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ServerListConfig</span></code> can now be created with zero servers, as part of work supporting Atlas clients starting up without knowing TimeLock nodes.
This is strictly more permissive, but may affect developers that use <code class="docutils literal notranslate"><span class="pre">ServerListConfig</span></code> directly, especially if it is being serialized.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2647">Pull Request 3</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>kvs-slow-log was added on all Cassandra calls. As with the original kvs-slow-log logs, the added logs have the <code class="docutils literal notranslate"><span class="pre">kvs-slow-log</span></code> origin.
To see the exact log messages, check the <code class="docutils literal notranslate"><span class="pre">ProfilingCassandraClient</span></code> class.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2673">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Metrics were added on all Cassandra calls. The <code class="docutils literal notranslate"><span class="pre">CassandraClient</span></code> interface was Tritium instrumented.
The following metrics have been added, with the common prefix (package) <code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.keyvalue.cassandra.</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CassandraClient.multiget_slice</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CassandraClient.get_range_slices</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CassandraClient.batch_mutate</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CassandraClient.get</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CassandraClient.cas</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CassandraClient.execute_cql3_query</span></code></p></li>
</ul>
</div></blockquote>
<p>Note that the table calls mainly use the first three metrics of the above list.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2673">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Metrics recording the number of Cassandra requests, and the amount of bytes read and written from and to Cassandra were added:
The following metrics have been added, with the common prefix (package) <code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.keyvalue.cassandra.</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">QosMetrics.numReadRequests</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QosMetrics.numWriteRequests</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QosMetrics.bytesRead</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QosMetrics.bytesWritten</span></code></p></li>
</ul>
</div></blockquote>
<p>(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2679">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Added metrics for cells read.
The read cells can be post-filtered at the CassandraKVS layer, when there are multiple versions of the same cell.
The filtered cells are recorded in the following metrics have been added, with the common prefix (package) <code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.keyvalue.cassandra.</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TimestampExtractor.notLatestVisibleValueCellFilterCount</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ValueExtractor.notLatestVisibleValueCellFilterCount</span></code></p></li>
</ul>
</div></blockquote>
<p>The cells returned from the KVS layer are then recorded at the metric with the prefix (package) <code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.transaction.impl.</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SnapshotTransaction.numCellsRead</span></code></p></li>
</ul>
</div></blockquote>
<p>Such cells can also be filtered out at the transaction layer, due to the Transaction Protocol. The filtered out cells are recorded in the metrics:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SnapshotTransaction.commitTsGreaterThatTxTsCellFilterCount</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SnapshotTransaction.invalidStartTsTsCellFilterCount</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SnapshotTransaction.invalidCommitTsCellFilterCount</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SnapshotTransaction.emptyValuesCellFilterCount</span></code></p></li>
</ul>
</div></blockquote>
<p>At last, the metric that record the number of cells actually returned to the AtlasDB client is:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SnapshotTransaction.numCellsReturnedAfterFiltering</span></code></p></li>
</ul>
</div></blockquote>
<p>(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2671">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Added metrics for written bytes at the Transaction layer:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.transaction.impl.SnapshotTransaction.bytesWritten</span></code></p></li>
</ul>
</div></blockquote>
<p>(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2671">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>A metric was added for the cases where a large read was made:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.transaction.impl.SnapshotTransaction.tooManyBytesRead</span></code></p></li>
</ul>
</div></blockquote>
<p>Note that we also log a warning in these cases, with the message “A single get had quite a few bytes…”.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2671">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>AtlasDB will now consistently throw a <code class="docutils literal notranslate"><span class="pre">InsufficientConsistencyException</span></code> if Cassandra reports an <code class="docutils literal notranslate"><span class="pre">UnavailableException</span></code>.
Also, all exceptions thrown at the KVS layer, as <code class="docutils literal notranslate"><span class="pre">KeyAlreadyExists</span></code> or <code class="docutils literal notranslate"><span class="pre">TTransportException</span></code> and <code class="docutils literal notranslate"><span class="pre">NotInitializedException</span></code>
were wrapped in <code class="docutils literal notranslate"><span class="pre">AtlasDbDependencyException</span></code> in the interest of consistent exceptions.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2558">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SweeperServiceImpl</span></code> now logs when it starts sweeping and makes it clear if it is running full sweep or not
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2618">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MetricsManager</span></code> now logs failures to register metrics at <code class="docutils literal notranslate"><span class="pre">WARN</span></code> instead of <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>, as failure to do so is not necessarily a systemic failure.
Also, we now log the name of the metric as a Safe argument (previously it was logged as Unsafe).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2636">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SweepBatchConfig</span></code> values are now decayed correctly when there’s an error.
<code class="docutils literal notranslate"><span class="pre">SweepBatchConfig</span></code> should be decreased until sweep succeeds, however the config actually oscillated between values, these were normally small but could be larger than the original config.  This was caused by us fixing one of the values at 1.
<code class="docutils literal notranslate"><span class="pre">SweepBatchConfig</span></code> values will now be halved with each failure until they reach 1 (previously they only went to about 30% due to another bug).  This ensures we fully backoff and gives us the best possible chance of success.  Values will slowly increase with each successful run until they are back to their default level.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2630">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB now depends on Tritium 0.8.4, which depends on the same version of <code class="docutils literal notranslate"><span class="pre">com.palantir.remoting3</span></code> and <code class="docutils literal notranslate"><span class="pre">HdrHistogram</span></code> as AtlasDB.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2662">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Check that immutable timestamp is locked on write transactions with no writes.
This could cause long-running readers to read an incorrect empty value when the table had the <code class="docutils literal notranslate"><span class="pre">Sweep.THOROUGH</span></code> strategy.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2406">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Paxos value information is now correctly being logged when applicable leader events are happening.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2674">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-66-0">
<h2>v0.66.0<a class="headerlink" href="#v0-66-0" title="Permalink to this headline"></a></h2>
<p>7 November 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB now depends on Tritium 0.8.3, allowing products to upgrade Tritium without running into <code class="docutils literal notranslate"><span class="pre">NoClassDefFound</span></code> and <code class="docutils literal notranslate"><span class="pre">NoSuchField</span></code> errors.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2642">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-66-0-rc2">
<h2>v0.66.0-rc2<a class="headerlink" href="#v0-66-0-rc2" title="Permalink to this headline"></a></h2>
<p>6 November 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB now depends on Tritium 0.8.1.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2639">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB can now tag RC releases.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2641">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-66-0-rc1">
<h2>v0.66.0-rc1<a class="headerlink" href="#v0-66-0-rc1" title="Permalink to this headline"></a></h2>
<p>This version was skipped due to issues on release. No artifacts with this version were ever published.</p>
</section>
<section id="v0-65-2">
<h2>v0.65.2<a class="headerlink" href="#v0-65-2" title="Permalink to this headline"></a></h2>
<p>6 November 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Reverted the Cassandra KVS executor PR (<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2534">Pull Request</a>) that caused a performance regression.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2637">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">CassandraTimestampBackupRunner</span></code> now logs the backup bound correctly when performing a backup as part of TimeLock migration.
Previously, the bound logged would have been logged as <code class="docutils literal notranslate"><span class="pre">null</span></code> or as a relatively arbitrary byte array, depending on the content of the timestamp table when performing migration.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2585">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-65-1">
<h2>v0.65.1<a class="headerlink" href="#v0-65-1" title="Permalink to this headline"></a></h2>
<p>4 November 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB now depends on Tritium 0.8.0, allowing products to upgrade Tritium without running into <code class="docutils literal notranslate"><span class="pre">NoClassDefFound</span></code> errors.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2628">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Sweep is now more efficient and less susceptible to OOMs on Cassandra.
Also, the default value for the sweep batch config parameter <code class="docutils literal notranslate"><span class="pre">candidateBatchSize</span></code> has been bumped up from <code class="docutils literal notranslate"><span class="pre">1</span></code> from <code class="docutils literal notranslate"><span class="pre">1024</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2546">Pull Request</a>)
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2610">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed cursor leak when sweeping on oracle/postgres.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2609">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Sweep progress is now persisted as a blob and uses a KVS level table.
This allows us to use check and set to avoid versioning the entries in the sweep progress table.
As a result, loading of the persisted SweepResult which was previously linear in the size of the table being swept can be done in constant time.
No migration is necessary as the data is persisted to a new table <code class="docutils literal notranslate"><span class="pre">_sweep_progress2</span></code>, however, sweep will ignore any previously persisted sweep progress.
Note that this in particular means that any in-progress sweep will be abandoned and background sweep will choose a new table to sweep.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2569">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>AtlasDB tables will now be logged as <code class="docutils literal notranslate"><span class="pre">ns.tablename</span></code> instead of <code class="docutils literal notranslate"><span class="pre">map[namespace:map[name:ns]</span> <span class="pre">tablename:tablename]</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2606">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>TracingKVS now has spans with safe names.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2643">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-65-0">
<h2>v0.65.0<a class="headerlink" href="#v0-65-0" title="Permalink to this headline"></a></h2>
<p>This version was skipped due to issues on release. No artifacts with this version were ever published.</p>
</section>
<section id="v0-64-0">
<h2>v0.64.0<a class="headerlink" href="#v0-64-0" title="Permalink to this headline"></a></h2>
<p>1 November 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>UUIDs can now be used in schemas again.
Previously, schemas generated with UUIDs would reference the <code class="docutils literal notranslate"><span class="pre">java.util.UUID</span></code> class without importing it.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2589">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The executor used by the Cassandra KVS is now allowed to grow larger so that we can better delegate blocking to the underlying Cassandra client pools.
Please note that for Cassandra users this may result in increased Atlas thread counts when receiving spikes in requests.
The underlying throttling is the same, however, so Cassandra load shouldn’t be impacted.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2534">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BackgroundSweeperImpl</span></code> now records additional metrics on how each run of sweep went.
Metrics report the number of occurrences of each outcome in the 1 minute prior to the metrics being gathered.
We may change this duration in the future.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2531">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Log host names in Cassandra* classes.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2592">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The executors used when async initializing objects are never shutdown anymore.
You should be affected by this bug only if you had <code class="docutils literal notranslate"><span class="pre">AtlasDbConfig.initializeAsync</span> <span class="pre">=</span> <span class="pre">true</span></code>.
Previously, we would shut down the executors after a successful initialization, which could lead to a race condition with the submission of a <code class="docutils literal notranslate"><span class="pre">cancelInitialization</span></code> task.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2547">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-63-0">
<h2>v0.63.0<a class="headerlink" href="#v0-63-0" title="Permalink to this headline"></a></h2>
<p>27 October 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed the deprecated <code class="docutils literal notranslate"><span class="pre">TransactionManagers.create</span></code> methods, by specifying a default user agent if none was provided.
Previously, <code class="docutils literal notranslate"><span class="pre">TransactionManager</span></code> creation would have failed at runtime.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2582">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Metrics are now recorded for put/get operations around commit timestamps.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2561">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-62-1">
<h2>v0.62.1<a class="headerlink" href="#v0-62-1" title="Permalink to this headline"></a></h2>
<p>27 October 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Updated our dependency on <code class="docutils literal notranslate"><span class="pre">http-remoting</span></code> to version <code class="docutils literal notranslate"><span class="pre">3.5.1</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2574">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-62-0">
<h2>v0.62.0<a class="headerlink" href="#v0-62-0" title="Permalink to this headline"></a></h2>
<p>26 October 2017</p>
<p>Improvements</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">getRange</span></code> is now more efficient when scanning over rows with many updates in Cassandra if just a single column is requested.
Previously, a range request in Cassandra would always retrieve all columns and all historical versions of each column, regardless of which columns were requested.
Now, we only request the latest version of the specific column requested, if only one column is requested. Requesting multiple columns still results in the previous behavior, however this will also be optimized in a future release.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2480">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-deprecated">DEPRECATED</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SerializableTransactionManager</span></code> is now created via an immutable builder instead of a long list of individual arguments. Use <code class="docutils literal notranslate"><span class="pre">TransactionManagers.builder()</span></code>
to get the builder and once completely configured, build the transaction manager via the builder’s <code class="docutils literal notranslate"><span class="pre">.buildSerializable()</span></code> method.
The existing <code class="docutils literal notranslate"><span class="pre">create</span></code> methods are deprecated and will be removed by November 15th, 2017.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2459">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TransactionManagers.builder()</span></code> no longer has a <code class="docutils literal notranslate"><span class="pre">callingClass(..)</span></code> method and now requires the consumer to directly specify their user agent via the previously optional method <code class="docutils literal notranslate"><span class="pre">userAgent(..)</span></code>.
All of the <code class="docutils literal notranslate"><span class="pre">TransactionManagers.create(..)</span></code> methods are still deprecated, and can be used to specify an empty user-agent.
We use the user-agent on logs and metrics, so specifying it helps us to diagnose issues in the future.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2542">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The duration between attempts of whitelist Cassandra nodes was reduced from 5 minutes to 2 minutes, and the minimum period a node is blacklisted for was reduced from 2 minutes to 30 seconds.
This means we check the health of a blacklisted Cassandra node and whitelist it faster than before.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2543">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The size of the transaction cache is now configurable. It is not anticipated end users will need to touch this;
it is more likely that this will be configured via per-service overrides for the services for whom the
current cache size is inadequate. If needed, configuring this parameter is available under the AtlasDbRuntimeConfig with the name <cite>timestampCacheSize</cite>.</p>
<p>This is a small API change for users manually constructing a TransactionManager, which now requires a transaction cache size parameter.
Please add it from the AtlasDbRuntimeConfig, or instead of manually creating a TransactionManager,
utilize the builder in TransactionManagers to have this done for you.</p>
<p>Note that even if the config is changed at runtime, the size of the cache doesn’t change dynamically until <a class="reference external" href="https://github.com/palantir/atlasdb/issues/2565">2565</a> is resolved.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2496">Pull Request 1</a>)
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2554">Pull Request 2</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Exposes another version of <code class="docutils literal notranslate"><span class="pre">getRanges</span></code> that uses a configurable concurrency level when not explicitly
provided a value. This defaults to 8 and can be configured with the <code class="docutils literal notranslate"><span class="pre">KeyValueServiceConfig#defaultGetRangesConcurrency</span></code> parameter.
Check the full configuration docs <a class="reference external" href="https://palantir.github.io/atlasdb/html/configuration/key_value_service_configs/index.html">here</a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2484">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Simplify and annotate the constructors for <code class="docutils literal notranslate"><span class="pre">SerializableTransactionManager</span></code>. This should make the code of that class more maintainable.
If you used one of the deleted or deprecated constructors, use the static <code class="docutils literal notranslate"><span class="pre">create</span></code> method.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2549">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
<p>Logs and Metrics</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SweepMetrics</span></code> are now updated at the end of every batch rather than cumulative metrics at the end of every table.
This will provide more accurate metrics for when sweep is doing something.
Sweeping through the sweep endpoint will now also contribute to these metrics — before it didn’t update any metrics which again distorted the view of what work sweep was doing on the DB.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2535">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>AtlasDB clients now emit metrics that track the immutable timestamp, unreadable timestamp, and current timestamp.
These metrics should help in performing diagnosis of issues concerning Sweep and/or the lock service.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2467">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>Timelock server no longer appends client names to metrics. Instead, each metric is aggregated across all clients.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2501">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p>We now report metrics for Transaction conflicts.
The metrics are a meter reported under the name <code class="docutils literal notranslate"><span class="pre">SerializableTransaction.SerializableTransactionConflict</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2540">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Specified which logs from Cassandra* classes were Safe or Unsafe for collection, improving the data that we can collect for debugging purposes.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2537">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">USER BREAK</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">ProfilingKeyValueService</span></code> now reports its multipart log lines as a single line.
This should improve log readability in log ingestion tools when AtlasDB is run in multithreaded environments.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2474">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>TimeLock Server’s <code class="docutils literal notranslate"><span class="pre">ClockSkewMonitor</span></code> now attempts to contact all other nodes in the TimeLock cluster, even in the presence of remoting exceptions or clock skews.
Previously, we would stop querying nodes once we encountered a remoting exception or detected clock skew.
Also, the log line <code class="docutils literal notranslate"><span class="pre">ClockSkewMonitor</span> <span class="pre">threw</span> <span class="pre">an</span> <span class="pre">exception</span></code> which was previously logged every second when a TimeLock node was down or otherwise uncontactable is now restricted to once every 10 minutes.
Note that the <code class="docutils literal notranslate"><span class="pre">clock.monitor-exception</span></code> metric is still incremented on every call, even if we do not log.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2456">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ProfilingKeyValueService</span></code> now logs correctly when logging a message for <code class="docutils literal notranslate"><span class="pre">getRange</span></code>, <code class="docutils literal notranslate"><span class="pre">getRangeOfTimestamps</span></code> and <code class="docutils literal notranslate"><span class="pre">deleteRange</span></code>.
Previously, the table reference was omitted, such that one might receive lines of the form <code class="docutils literal notranslate"><span class="pre">Call</span> <span class="pre">to</span> <span class="pre">KVS.getRange</span> <span class="pre">on</span> <span class="pre">table</span> <span class="pre">RangeRequest{reverse=false}</span> <span class="pre">with</span> <span class="pre">range</span> <span class="pre">1504</span> <span class="pre">took</span> <span class="pre">{}</span> <span class="pre">ms.</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2474">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-metrics">METRICS</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">MetricsManager</span></code> now supports de-registration of metrics for a given prefix.
Previously, this would crash with a <code class="docutils literal notranslate"><span class="pre">ConcurrentModificationException</span></code> if metrics were actually being removed.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2467">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
<p>Bug fixes</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ProfilingKeyValueService</span></code> now logs correctly when logging a message for <code class="docutils literal notranslate"><span class="pre">getRange</span></code>, <code class="docutils literal notranslate"><span class="pre">getRangeOfTimestamps</span></code> and <code class="docutils literal notranslate"><span class="pre">DeleteRange</span></code>.
Previously, the table reference was omitted, such that one might receive lines of the form <code class="docutils literal notranslate"><span class="pre">Call</span> <span class="pre">to</span> <span class="pre">KVS.getRange</span> <span class="pre">on</span> <span class="pre">table</span> <span class="pre">RangeRequest{reverse=false}</span> <span class="pre">with</span> <span class="pre">range</span> <span class="pre">1504</span> <span class="pre">took</span> <span class="pre">{}</span> <span class="pre">ms.</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2474">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>When AtlasDB thinks all Cassandra nodes are non-healthy, it logs a message containing “There are no known live hosts in the connection pool … We’re choosing one at random …”.
The level of this log was reduced from ERROR to WARN, as it was spammy in periods of a Cassandra outage.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2543">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Timelock server will try to gain leadership synchronously when the first time a new client namespace is requested. Previously, the first request would always return 503.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2503">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SerializableErrorDecoder</span></code> will decode errors properly instead of throwing <code class="docutils literal notranslate"><span class="pre">NullPointerException</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2446">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Async Initialization now works with TimeLock Server.
Previously, for Cassandra we would attempt to immediately migrate the timestamp bound from Cassandra to TimeLock on startup, which would fail if either of them was unavailable.
For DBKVS or other key-value services, we would attempt to ping TimeLock on startup, which would fail if TimeLock was unavailable (though the KVS need not be available).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2520">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">AsyncInitializer</span></code> now shuts down its executor after initialization has completed.
Previously, the executor service wasn’t shut down, which could lead to the initializer thread hanging around unnecessarily.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2520">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue where a <code class="docutils literal notranslate"><span class="pre">waitForLocks</span></code> request could retry unnecessarily.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2491">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">InMemoryAtlasDbConfig</span></code> now has an empty namespace, instead of “test”.
This means that internal products will no longer have to set their root-level namespace to “test” in order to use <code class="docutils literal notranslate"><span class="pre">InMemoryKeyValueService</span></code> for testing.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2541">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Move <code class="docutils literal notranslate"><span class="pre">&#64;CancelableServerCall</span></code> to a more fitting package that matches internal codebase.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2562">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-61-1">
<h2>v0.61.1<a class="headerlink" href="#v0-61-1" title="Permalink to this headline"></a></h2>
<p>19 October 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Reverted the Sweep rewrite for Cassandra as it would unnecessarily load values into memory which could
cause Cassandra to OOM if the values are large enough.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2521">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-61-0">
<h2>v0.61.0<a class="headerlink" href="#v0-61-0" title="Permalink to this headline"></a></h2>
<p>18 October 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Sweep is now more efficient on Postgres and Oracle.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2436">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">SweeperService</span></code> endpoint registered on all clients will now sweeps the full table by default, rather than a single batch.
It also now returns information about how much data was swept.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2409">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>Sweep candidate batches are now logged correctly.
Previously, we would log a <code class="docutils literal notranslate"><span class="pre">SafeArg</span></code> for these batches that had no content.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2475">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-60-1">
<h2>v0.60.1<a class="headerlink" href="#v0-60-1" title="Permalink to this headline"></a></h2>
<p>16 October 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB now supports asynchronous initialization, where <code class="docutils literal notranslate"><span class="pre">TransactionManagers.create()</span></code> creates a <code class="docutils literal notranslate"><span class="pre">SerializableTransactionManager</span></code> even when initialization fails, for instance because the KVS is not up yet.</p>
<p>To enable asynchronous initialization, a new config option <code class="docutils literal notranslate"><span class="pre">initializeAsync</span></code> was added to AtlasDbConfig.
If this option is set to true, <code class="docutils literal notranslate"><span class="pre">TransactionManagers.create()</span></code> first attempts to create a <code class="docutils literal notranslate"><span class="pre">SerializableTransactionManager</span></code> synchronously, i.e., consistent with current behaviour.
If this fails, it returns a <code class="docutils literal notranslate"><span class="pre">SerializableTransactionManager</span></code> for which the necessary initialization is scheduled in the background and which throws a <code class="docutils literal notranslate"><span class="pre">NotInitializedException</span></code> on any method call until the initialization completes - this is, until the backing store becomes available.</p>
<p>While waiting for AtlasDB to be ready, clients can poll <code class="docutils literal notranslate"><span class="pre">isInitialized()</span></code> on the returned <code class="docutils literal notranslate"><span class="pre">SerializableTransactionManager</span></code>.</p>
<p>The default value for the config  is <code class="docutils literal notranslate"><span class="pre">false</span></code> in order to preserve previous behaviour.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2390">Pull Request 1</a> and
<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2476">Pull Request 2</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Timelock server can now be configured to persist the timestamp bound in the database, specifically in Cassandra/Postgres/Oracle.
We recommend this to be configured only for cases where you absolutely need to persist all state in the database, for example,
in special cases where backups are simply database dumps and do not have any mechanism for storing timestamps.
This will help support large internal product’s usage of the Timelock server.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2364">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>In order to limit the access to inner methods, and to make the implementation of asynchronous initialization feasible, we’ve extracted interfaces and renamed the following classes:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CassandraClientPool</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CassandraKeyValueService</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LockStore</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PersistentTimestampService</span></code></p></li>
</ul>
</div></blockquote>
<p>Now the factory methods for the above classes return the interfaces. The actual implementation of such classes was moved to their corresponding *Impl files.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2390">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LockRefreshingTimelockService</span></code> has been moved to the <code class="docutils literal notranslate"><span class="pre">lock-api</span></code> project under the package name <code class="docutils literal notranslate"><span class="pre">com.palantir.lock.client</span></code>, and now implements
<code class="docutils literal notranslate"><span class="pre">AutoCloseable</span></code>, shutting down its internal executor service.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2451">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PersistentLockManager</span></code> can now reacquire the persistent lock if another process unilaterally clears the lock.
Previously in this case, sweep would continually fail to acquire the lock until the service restarts.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2419">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">CassandraClientPool</span></code> no longer logs stack traces twice for every failed attempt to connect to Cassandra.
Instead, the exception is logged once only, when we run out of retries.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2432">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The Sweep endpoint and CLI now accept start rows regardless of the case these are presented in.
Previously, giving a start row with hex characters in lower case e.g. <code class="docutils literal notranslate"><span class="pre">deadbeef</span></code> would result in an <code class="docutils literal notranslate"><span class="pre">IllegalArgumentException</span></code> being thrown.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2468">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Removed the following unnecessary classes related to wrapping KVSes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">NamespacedKeyValueService</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NamespaceMappingKeyValueService</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NamespacedKeyValueServices</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">StaticTableMappingService</span></code></p></li>
</ul>
<p>(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2448">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Lock state logging will dump <code class="docutils literal notranslate"><span class="pre">expiresIn</span></code> of refreshed token, instead of original, which was negative after refreshing.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2469">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>When using the TimeLock block and either the timestamp or the lock service threw an exception, we were throwing InvocationTargetException instead.
We now throw the actual cause for the invocation exception.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2460">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-60-0">
<h2>v0.60.0<a class="headerlink" href="#v0-60-0" title="Permalink to this headline"></a></h2>
<p>This version was skipped due to issues on release. No artifacts with this version were ever published.</p>
</section>
<section id="v0-59-1">
<h2>v0.59.1<a class="headerlink" href="#v0-59-1" title="Permalink to this headline"></a></h2>
<p>04 October 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Allow passing a <a class="reference external" href="https://github.com/palantir/conjure-java-runtime-api/blob/2.3.0/service-config/src/main/java/com/palantir/conjure/java/api/config/service/ProxyConfiguration.java">ProxyConfiguration</a> to allow setting custom proxy on the TimeLock clients.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2393">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-59-0">
<h2>v0.59.0<a class="headerlink" href="#v0-59-0" title="Permalink to this headline"></a></h2>
<p>04 October 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Timestamp batching has now been enabled by default.
Please see <a class="reference internal" href="../configuration/timestamp_client.html#timestamp-client-config"><span class="std std-ref">Timestamp Client Options</span></a> for details.
This should improve throughput and latency, especially if load is heavy and/or clients are communicating with a TimeLock cluster which is used by many services.
Note that there may be an increase in latency under light load (e.g. 2-4 threads).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2392">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now offers a simplified version of the schema API by setting the <code class="docutils literal notranslate"><span class="pre">enableV2Table()</span></code> flag in your TableDefinition.
This would generate an additional table class with some easy to use functions such as <code class="docutils literal notranslate"><span class="pre">putColumn(key,</span> <span class="pre">value)</span></code>, <code class="docutils literal notranslate"><span class="pre">getColumn(key)</span></code>, <code class="docutils literal notranslate"><span class="pre">deleteColumn(key)</span></code>.
We only provide these methods for named columns, and don’t currently support dynamic columns.
You can add this to your current Schema, and use the new simplified APIs by using the V2 generated table.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2401">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now offers specifying <code class="docutils literal notranslate"><span class="pre">hashFirstNRowComponents(n)</span></code> in Table and Index definitions.
This prevents hotspotting by prepending the hashed concatenation of the row components to the row key.
When using with prefix range requests, the hashed components must also be specified in the prefix.
Adding this to an existing Schema is not supported, as that would require a data migration.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2384">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now offers specifying <code class="docutils literal notranslate"><span class="pre">hashRowComponents()</span></code> in StreamStore definitions.
This prevents hotspotting in Cassandra by prepending the hashed concatenation of the <code class="docutils literal notranslate"><span class="pre">streamId</span></code> and <code class="docutils literal notranslate"><span class="pre">blockId</span></code> to the row key.
Adding this to an existing StreamStore is not supported, as that would require a data migration.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2384">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">lock/log-current-state</span></code> endpoint now correctly logs the number of outstanding lock requests.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2396">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed migration from JDBC KeyValueService by adding a missing dependency to the CLI distribution.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2397">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Oracle auto-shrink is now disabled by default.
This is an experimental feature allowing Oracle non-EE users to compact automatically.
We decided to turn it off by default since we have observed timeouts for large amounts of data, until we find a better retry mechanism for shrink failures.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2405">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-logs">LOGS</span> <span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>AtlasDB no longer tries to register Cassandra metrics for each pool with the same names.
We now add <cite>poolN</cite> to the metric name in CassandraClientPoolingContainer, where N is the pool number.
This will prevent spurious stacktraces in logs due to failure in registering metrics with the same name.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2415">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Adjusted the remoting-api library version to match the version used by remoting3.
Developers may need to check your dependencies, but no other actions should be required.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2399">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Adjusted optimizer hints for getRange() to prevent Oracle from picking a bad query plan.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2421">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-58-0">
<h2>v0.58.0<a class="headerlink" href="#v0-58-0" title="Permalink to this headline"></a></h2>
<p>22 September 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-logs">LOGS</span></p></td>
<td><p>AtlasDB now logs slow queries CQL queries (via <code class="docutils literal notranslate"><span class="pre">kvs-slow-log</span></code>) used for sweep
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2363">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB now depends on okhttp 3.8.1. This is expected to fix an issue where connections would constantly throw “shutdown” exceptions, which was likely due to a documented bug in okhttp 3.4.1.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2343">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Upgraded all uses of <a class="reference external" href="https://github.com/palantir/http-remoting">http-remoting</a> from remoting2 to remoting3, except for serialization of errors (preserved for backwards wire compatibility).
Developers may need to check their dependencies, as well as update instantiation of their calls to <code class="docutils literal notranslate"><span class="pre">TransactionManagers.create()</span></code> to use the remoting3 API.
Note that <em>users</em> of AtlasDB clients are not affected, in that the wire format of configuration files has not changed.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2348">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>KVS migration no longer fails when the old <code class="docutils literal notranslate"><span class="pre">_scrub</span></code> table is present.
This unblocks KVS migrations for users who have data in <code class="docutils literal notranslate"><span class="pre">_scrub</span></code> but have not migrated from <code class="docutils literal notranslate"><span class="pre">_scrub</span></code> to <code class="docutils literal notranslate"><span class="pre">_scrub2</span></code> yet.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2362">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Path and query parameters for TimeLock endpoints have now been marked as safe.
Several logging parameters in TimeLock (e.g. in <code class="docutils literal notranslate"><span class="pre">PaxosTimestampBoundStore</span></code> and <code class="docutils literal notranslate"><span class="pre">PaxosSynchronizer</span></code>) have also been marked as safe.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2375">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">LockServiceImpl</span></code> now, in addition to lock tokens and grants (which are unsafe for logging), also logs token and grant IDs (which are big-integer IDs) as safe.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2375">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Sweep log priority has been increased to INFO for logs of when a table 1. is starting to be swept, 2. will be swept with another batch, and 3. has just been completely swept.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2378">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-57-0">
<h2>v0.57.0<a class="headerlink" href="#v0-57-0" title="Permalink to this headline"></a></h2>
<p>19 September 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-metrics">METRICS</span> <span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>From this version onwards, AtlasDB’s metrics no longer have unbounded multiplicity.
This means that AtlasDB can be whitelisted in the internal metrics aggregator tool.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-metrics">METRICS</span> <span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>AtlasDB no longer embeds Cassandra host names in its metrics.
Aggregate metrics are retained in both CassandraClientPool and CassandraClientPoolingContainer.
This was necessary for compatibility with an internal log-ingestion tool.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2324">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-metrics">METRICS</span> <span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>AtlasDB no longer embeds table names in Sweep metrics.
Sweep aggregate metrics continue to be reported.
This was necessary for compatibility with an internal log-ingestion tool.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2324">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB now depends on okhttp 3.8.1. This is expected to fix an issue where connections would constantly throw “shutdown” exceptions, which was likely due to a documented bug in okhttp 3.4.1.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2343">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">ConcurrentStreams</span></code> class has been deleted and replaced with calls to <code class="docutils literal notranslate"><span class="pre">MoreStreams.blockingStreamWithParallelism</span></code>, from <a class="reference external" href="https://github.com/palantir/streams">streams</a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2361/files">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>TimeLockAgent’s constructor now accepts a Supplier instead of an RxJava Observable.
This reduces the size of the TimeLock Agent jar, and removes the need for a dependency on RxJava.
To convert an RxJava Observable to a Supplier that always returns the most recent value, consider the method <cite>blockingMostRecent</cite> as implemented <a class="reference external" href="https://github.com/palantir/atlasdb/blob/0.56.0/timelock-agent/src/main/java/com/palantir/timelock/Observables.java#L39-L48">here</a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2339">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BatchingVisitableView</span></code> methods <code class="docutils literal notranslate"><span class="pre">immutableCopy</span></code>, <code class="docutils literal notranslate"><span class="pre">immutableSetCopy</span></code>, and <code class="docutils literal notranslate"><span class="pre">copyInto</span></code> use the default batch hint of 1000, instead of a batch hint of 100,000.
We previously defaulted to the higher value because the result set was assumed to be small; however, in practice this has turned out not to be the case, leading to timeouts and OOMs in the field.
To use a custom batch hint, set the <code class="docutils literal notranslate"><span class="pre">batchHint</span></code> property for your <code class="docutils literal notranslate"><span class="pre">RangeRequest</span></code>.
Alternatively, call <code class="docutils literal notranslate"><span class="pre">BatchingVisitableView.hintBatchSize(int)</span></code> before making a copy.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2347">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB table definitions now support specifying log safety without having to also specify value byte order for row components.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2349">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-56-1">
<h2>v0.56.1<a class="headerlink" href="#v0-56-1" title="Permalink to this headline"></a></h2>
<p>14 September 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The new concurrent version of <cite>Transaction#getRanges</cite> did not correctly guarantee ordering of the results returned in its stream.
We now make sure the resulting ordering matches that of the input RangeRequests.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2337">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-56-0">
<h2>v0.56.0<a class="headerlink" href="#v0-56-0" title="Permalink to this headline"></a></h2>
<p>12 September 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>TimelockServer now exposes the <cite>LockService</cite> instead of the <cite>RemoteLockService</cite> if using the synchronous lock service.
This will provide a more comprehensive API which is required by the large internal products.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2284">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">USER BREAK</span> <span class="changetype changetype-new">NEW</span></p></td>
<td><p>Timelock clients now report tritium metrics for the lock requests with the prefix <code class="docutils literal notranslate"><span class="pre">LockService</span></code> instead of <code class="docutils literal notranslate"><span class="pre">RemoteLockService</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2284">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>LockAwareTransactionManager now returns a <cite>LockService</cite> instead of a <cite>RemoteLockService</cite> in order to expose the new API.
Any products that extend this class will have to change their class definition.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2284">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Added two new methods to Transaction, getRangesLazy and a concurrent version of getRanges, which are also exposed in the Table API.
If you expect to only use a small amount of the rows in the provided ranges, it is often advisable to use the new getRangesLazy method and serially iterate over the results.
Otherwise, you should use the new version of getRanges that allows explicitly operating on the resulting visitables in parallel.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2281">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-deprecated">DEPRECATED</span></p></td>
<td><p>The existing getRanges method has been deprecated as it would eagerly load the first page of all ranges, potentially concurrently.
This often caused more data to be fetched than necessary or higher concurrency than expected.
Recommended alternative is to use getRanges with a specified concurrency level, or getRangesLazy.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2281">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">USER BREAK</span> <span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB no longer embeds user-agents in metric names.
This affects both AtlasDB clients as well as TimeLock Server.
All metrics are still available; however, metrics which previously included a user-agent component will no longer do so.
For example, the timer <code class="docutils literal notranslate"><span class="pre">com.palantir.timestamp.TimestampService.myUserAgent_version.getFreshTimestamp</span></code> is now named <code class="docutils literal notranslate"><span class="pre">com.palantir.timestamp.TimestampService.getFreshTimestamp</span></code>.
This was necessary for compatibility with an internal log-ingestion tool.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2322">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>LockServerOptions now provides a builder, which means constructing one should not require overriding methods.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2284">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Oracle will now validate connections by running the test query when getting a new connection from the HikariPool.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2301">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Cassandra range concurrency defaults lowered from 64x to 32x, to reflect default connection pool sizes
that have shrank over time, and to be more appropriate for fairly common smaller 3-node clusters.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2386">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-55-0">
<h2>v0.55.0<a class="headerlink" href="#v0-55-0" title="Permalink to this headline"></a></h2>
<p>01 September 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>If AtlasDB is used with TimeLock, and the TimeLock client name is different than either the Cassandra <code class="docutils literal notranslate"><span class="pre">keyspace</span></code>, Postgres <code class="docutils literal notranslate"><span class="pre">dbName</span></code>, or Oracle <code class="docutils literal notranslate"><span class="pre">sid</span></code>, <em>AtlasDB will fail to start</em>.
This was done to avoid the risk of data corruption if these are accidentally changed independently.
If the above parameters contradict, please contact the AtlasDB team to change the TimeLock client name. Changing it in config without additional action may result in <em>severe data corruption</em>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2263">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB introduces a top-level <code class="docutils literal notranslate"><span class="pre">namespace</span></code> configuration parameter, which is used to set the <code class="docutils literal notranslate"><span class="pre">keyspace</span></code> in the keyValueService when using Cassandra and the <code class="docutils literal notranslate"><span class="pre">client</span></code> in TimeLock.
Following the previous change, we unify both the configs that cannot be changed separately in one single config. Therefore it is suggested that AtlasDB users follow and use the new parameter to specify both the deprecated ones.
Note that if the new <code class="docutils literal notranslate"><span class="pre">namespace</span></code> config contradicts with either the Cassandra <code class="docutils literal notranslate"><span class="pre">keyspace</span></code> and/or the TimeLock <code class="docutils literal notranslate"><span class="pre">client</span></code> configs, <em>AtlasDB will fail to start</em>.
Please consult the documentation for <a class="reference internal" href="../configuration/index.html#atlas-config"><span class="std std-ref">AtlasDB Configuration</span></a> for details on how to set this up.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2263">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-deprecated">DEPRECATED</span></p></td>
<td><p>As a followup of the <code class="docutils literal notranslate"><span class="pre">namespace</span></code> change, the Cassandra <code class="docutils literal notranslate"><span class="pre">keyspace</span></code> and TimeLock <code class="docutils literal notranslate"><span class="pre">client</span></code> configs were deprecated.
As said previously, please use the <code class="docutils literal notranslate"><span class="pre">namespace</span></code> root level config to specify both of these parameters.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2263">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Oracle SE will now automatically trigger table data shrinking to recover space after sweeping a table.
You can disable the compaction by setting <code class="docutils literal notranslate"><span class="pre">enableShrinkOnOracleStandardEdition</span></code> to <code class="docutils literal notranslate"><span class="pre">false</span></code> in the Oracle DDL config.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2286">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue where sweep logs would get rolled over sooner than expected. The number of log files stored on disk was increased from 10 to 90 before rolling over.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2295">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-54-0">
<h2>v0.54.0<a class="headerlink" href="#v0-54-0" title="Permalink to this headline"></a></h2>
<p>25 August 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Timelock clients now report tritium metrics for the <code class="docutils literal notranslate"><span class="pre">TimestampService</span></code> even if they are using the request batching service.
Note when setting up metric graphs, the timestamp service metrics are named with <code class="docutils literal notranslate"><span class="pre">...Timelock.&lt;getFreshTimestamp/getFreshTimestamps&gt;</span></code> when not using request batching,
but as <code class="docutils literal notranslate"><span class="pre">...Timestamp.&lt;getFreshTimestamp/getFreshTimestamps&gt;</span></code> if using request batching.
The lock service metrics are always reported as <code class="docutils literal notranslate"><span class="pre">...Timelock.&lt;lock/unlock/etc&gt;</span></code> for timelock clients.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2270">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB clients now report tritium metrics for the <code class="docutils literal notranslate"><span class="pre">TimestampService</span></code> and <code class="docutils literal notranslate"><span class="pre">LockService</span></code> endpoints just once instead of twice.
In the past, every request would be reported twice leading to number bloat and more load on the metric collector service.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2270">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">kvs-slow-log</span></code> now uses <code class="docutils literal notranslate"><span class="pre">logsafe</span></code> to support sls-compatible logging.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2222">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The scrubber queue no longer grows without bound if the same cell is overwritten multiple times by hard delete transactions.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2232">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>If <code class="docutils literal notranslate"><span class="pre">enableOracleEnterpriseFeatures</span></code> is configured to be false, you will now see warnings asking you to run Oracle compaction manually.
This will help make non-EE Oracle users aware of potential database bloat.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2277">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a case where logging an expection suppressing itself would cause a stack overflow.
See <a class="reference external" href="https://jira.qos.ch/browse/LOGBACK-1027">LOGBACK-1027</a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2242">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now produces a new artifact, <code class="docutils literal notranslate"><span class="pre">timelock-agent</span></code>.
Users who wish to run TimeLock Server outside of a Dropwizard environment should now be able to do so more easily, by supplying the TimeLock Agent with a <em>registrar</em> that knows how to register Java resources and expose suitable HTTP endpoints.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2247">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>TimeLock now creates client namespaces the first time they are requested, rather than requiring them to be specified in config.
This means that specifying a list of clients in Timelock configuration will no longer have any effect. Further, a new configuration property called <code class="docutils literal notranslate"><span class="pre">max-number-of-clients</span></code> has been introduced in <code class="docutils literal notranslate"><span class="pre">TimeLockRuntimeConfiguration</span></code>. This can be used to limit the number of clients that will be created dynamically, since each distinct client has some memory, disk space, and CPU overhead.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2252">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-deprecated">DEPRECATED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">putUnlessExists</span></code> methods in schema generated code have been marked as deprecated as the naming can be misleading, leading to accidental value overwrites. The recommended alternative is doing a separate read and write in a single transaction.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2271">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>CharacterLimitType now has fields marked as final.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2259">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">RangeMigrator</span></code> interface now contains an additional method <code class="docutils literal notranslate"><span class="pre">logStatus(int</span> <span class="pre">numRangeBoundaries)</span></code>.
This method is used to log the state of migration for each table when starting or resuming a KVS migration.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2241">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Updated our dependency on <code class="docutils literal notranslate"><span class="pre">sls-packaging</span></code> from 2.3.1 to 2.4.0.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2268">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-53-0">
<h2>v0.53.0<a class="headerlink" href="#v0-53-0" title="Permalink to this headline"></a></h2>
<p>9 August 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>KVS migrations will no longer verify equality between the from and to KVSes for the sweep priority and progress tables.
Note that these tables are still <em>migrated</em> across, as they provide heuristics for timely sweeping of tables.
However, these tables may change during the migration, without affecting correctness (e.g. the from-kvs could be swept).
Previously, we would attempt to check that the sweep tables were equal on both KVSes, leading to spurious validation failures.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2244">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now supports specifying the safety of table names as well as row and column component names following the <a class="reference external" href="https://github.com/palantir/safe-logging">palantir/safe-logging</a> library.
Please consult the documentation for <a class="reference internal" href="../schemas/tables_and_indices.html#tables-and-indices"><span class="std std-ref">Tables and Indices</span></a> for details on how to set this up.
As AtlasDB regenerates its metadata on startup, changes will take effect after restarting your AtlasDB client (in particular, you do NOT need to rerender your schemas.)
Previously, all table names, row component names and column names were always treated as unsafe.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1988">Pull Request 1</a>,
<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2000">Pull Request 2</a> and
<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2172">Pull Request 3</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">ProfilingKeyValueService</span></code> and <code class="docutils literal notranslate"><span class="pre">SpecificTableSweeper</span></code> now log table names as safe arguments, if and only if these have been specified as safe in one’s schemas.
Previously, these were always logged as unsafe.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2172">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>AtlasDB now throws an error during schema code generation stage if table length exceeds KVS limits.
To override this, please specify <code class="docutils literal notranslate"><span class="pre">ignoreTableNameLengthChecks()</span></code> on your schema.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2220">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NameComponentDescription</span></code> is now a <code class="docutils literal notranslate"><span class="pre">final</span></code> class and has a builder instead of constructors.
This will affect any products which have subclassed <code class="docutils literal notranslate"><span class="pre">NameComponentDescription</span></code>, although we are not aware of any.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2238">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>IteratorUtils.forEach removed; it’s not needed in a Java 8 codebase.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2207">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-52-0">
<h2>v0.52.0<a class="headerlink" href="#v0-52-0" title="Permalink to this headline"></a></h2>
<p>1 August 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a critical bug in Oracle that limits the number of writes with values greater than 2000 bytes to <code class="docutils literal notranslate"><span class="pre">Integer.MAX_VALUE</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2224">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Change schemas in the codebase so that they use JAVA8 Optionals instead of Guava.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2210">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Removed unused classes on AtlasDB.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FutureClosableIteratorTask</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ClosableMergedIterator</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ThrowingKeyValueService</span></code></p></li>
</ul>
</div></blockquote>
<p>If any issues arise from this change, please contact the development team.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1933">Pull Request</a>)</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="v0-51-0">
<h2>v0.51.0<a class="headerlink" href="#v0-51-0" title="Permalink to this headline"></a></h2>
<p>28 July 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>For DbKvs, the <code class="docutils literal notranslate"><span class="pre">actualValues</span></code> field is now populated when a <code class="docutils literal notranslate"><span class="pre">CheckAndSetException</span></code> is thrown.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2196">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-50-0">
<h2>v0.50.0<a class="headerlink" href="#v0-50-0" title="Permalink to this headline"></a></h2>
<p>27 July 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>TimeLock Server, if configured to use the async lock service, will now throw if a client attempts to start a transaction via the sync lock service.</p>
<p>Previously, users which have clients (for the same namespace) running both pre- and post-0.49.0 versions of AtlasDB were able to run transactions against the sync and async lock services concurrently, thus breaking the guarantees of the lock service.
AtlasDB does not support having clients (for the same namespace) running both pre- and post-0.49.0 versions.</p>
<p>Note that TimeLock users which have clients (for different namespaces) running both pre- and post-0.49.0 versions will need to turn this feature off for clients on pre-0.49.0 versions to continue working with TimeLock, and should exercise caution in ensuring that, for each namespace, clients use only pre- or post-0.49.0 versions of AtlasDB.
Please see <a class="reference internal" href="../configuration/external_timelock_service_configs/timelock_server_config.html#async-lock-service"><span class="std std-ref">Async Lock Service Configuration</span></a> for documentation.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2189">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>TimeLock Server has moved its parameter <code class="docutils literal notranslate"><span class="pre">useAsyncLockService</span></code> to be within an <code class="docutils literal notranslate"><span class="pre">asyncLock</span></code> block.
This was done as we wanted to keep the configuration options for the async lock service together.
The parameter remains optional, and users not configuring this parameter are unaffected.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2189">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">gc_grace_seconds</span></code> will now be automatically updated for services running against CassandraKVS on startup.</p>
<p>We reduced <code class="docutils literal notranslate"><span class="pre">gc_grace_seconds</span></code> from four days to one hour in 0.42.0 but that is enforced for new tables and not the existing ones.
Updating <code class="docutils literal notranslate"><span class="pre">gc_grace_seconds</span></code> can be an expensive operation and users should expect the service to block for a while on startup.
However, this shouldn’t be a concern unless the count of tables is in the order of 100s. If you think this will be an issue,
please configure the <code class="docutils literal notranslate"><span class="pre">gcGraceSeconds</span></code> parameter in Cassandra KVS config to 4 days (<code class="docutils literal notranslate"><span class="pre">4</span> <span class="pre">*</span> <span class="pre">24</span> <span class="pre">*</span> <span class="pre">60</span> <span class="pre">*</span> <span class="pre">60</span></code>), which was the previous default.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2129">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">RequestBatchingTimestampService</span></code> now works for AtlasDB clients using TimeLock Server once again.
Previously in 0.49.0, clients using TimeLock Server and request batching would still request timestamps one at a time from the TimeLock Server.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2182">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PaxosQuorumChecker</span></code> will now interrupt outstanding requests after a quorum response has been collected. This prevents the number of paxos request threads from growing without bound.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2193">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>OkHttp clients (created with <code class="docutils literal notranslate"><span class="pre">FeignOkHttpClients</span></code>) will no longer silently retry connections.
We have already implemented retries, including retries from connection failures, at the Feign level in <code class="docutils literal notranslate"><span class="pre">FailoverFeignTarget</span></code>.
If you require silent retry, please contact the AtlasDB team.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2197">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>AtlasConsole database mutation commands (namely <code class="docutils literal notranslate"><span class="pre">put()</span></code> and <code class="docutils literal notranslate"><span class="pre">delete()</span></code>) are now disabled by default.
To enable them, run AtlasConsole with the <code class="docutils literal notranslate"><span class="pre">--mutations_enabled</span></code> flag
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2155">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug in AtlasConsole that caused valid table names not to be recognized.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2192">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>TimeLock Server now supports a <code class="docutils literal notranslate"><span class="pre">NonBlockingFileAppenderFactory</span></code> which prevents requests from blocking if the request log queue is full.
To use this appender, the <code class="docutils literal notranslate"><span class="pre">type</span></code> property should be set to <code class="docutils literal notranslate"><span class="pre">non-blocking-file</span></code> in the logging appender configuration. Note that using this appender may result in request logs being dropped.
(<a class="reference internal" href="../configuration/external_timelock_service_configs/timelock_server_config.html#non-blocking-appender"><span class="std std-ref">Docs</span></a>)
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2198">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a potential deadlock in <code class="docutils literal notranslate"><span class="pre">PersistentLockManager</span></code> that could prevent clients from shutting down if the persistent backup lock could not be acquired.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2208">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>New metrics have been added for tracking Cassandra’s approximate pool size, number of idle connections, and number of active connections. (<a class="reference internal" href="../miscellaneous/dropwizard-metrics.html#dropwizard-metrics"><span class="std std-ref">Docs</span></a>)
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2214">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-49-0">
<h2>v0.49.0<a class="headerlink" href="#v0-49-0" title="Permalink to this headline"></a></h2>
<p>18 July 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>TimeLock Server now can process lock requests using async Jetty servlets, rather than blocking request threads. This leads to more stability and higher throughput during periods of heavy lock contention.
To enable this behavior, use the <code class="docutils literal notranslate"><span class="pre">useAsyncLockService</span></code> option to switch between the new and old lock service implementation. This option defaults to <code class="docutils literal notranslate"><span class="pre">true</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2084">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The maximum time that a transaction will block while waiting for commit locks is now configurable, and defaults to 1 minute. This can be configured via the <code class="docutils literal notranslate"><span class="pre">transaction.lockAcquireTimeoutMillis</span></code> option in <code class="docutils literal notranslate"><span class="pre">AtlasDbRuntimeConfig</span></code>.
This differs from the previous behavior, which was to block indefinitely. However, the previous behavior can be effectively restored by configuring a large timeout.
If creating a <code class="docutils literal notranslate"><span class="pre">SerializableTransactionManager</span></code> directly, use the new constructor which accepts a timeout parameter.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2158">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">randomBitCount</span></code> and <code class="docutils literal notranslate"><span class="pre">maxAllowedBlockingDuration</span></code> are deprecated and no longer configurable in <code class="docutils literal notranslate"><span class="pre">LockServerOptions</span></code>. If specified, they will be silently ignored.
If your service relies on either of these configuration options, please contact the AtlasDB team.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2161">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>This version of the AtlasDB client will <strong>require</strong> a version of Timelock server that exposes the new <code class="docutils literal notranslate"><span class="pre">/timelock</span></code> endpoints.
Note that this only applies if running against Timelock server; clients running with embedded leader mode are not affected.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2135">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>The timestamp batching functionality introduced in 0.48.0 is temporarily no longer supported when running with Timelock server. We will re-enable support for this in a future release.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed the broken <code class="docutils literal notranslate"><span class="pre">put()</span></code> command in AtlasConsole. You should now be able to insert and update data using Console.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2140">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue that could cause AtlasConsole to print unnecessary amounts of input when commands were run.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2130">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>Remove Cassandra config option <code class="docutils literal notranslate"><span class="pre">safetyDisabled</span></code>;
users should instead move to a more specific config for their situation, which are:
<code class="docutils literal notranslate"><span class="pre">ignoreNodeTopologyChecks</span></code>, <code class="docutils literal notranslate"><span class="pre">ignoreInconsistentRingChecks</span></code>, <code class="docutils literal notranslate"><span class="pre">ignoreDatacenterConfigurationChecks</span></code>, <code class="docutils literal notranslate"><span class="pre">ignorePartitionerChecks</span></code>
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2024">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">commons-executors</span></code> now excludes the <code class="docutils literal notranslate"><span class="pre">safe-logging</span></code> Java8 jar to support Java 6 clients.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2160">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TransactionManagers</span></code> exposes a method in which it is possible to specify the user agent to be used.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2162">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-48-0">
<h2>v0.48.0<a class="headerlink" href="#v0-48-0" title="Permalink to this headline"></a></h2>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>If sweep configs are specified in the AtlasDbConfig block, they will be ignored, but AtlasDB will no longer fail to start.
This effectively fixes the Sweep-related user break change of version <code class="docutils literal notranslate"><span class="pre">0.47.0</span></code>.
Note that users of products that upgraded from <code class="docutils literal notranslate"><span class="pre">0.45.0</span></code> to <code class="docutils literal notranslate"><span class="pre">0.48.0</span></code> will need to move configuration overrides from the regular <code class="docutils literal notranslate"><span class="pre">atlasdb</span></code> config to the <code class="docutils literal notranslate"><span class="pre">atlasdb-runtime</span></code> config for them to continue taking effect.
Please reference the Sweep <a class="reference internal" href="../cluster_management/sweep/standard-sweep.html#sweep-tunable-parameters"><span class="std std-ref">configuration docs</span></a> for more details.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2134">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now supports batching of timestamp requests on the client-side; see <a class="reference internal" href="../configuration/timestamp_client.html#timestamp-client-config"><span class="std std-ref">Timestamp Client Options</span></a> for details.
On internal benchmarks, the AtlasDB team has obtained an almost 2x improvement in timestamp throughput and latency under modest load (32 threads), and an over 10x improvement under heavy load (8,192 threads).
There may be a very small increase in latency under extremely light load (e.g. 2-4 threads).
Note that this is not enabled by default.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2083">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">RateLimitingTimestampService</span></code> in <code class="docutils literal notranslate"><span class="pre">timestamp-impl</span></code> has been renamed to <code class="docutils literal notranslate"><span class="pre">RequestBatchingTimestampService</span></code>, to better reflect what the service does and avoid confusion with the <code class="docutils literal notranslate"><span class="pre">ThreadPooledLockService</span></code> (which performs resource-limiting).
Products that do not use this class directly are not affected.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2083">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TransactionManager.close()</span></code> now closes the lock service (provided it is closeable), and also shuts down the Background Sweeper.
Previously, the lock service’s background threads as well as background sweeper would continue to run (potentially indefinitely) even after a transaction manager was closed.
Note that services that relied on the lock service being available even after a transaction manager was shut down may no longer behave properly, and should ensure that the transaction manager is not shut down while the lock service is still needed.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2102">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">commons-executors</span></code> now uses Java 6 when compiling from source and generates classes targeting Java 6.
Java 6 support was removed in AtlasDB <code class="docutils literal notranslate"><span class="pre">0.41.0</span></code> and blocks certain internal products from upgrading to subsequent versions.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2122">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LockServiceImpl.close()</span></code> is now idempotent.
Previously, calling the referred method more than once could fail an assertion and throw an exception.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2144">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-47-0">
<h2>v0.47.0<a class="headerlink" href="#v0-47-0" title="Permalink to this headline"></a></h2>
<p>11 July 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>ErrorProne is enabled and not ignored on all AtlasDB projects. This means that AtlasDB can be whitelisted in the internal logging aggregator tool from this version ownards.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1889">Pull Request</a>)
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1901">Pull Request</a>)
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1902">Pull Request</a>)
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2055">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Background Sweep is enabled by default on AtlasDB. To understand what Background Sweep is, please check the <a class="reference internal" href="../cluster_management/sweep.html#sweep"><span class="std std-ref">sweep docs</span></a>, in particular, the <a class="reference internal" href="../cluster_management/sweep/standard/background-sweep.html#background-sweep"><span class="std std-ref">background sweep docs</span></a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2104">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span> <span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Added support for live-reloading sweep configurations.
<code class="docutils literal notranslate"><span class="pre">TransactionManagers.create()</span></code> methods now accept a Supplier of <code class="docutils literal notranslate"><span class="pre">AtlasDbRuntimeConfig</span></code> in addition to an <code class="docutils literal notranslate"><span class="pre">AtlasDbConfig</span></code>.
If needed, the helper method <code class="docutils literal notranslate"><span class="pre">defaultRuntimeConfig()</span></code> can be used to create a runtime config with the default values.
As part of this improvement, we made the sweep options of <code class="docutils literal notranslate"><span class="pre">AtlasDbConfig</span></code> unavailable.
The following options now <strong>may not</strong> be specified in the install config and must instead be specified in the runtime config:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 56%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">AtlasDbConfig</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">AtlasDbRuntimeConfig</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="strike">enableSweep</span></p></td>
<td><p><strong>enabled</strong></p></td>
</tr>
<tr class="row-odd"><td><p><span class="strike">sweepPauseMillis</span></p></td>
<td><p><strong>pauseMillis</strong></p></td>
</tr>
<tr class="row-even"><td><p><span class="strike">sweepReadLimit</span></p></td>
<td><p><strong>readLimit</strong></p></td>
</tr>
<tr class="row-odd"><td><p><span class="strike">sweepCandidateBatchHint</span></p></td>
<td><p><strong>candidateBatchHint</strong></p></td>
</tr>
<tr class="row-even"><td><p><span class="strike">sweepDeleteBatchHint</span></p></td>
<td><p><strong>deleteBatchHint</strong></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Specifying any of the above install options will result in <strong>AtlasDB failing to start</strong>. Check the full configuration docs <a class="reference external" href="http://palantir.github.io/atlasdb/html/configuration/index.html">here</a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1976">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug that caused AtlasDB internal tables (e.g. the Transactions table or the Punch table) to be <strong>wiped when read from the AtlasDB Console</strong>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2106">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>The Atomix algorithm implementation for the TimeLock server and the corresponding configurations have been removed.
The default algorithm for <code class="docutils literal notranslate"><span class="pre">TimeLockServer</span></code> has been changed to Paxos.
This should not affect users as Atomix should not have been used due to known bugs in the implementation.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2082">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>The previously deprecated RocksDBKVS has been removed.
Developers that relied on RocksDB for testing should move to H2 on JdbcKvs.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1966">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Sweep now dynamically adjusts the number of (cell, ts) pairs across runs:</p>
<ul class="simple">
<li><p>On a failure run, sweep halves the number of pairs to read and to delete on subsequent runs.</p></li>
<li><p>On a success run, sweep slowly increases the number of (cell, ts) pairs to read and to delete on subsequent runs, up to a configurable maximum.</p></li>
</ul>
<p>This should fix the issue where we were unable to sweep cells with a high number of mutations.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2060">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Default configs which tune sweep runs were lowered, to ensure that sweep works in any situation. For more information, please check the <a class="reference internal" href="../cluster_management/sweep.html#sweep"><span class="std std-ref">sweep docs</span></a>.
Please delete any config overrides regarding sweep and use the default values, to ensure a sane run of sweep.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2104">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now instruments embedded timestamp and lock services when no leader block is present in the config, to expose aggregate response time and service call metrics.
Note that this may cause a minor performance hit.
If that is a concern, the instrumentation can be turned off by setting the tritium system properties <code class="docutils literal notranslate"><span class="pre">instrument.com.palantir.timestamp.TimestampService</span></code> and
<code class="docutils literal notranslate"><span class="pre">instrument.com.palantir.lock.RemoteLockService</span></code> to false and restarting the service.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2073">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now adds endpoints for sweeping a specific table, with options for startRow and batch config parameters.
This should be used in place of the deprecated sweep CLIs. Check the endpoints documentation <a class="reference external" href="http://palantir.github.io/atlasdb/html/cluster_management/sweep/sweep-endpoints.html">here</a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2040">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Improved performance of timestamp and lock requests on clusters with a leader block and a single node.
If a single leader is configured, timestamp and lock requests will no longer use HTTPS/Jetty.
In addition to the minor perf improvement, this fixes an issue causing livelock/deadlock when the leader is under heavy load.
We recommend HA clusters under heavy load switch to using a standalone timestamp service, as they may also be vulnerable to this failure mode.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2091">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>The dropwizard independent implementation of the TimeLock server has been separated into a new project, <code class="docutils literal notranslate"><span class="pre">timelock-impl</span></code>.
This should not affect users directly, unless they depended on classes from within the TimeLock server.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2081">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>JDBC KVS now batches cells in put/delete operations via the config parameter <code class="docutils literal notranslate"><span class="pre">batchSizeForMutations</span></code>.
This will prevent the driver from throwing due to many parameters in the resulting SQL select query. Also,
the batch size for getRows is now controlled by a config parameter <code class="docutils literal notranslate"><span class="pre">rowBatchSize</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2093">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB clients now retry lock requests if the server loses leadership while the request is blocking.
In the past, this scenario would cause the server to return 500 responses that were not retried by the client.
Now the server returns 503 responses, which triggers the correct retry logic.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2098">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB now generates Maven POM files for shadowed jars correctly.
Previously, we would regenerate the XML for shadow dependencies by creating a node with corresponding groupId, artifactId, scope and version tags <em>only</em>, which is incorrect because it loses information about, for example, specific or transitive exclusions.
We now respect these additional tags.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2092">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug where a timelock server instance could get stuck in an infinite loop if cutoff from the other nodes and failed to achieve a quorum.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1983">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>Improved the way rows and named columns are outputted in AtlasConsole to be more intuitive and easier to use. Note that this may break existing AtlasConsole scripts.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2067">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Added backwards compatibility for the changes introduced in <a class="reference external" href="https://github.com/palantir/atlasdb/pull/2067">#2067</a>, in particular, for passing row values into AtlasConsole functions.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2080">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-46-0">
<h2>v0.46.0<a class="headerlink" href="#v0-46-0" title="Permalink to this headline"></a></h2>
<p>This version was skipped due to issues on release. No artifacts with this version were ever published.</p>
</section>
<section id="v0-45-0">
<h2>v0.45.0<a class="headerlink" href="#v0-45-0" title="Permalink to this headline"></a></h2>
<p>19 June 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Upgraded all usages of http-remoting to remoting2.
Previously, depending on the use case, AtlasDB would use http-remoting, remoting1 and remoting2.
Developers may need to check their dependencies, as well as update instantiation of their calls to <code class="docutils literal notranslate"><span class="pre">TransactionManagers.create()</span></code> to use the remoting2 API.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1999">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB has updated Feign to 8.17.0 and OkHttp to 3.4.1, following remoting2 in the <a class="reference external" href="https://github.com/palantir/http-remoting">palantir/http-remoting</a> library.
We previously used Feign 8.6.1 and OkHttp 2.5.0.
Developers may need to check their dependencies, especially if they relied on AtlasDB to pull in Feign and OkHttp as there were package name changes.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2006">Pull Request 1</a>) and
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2061">Pull Request 2</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB now shades Feign and Okio (same as <a class="reference external" href="https://github.com/palantir/http-remoting">palantir/http-remoting</a>).
This was done to enable us to synchronize with remoting2 while limiting breaks for users of older versions of Feign, especially given an API break in Feign 8.16.
Users who previously relied on AtlasDB to pull in these libraries may experience a compile break, and should consider explicitly depending on them.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2061">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Converted all compile time uses of Guava’s <code class="docutils literal notranslate"><span class="pre">com.google.common.base.Optional</span></code> class to the Java8 equivalent <code class="docutils literal notranslate"><span class="pre">java.util.Optional</span></code>.
This change should not directly affect users as there is no change to <cite>json</cite> or <cite>yml</cite> representations of AtlasDB configurations.
This is a relatively straightforward compile time break for products consuming AtlasDB libraries.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2016">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-deprecated">DEPRECATED</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><cite>AssertUtils</cite> logging methods will now ask for an SLF4J logger to log to, instead of using a default logger.
This should make log events from AssertUtils easier to filter.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2015">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>JDBC KVS now batches cells in get operations via the config parameter <code class="docutils literal notranslate"><span class="pre">batchSizeForReads</span></code>.
This will prevent the driver from throwing due to many parameters in the resulting SQL select query.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2063">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The CLI distribution can now be run against JDBC with hikari connection pools.
In the past, it would fail to resolve the configuration due to a missing runtime dependency.
Note: this is not a problem if running with the dropwizard bundle.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2063">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue where the lock service was not properly shut down after losing leadership, which could result in threads blocking unnecessarily.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2014">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Lock refresh requests are no longer restricted by lock service threadpool limiting.
This allows transactions to make progress even when the threadpool is full.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2025">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Lock service now ensures that locks are reaped in a more timely manner.
Previously the lock service could allow locks to be held past expiration, if they had a timeout shorter than the longest timeout in the expiration queue.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2041">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Added a getRow() command to AtlasConsole for retrieving a single row.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1992">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Added a rowComponents() function to the AtlasConsole table() command to allow you to easily view the fields that make up a row key.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2037">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>The default lock timeout is now configurable.
Currently, the default lock timeout is 2 minutes.
This can cause a large delay if a lock requester’s connection has died at the time it receives the lock.
Since TransactionManagers#create provides an auto-refreshing lock service, it is safe to lower the default timeout to reduce the delay that happens in this case.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2026">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The priority of logging on background sweep was increased from debug to info or warn.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2031">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The lock service state logger now has a reduced memory footprint.
It also now logs the locking mode for each lock.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1891">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Reduced the logging level of some messages relating to check-and-set operations in <code class="docutils literal notranslate"><span class="pre">CassandraTimestampBoundStore</span></code> to reduce noise in the logs.
These were designed to help debugging the <code class="docutils literal notranslate"><span class="pre">MultipleRunningTimestampServicesException</span></code> issues but we no longer require them to log all the time.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2048">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-44-0">
<h2>v0.44.0<a class="headerlink" href="#v0-44-0" title="Permalink to this headline"></a></h2>
<p>8 June 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TimestampService</span></code> now uses atomic variables rather than locking, and refreshes the bound synchronously rather than asynchronously.
This should improve performance somewhat under heavy load, although there will be a short pause in responses when the bound needs to be refreshed (currently, once every 1 million timestamps).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1910">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Added new meter metrics for cells swept/deleted and failures to acquire persistent lock.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1946">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Cassandra thrift driver has been bumped to version 3.10.
This will fix a bug (#1654) that caused Atlas probing downed Cassandra nodes every few minutes to see if they were up and working yet to eventually take out the entire cluster by steadily building up leaked connections, due to a bug in the underlying driver.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1970">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Read-only transactions will no longer make a remote call to fetch a timestamp, if no work is done on the transaction.
This will benefit services that execute read-only transactions around in-memory cache operations, and frequently never fall through to perform a read.
(<a class="reference external" href="https://github.com/palantir/1996">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Timelock service now includes user agents for all inter-node requests.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1971">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Timelock now tracks metrics for leadership elections, including leadership gains, losses, and proposals.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1971">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a severe performance regression in getRange() on Oracle caused by an inadequate query plan being chosen sometimes.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1989">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a potential out-of-memory issue by limiting the number of rows getRange() can request from Postgres at once.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2003">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>KVS migration CLI will now clear the checkpoint tables that are required while the migration is in progress but not after the migration is complete.
The tables were previously left hanging and the user had to delete/truncate them.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1927">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Some downstream projects were using empty table metadata for dev-laziness reasons in their tests.
This is no longer permitted, as it leads to many (unsolved) questions about how to deal with such a table.
If this breaks your tests, you can fix it with making real schema for tests or by switching to AtlasDbConstants.GENERIC_TABLE_METADATA
(<a class="reference external" href="https://github.com/palantir/1925">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span> <span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug that caused Cassandra to always use the minimum compression block size of 4KB instead of the requested compression block size.
Users must explicitly rewrite table metadata for any tables that requested explicit compression, as any tables that were created previously will not respect the compression block size in the schema.
This can have a very large performance impact (both positive and negative in different cases), so users may need to remove the explicit compression request from their schema if this causes a performance regression.
Users that previously attempted to set a compression block size that was not a power of 2 will also need to update their schema because Cassandra only allows this value to be a power of 2.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1995">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a potential out-of-memory issue by limiting the number of rows getRange() can request from Postgres at once.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/2003">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-43-0">
<h2>v0.43.0<a class="headerlink" href="#v0-43-0" title="Permalink to this headline"></a></h2>
<p>25 May 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>For requests that fail due to to networking or other IOException, the AtlasDB client now backs off before retrying.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1958">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">USER BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">acquire-backup-lock</span></code> endpoint of <code class="docutils literal notranslate"><span class="pre">PersistentLockService</span></code> now returns a 400 response instead of a 500 response when no reason for acquiring the lock is provided.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1909">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PaxosTimestampBoundStore</span></code> now throws <code class="docutils literal notranslate"><span class="pre">NotCurrentLeaderException</span></code>, invalidating the timestamp store, if a bound update fails because another timestamp service on the same node proposed a smaller bound for the same sequence number.
This was added to address a very specific race condition leading to an infinite loop that would saturate the TimeLock cluster with spurious Paxos messages; see <a class="reference external" href="https://github.com/palantir/atlasdb/issues/1941">issue 1941</a> for more detail.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1942">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-deprecated">DEPRECATED</span></p></td>
<td><p>The FastForwardTimestamp and FetchTimestamp CLIs have been deprecated.
Please use the <code class="docutils literal notranslate"><span class="pre">timestamp-management/fast-forward</span></code> and <code class="docutils literal notranslate"><span class="pre">timestamp/fresh-timestamp</span></code> endpoints instead.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1936">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Sweep now batches delete calls before executing them.
This should improve performance on relatively clean tables by deleting more cells at a time, leading to fewer DB operations and taking out the backup lock less frequently.
The new configuration parameter <code class="docutils literal notranslate"><span class="pre">sweepDeleteBatchHint</span></code> determines the approximate number of (cell, timestamp) pairs deleted in a single batch.
Please refer to the <a class="reference internal" href="../cluster_management/sweep/standard-sweep.html#sweep-tunable-parameters"><span class="std std-ref">documentation</span></a> for details of how to configure this.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1911">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p><a class="reference internal" href="../miscellaneous/dropwizard-metrics.html#dropwizard-metrics"><span class="std std-ref">Sweep metrics</span></a> now record counts of cell-timestamp pairs examined rather than the count of entire cells examined. This provides more accurate insight on the work done by the sweeper.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1911">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-deprecated">DEPRECATED</span></p></td>
<td><p>The Sweep CLI configuration parameters <code class="docutils literal notranslate"><span class="pre">--batch-size</span></code> and <code class="docutils literal notranslate"><span class="pre">--cell-batch-size</span></code> have been deprecated, as we now batch on cell-timestamp pairs rather than by rows and cells.
Please use the <code class="docutils literal notranslate"><span class="pre">--candidate-batch-hint</span></code> (batching on cells) instead of <code class="docutils literal notranslate"><span class="pre">--batch-hint</span></code> (batching on rows), and <code class="docutils literal notranslate"><span class="pre">--read-limit</span></code> instead of <code class="docutils literal notranslate"><span class="pre">--cell-batch-size</span></code> (<a class="reference internal" href="../cluster_management/sweep/standard-sweep.html#sweep-tunable-parameters"><span class="std std-ref">docs</span></a>).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1962">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-deprecated">DEPRECATED</span></p></td>
<td><p>The background sweep configuration parameters <code class="docutils literal notranslate"><span class="pre">sweepBatchSize</span></code> (which used to batch on rows) and <code class="docutils literal notranslate"><span class="pre">sweepCellBatchSize</span></code> have been deprecated in favour of <code class="docutils literal notranslate"><span class="pre">sweepCandidateBatchHint</span></code> (which now batches on cells) and <code class="docutils literal notranslate"><span class="pre">sweepReadLimit</span></code> respectively.
If your application configures either of these values, please look at more details in the <a class="reference internal" href="../cluster_management/sweep/standard-sweep.html#sweep-tunable-parameters"><span class="std std-ref">docs</span></a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1945">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>After the Pull Request <a class="reference external" href="https://github.com/palantir/atlasdb/pull/1808">#1808</a> the TimeLock Server did not gate the lock service behind the <code class="docutils literal notranslate"><span class="pre">AwaitingLeadershipProxy</span></code>. This could lead to data corruption in very rare scenarios. The affected TimeLock server versions are not distributed anymore internally.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1955">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TimestampAllocationFailures</span></code> now correctly propagates <code class="docutils literal notranslate"><span class="pre">ServiceNotAvailableException</span></code> if thrown from the timestamp bound store.
Previously, a <code class="docutils literal notranslate"><span class="pre">NotCurrentLeaderException</span></code> that was thrown from the timestamp store would be wrapped in <code class="docutils literal notranslate"><span class="pre">RuntimeException</span></code> before being thrown out, meaning that TimeLock clients saw 500s instead of the intended 503s. This could lead to inneficient retry logic.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1954">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>New <code class="docutils literal notranslate"><span class="pre">KeyValueService</span></code> method <code class="docutils literal notranslate"><span class="pre">getCandidateCellsForSweeping()</span></code> that should eventually replace <code class="docutils literal notranslate"><span class="pre">getRangeOfTimestamps()</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1943">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-42-2">
<h2>v0.42.2<a class="headerlink" href="#v0-42-2" title="Permalink to this headline"></a></h2>
<p>25 May 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PaxosTimestampBoundStore</span></code> now throws <code class="docutils literal notranslate"><span class="pre">TerminalTimestampStoreException</span></code> if a bound update fails because another timestamp service on the same node proposed a smaller bound, or if another node proposed a bound update we were not expecting.
Previously, a <code class="docutils literal notranslate"><span class="pre">NotCurrentLeaderException</span></code> that was thrown from the timestamp store would be wrapped in <code class="docutils literal notranslate"><span class="pre">RuntimeException</span></code> before being thrown out, meaning that TimeLock clients saw 500s instead of the intended 503s.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/TBC">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-42-1">
<h2>v0.42.1<a class="headerlink" href="#v0-42-1" title="Permalink to this headline"></a></h2>
<p>24 May 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PaxosTimestampBoundStore</span></code> now throws <code class="docutils literal notranslate"><span class="pre">NotCurrentLeaderException</span></code>, invalidating the timestamp store, if a bound update fails because another timestamp service on the same node proposed a smaller bound for the same sequence number.
This was added to address a very specific race condition leading to an infinite loop that would saturate the TimeLock cluster with spurious Paxos messages; see <a class="reference external" href="https://github.com/palantir/atlasdb/issues/1941">issue 1941</a> for more detail.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1942">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-42-0">
<h2>v0.42.0<a class="headerlink" href="#v0-42-0" title="Permalink to this headline"></a></h2>
<p>23 May 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PaxosTimestampBoundStore</span></code>, the bound store for Timelock, will now throw <code class="docutils literal notranslate"><span class="pre">NotCurrentLeaderException</span></code> instead of <code class="docutils literal notranslate"><span class="pre">MultipleRunningTimestampServiceError</span></code> when a bound update fails.
The cases where this can happen are explained by a race condition that can occur after leadership change, and it is safe to let requests be retried on another server.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1934">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>A 500 ms backoff has been added to the our retry logic when the client has queried all the servers of a cluster and received a <code class="docutils literal notranslate"><span class="pre">NotCurrentLeaderException</span></code>.
Previously in this case, our retry logic would dictate infinitely many retries with a 1 ms backoff.
The new backoff should reduce contention during leadership elections, when all nodes throw <code class="docutils literal notranslate"><span class="pre">NotCurrentLeaderException</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1939">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Timelock server can now start with an empty clients list.
Note that you currently need to restart timelock when adding clients to the configuration.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1907">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Default <code class="docutils literal notranslate"><span class="pre">gc_grace_seconds</span></code> set by AtlasDB for Cassandra tables has been changed from four days to one hour, allowing Cassandra to start cleaning up swept data sooner after sweeping.</p>
<p>This parameter is set at table creation time, and it will only apply for new tables.
Existing customers can update the <code class="docutils literal notranslate"><span class="pre">gc_grace_seconds</span></code> of existing tables to be one hour if they would like to receive this benefit now. We will also be adding functionality to auto-update this for existing tables in a future release.
There is no issue with having tables with different values for <code class="docutils literal notranslate"><span class="pre">gc_grace_seconds</span></code>, and this can be updated at any time.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1726">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ProfilingKeyValueService</span></code> now has some additional logging mechanisms for logging long-running operations on WARN level, enabled by default.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1801">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-41-0">
<h2>v0.41.0<a class="headerlink" href="#v0-41-0" title="Permalink to this headline"></a></h2>
<p>17 May 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span> <span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Projects <code class="docutils literal notranslate"><span class="pre">atlasdb-commons</span></code>, <code class="docutils literal notranslate"><span class="pre">commons-annotations</span></code>, <code class="docutils literal notranslate"><span class="pre">commons-api</span></code>, <code class="docutils literal notranslate"><span class="pre">commons-executors</span></code>, <code class="docutils literal notranslate"><span class="pre">commons-proxy</span></code>, and <code class="docutils literal notranslate"><span class="pre">lock-api</span></code> no longer force Java 6 compatibility.
This eliminates the need for a Java 6 compiler to compile AtlasDB.
However, users can no longer compile against AtlasDB artifacts using Java 6 or 7; they must use Java 8 if depending on these AtlasDB projects.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1887">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The format of serialized exceptions occurring on a remote host has been brought in line with that of the <a class="reference external" href="https://github.com/palantir/http-remoting">palantir/http-remoting</a> library.
This should generally improve readability and also allows for more meaningful messages to be sent; we would previously return message bodies with no content for some exceptions (such as <code class="docutils literal notranslate"><span class="pre">NotCurrentLeaderException</span></code>).
In particular, the assumption that a status code of 503 definitively means that the node being contacted is not the leader is no longer valid.
That said, existing AtlasDB clients will still behave correctly even with a new TimeLock.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1831">Pull Request 1</a>,
<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1808">Pull Request 2</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Timelock server now has jar publication in addition to dist publication.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1898">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span> <span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>TimeLock clients may now receive an HTTP response with status code 503, encapsulating a <code class="docutils literal notranslate"><span class="pre">BlockingTimeoutException</span></code>.
This response is returned if a client makes a lock request that blocks for long enough that the server’s idle timeout expires; clients may (immediately) retry the request.
Previously, these requests would be failed with a HTTP-level exception that the stream was closed.
We have rewritten clients constructed via <code class="docutils literal notranslate"><span class="pre">AtlasDbHttpClients</span></code> to account for this new behaviour, but custom clients directly accessing the lock service may be affected.
This feature is disabled by default, but can be enabled following the TimeLock server configuration <a class="reference internal" href="../configuration/external_timelock_service_configs/timelock_server_config.html#timelock-server-time-limiting"><span class="std std-ref">docs</span></a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1808">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DbKvs.getRangeOfTimestamps()</span></code> now returns the entire range of timestamps requested for.
Previously, this would only return a range corresponding to the first page of results.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1872">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB Console no longer errors on range requests that used a column selection and had more than one batch of results.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1876">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">PaxosQuorumChecker</span></code> thread pool which is used to dispatch requests to other nodes during leadership elections is now instrumented with Dropwizard metrics.
This will be useful for debugging <a class="reference external" href="https://github.com/palantir/atlasdb/issues/1823">PaxosQuorumChecker can leave hanging threads</a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1849">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Import ordering and license generation in generated IntelliJ project files now respect Baseline conventions.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1893">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Cassandra thrift depedencies have been bumped to newer versions; should fix a bug (#1654) that caused Atlas probing downed Cassandra nodes every few minutes to see if they were up and working yet to eventually take out the entire cluster by steadily building up leaked connections, due to a bug in the underlying driver.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1896">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-40-1">
<h2>v0.40.1<a class="headerlink" href="#v0-40-1" title="Permalink to this headline"></a></h2>
<p>4 May 2017</p>
<p>This release contains (almost) exclusively baseline-related changes.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>The Lock Descriptor classes (<code class="docutils literal notranslate"><span class="pre">AtlasCellLockDescriptor</span></code> etc.), static factories (e.g. <code class="docutils literal notranslate"><span class="pre">LockCollections</span></code>) and <code class="docutils literal notranslate"><span class="pre">LockClient</span></code> have been made final.
If this is a concern, please contact the AtlasDB team.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1857">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Removed package <code class="docutils literal notranslate"><span class="pre">atlasdb-exec</span></code>. If you require this package, please file a ticket to have it reinstated.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1861">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Our dependency on immutables was bumped from 2.2.4 to 2.4.0, in order to fix an issue with static code analysis reporting errors in generated code.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1853">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Renamed the following classes to match baseline rules. In each case, acronyms were lowercased, e.g. <code class="docutils literal notranslate"><span class="pre">CQL</span></code> becomes <code class="docutils literal notranslate"><span class="pre">Cql</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CqlExpiringKeyValueService</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CqlKeyValueService</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CqlKeyValueServices</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CqlStatementCache</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">KvTableMappingService</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TransactionKvsWrapper</span></code></p></li>
</ul>
</div></blockquote>
<p>(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1853">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Relax the signature of KeyValueService.addGarbageCollectionSentinelValues() to take an Iterable instead of a Set.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1843">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-40-0">
<h2>v0.40.0<a class="headerlink" href="#v0-40-0" title="Permalink to this headline"></a></h2>
<p>28 Apr 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>AtlasDB will refuse to start if backed by Postgres 9.5.0 or 9.5.1.
These versions contain a known bug that causes incorrect results to be returned for certain queries.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1820">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">USER BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The lock server now will dump all held locks and outstanding lock requests in YAML file, when logging state requested, for easy readability and further processing.
This will make debuging lock congestions easier. Lock descriptors are changed with places holders and can be decoded using descriptors file,
which will be written in the folder. Information like requesting clients, requesting threads and other details can be found in the YAML.
Note that this change modifies serialization of lock tokens by adding the name of the requesting thread to the lock token; thus, TimeLock Servers are no longer compatible with AtlasDB clients from preceding versions.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1792">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Correct <code class="docutils literal notranslate"><span class="pre">TransactionManagers.createInMemory(...)</span></code> to conform with the rest of the api by accepting a <code class="docutils literal notranslate"><span class="pre">Set&lt;Schema&gt;</span></code> object.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1859">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>The lock server can now limit the number of concurrent open lock requests from the same client.
This behavior can be enabled with the flag <code class="docutils literal notranslate"><span class="pre">useClientRequestLimit</span></code>. It is disabled by default.
For more information, see the <a class="reference internal" href="../configuration/external_timelock_service_configs/timelock_server_config.html#timelock-server-further-config"><span class="std std-ref">docs</span></a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1785">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-new">NEW</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">TransactionManager</span></code> and <code class="docutils literal notranslate"><span class="pre">KeyValueService</span></code> interfaces have new methods that must be implemented by applications that have custom implementations of those interfaces.
These new methods are <code class="docutils literal notranslate"><span class="pre">TransactionManager.getKeyValueServiceStatus()</span></code> and <code class="docutils literal notranslate"><span class="pre">KeyValueService.getClusterAvailabilityStatus()</span></code>.</p>
<p>Applications can now call <code class="docutils literal notranslate"><span class="pre">TransactionManager.getKeyValueServiceStatus()</span></code> to determine the health of the underlying KVS.
This is designed for applications to implement their availability status taking into account the <a class="reference internal" href="../miscellaneous/kvs-status-check.html#kvs-status-check"><span class="std std-ref">kvs health</span></a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1832">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>On graceful shutdown, the background sweeper will now release the backup lock if it holds it.
This should reduce the need for users to manually reset the <code class="docutils literal notranslate"><span class="pre">_persisted_locks</span></code> table in the event that they restarted a service while it was holding the lock.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1847">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Improved performance of <code class="docutils literal notranslate"><span class="pre">getRange()</span></code> on DbKvs. Range requests are now done with a single round trip to the database.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1805">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">atlasdb-config</span></code> now pulls in two more dependencies - the Jackson JDK 8 and JSR 310 modules (<code class="docutils literal notranslate"><span class="pre">jackson-datatype-jdk8</span></code> and <code class="docutils literal notranslate"><span class="pre">jackson-datatype-jsr310</span></code>).
These are required by the <a class="reference external" href="https://github.com/palantir/http-remoting">palantir/http-remoting</a> library.
This behaviour is consistent with our existing behaviour for Jackson modules (JDK 7, Guava and Joda Time).
If you do encounter breaks due to this addition, please contact the AtlasDB team for support.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1810">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-deprecated">DEPRECATED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ConflictDetectionManagers.createDefault(KeyValueService)</span></code> has been deprecated.
If you use this method, please replace it with <code class="docutils literal notranslate"><span class="pre">ConflictDetectionManagers.create(KeyValueService)</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1822">Pull Request 1</a>) and (<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1850">Pull Request 2</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-39-0">
<h2>v0.39.0<a class="headerlink" href="#v0-39-0" title="Permalink to this headline"></a></h2>
<p>19 Apr 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Refactored <code class="docutils literal notranslate"><span class="pre">AvailableTimestamps</span></code> reducing overzealous synchronization.
Giving out timestamps is no longer blocking on refreshing the timestamp bound if there are enough timestamps to give out with the current bound.
This improves latency of timestamp requests under heavy load; we have seen an approximately 30 percent improvement on internal benchmarks.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1783">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>The lock server now has a <code class="docutils literal notranslate"><span class="pre">SlowLockLogger</span></code>, which logs at INFO in the service logs if a lock request receives a response after at least a given amount of time (10 seconds by default).
This is likely to be useful for debugging issues with long-running locks in production.</p>
<p>Specifically, the timelock server has a configuration parameter <code class="docutils literal notranslate"><span class="pre">slowLockLogTriggerMillis</span></code> which defaults to <code class="docutils literal notranslate"><span class="pre">10000</span></code>.
Setting this parameter to zero (or any negative number) will disable the new logger.
If not using timelock, an application can modify the trigger value through <code class="docutils literal notranslate"><span class="pre">LockServerOptions</span></code> during initialization in <code class="docutils literal notranslate"><span class="pre">TransactionManagers.create</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1791">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-deprecated">DEPRECATED</span></p></td>
<td><p>Deprecated <code class="docutils literal notranslate"><span class="pre">InMemoryAtlasDbFactory#createInMemoryTransactionManager</span></code>, please instead use the supported <code class="docutils literal notranslate"><span class="pre">TransactionManagers.createInMemory(...)</span></code> for your testing.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1784">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Proxies created via <code class="docutils literal notranslate"><span class="pre">AtlasDbHttpClients</span></code> now parse <code class="docutils literal notranslate"><span class="pre">Retry-After</span></code> headers correctly.
This manifests as Timelock clients failing over and trying other nodes when receiving a 503 with a <code class="docutils literal notranslate"><span class="pre">Retry-After</span></code> header from a remote (e.g. from a TimeLock non-leader).
Previously, these proxies would immediately retry the connection on the node with a 503 two times (for a total of three attempts) before failing over.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1782">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">atlasdb-config</span></code> project now shadows the <code class="docutils literal notranslate"><span class="pre">error-handling</span></code> and <code class="docutils literal notranslate"><span class="pre">jackson-support</span></code> libraries from <a class="reference external" href="https://github.com/palantir/http-remoting">http-remoting</a>.
This will be used to handle exceptions in a future release, and was done in this way to avoid causing dependency issues in upstream products.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1796">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-38-0">
<h2>v0.38.0<a class="headerlink" href="#v0-38-0" title="Permalink to this headline"></a></h2>
<p>6 Apr 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The default <code class="docutils literal notranslate"><span class="pre">sweepBatchSize</span></code> has been changed from 1000 to 100.
This has empirically shown to be a better batch size because it puts less stress on the underlying KVS.
For a full list of tunable sweep parameters and default settings, see <a class="reference internal" href="../cluster_management/sweep/standard-sweep.html#sweep-tunable-parameters"><span class="std std-ref">sweep tunable options</span></a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1763">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Reverted <a class="reference external" href="https://github.com/palantir/atlasdb/pull/1524">#1524</a>, which caused dependency issues in upstream products.
Once we have resolved these issues, we will reintroduce the change, which was originally part of AtlasDB 0.37.0.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1775">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Creating a postgres table with a long name now throws a <code class="docutils literal notranslate"><span class="pre">RuntimeException</span></code> if the truncated name (first sixty characters) is the same as that of a different existing table.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1729">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a performance regression introduced in <a class="reference external" href="https://github.com/palantir/atlasdb/pull/582">#582</a>, which caused sub-optimal batching behaviour when getting large sets of rows in Cassandra.
The benchmark, intentionally set up in <a class="reference external" href="https://github.com/palantir/atlasdb/pull/1770">#1770</a> to highlight the break, shows a 10x performance improvement.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1764">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Correctness issue fixed in the <code class="docutils literal notranslate"><span class="pre">clean-transactions-range</span></code> CLI. This CLI is responsible for deleting potentially inconsistent transactions in the KVS upon restore from backup.
The CLI was not reading the entire <code class="docutils literal notranslate"><span class="pre">_transactions</span></code> table, and as a result missed deleting transactions that started before and committed after.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1759">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">atlasdb-remoting</span></code> project was removed. We don’t believe this was used anywhere, but if you encounter any problems due to the project having being removed, please contact AtlasDB support.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1750">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">InMemoryAtlasDbFactory</span></code> now supports creating an in-memory transaction manager with multiple schemas.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1774">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Timelock users who start an embedded timestamp and lock service without <a class="reference internal" href="../services/timelock_service/reverse-migration.html#timelock-reverse-migration"><span class="std std-ref">reverse-migrating</span></a> now encounter a more informative error message.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1755">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-37-0">
<h2>v0.37.0<a class="headerlink" href="#v0-37-0" title="Permalink to this headline"></a></h2>
<p>Removed 6 Apr 2017 due to dependency issues. Please use 0.38.0 instead.</p>
<p>Released 29 Mar 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue where a <code class="docutils literal notranslate"><span class="pre">MultipleRunningTimestampServicesError</span></code> would not be propagated from the asynchronous refresh job that increases the timestamp bound.
This could result in a state where two timestamp services are simultaneously handing out timestamps until the older service’s buffer of 1M timestamps is exhausted and fails.
Now we immediately fail, alerting users much sooner that a <code class="docutils literal notranslate"><span class="pre">MultipleRunningTimestampServicesError</span></code> has occurred.
Note that users would still see the error prior to the fix, we now just ensure it is discovered sooner.
This failure does not affect the Timelock server.
Furthermore, we improved the logic for increasing the timestamp bound when the allocation buffer is exhausted.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1718">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Added <a class="reference internal" href="../miscellaneous/dropwizard-metrics.html#dropwizard-metrics"><span class="std std-ref">Dropwizard metrics</span></a> for sweep, exposing aggregate and table-specific counts of cells examined and stale values deleted.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1695">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Added a benchmark <code class="docutils literal notranslate"><span class="pre">TimestampServiceBenchmarks</span></code> for parallel requesting of fresh timestamps from the TimestampService.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1720">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>KVS migrations now maintain the guarantee of the timestamp service to hand out monotonically increasing timestamps.
Previously, we would reset the timestamp service to 0 after a migration, but now we use the correct logical timestamp.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1199">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Improved performance of paging over dynamic columns on Oracle DBKVS: the time required to page through a large wide row is now linear rather than quadratic in the length of the row.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1702">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-deprecated">DEPRECATED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GenericStreamStore.loadStream</span></code> has been deprecated.
Use <code class="docutils literal notranslate"><span class="pre">loadSingleStream</span></code>, which returns an <code class="docutils literal notranslate"><span class="pre">Optional&lt;InputStream&gt;</span></code>, instead.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1265">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">getAsyncRows</span></code> and <code class="docutils literal notranslate"><span class="pre">getAsyncRowsMultimap</span></code> methods have been removed from generated code.
They do not appear valuable to the API and use an unintuitive and custom <code class="docutils literal notranslate"><span class="pre">AsyncProxy</span></code> that was also removed.
We believe they are unused by upstream applications, but if you do encounter breaks due to this removal please file a ticket with the dev team for immediate support.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1689">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>RemoteLockService clients will no longer silently retry on connection failures to the Timelock server.
This is used to mitigate issues with frequent leadership changes owing to <a class="reference external" href="https://github.com/palantir/atlasdb/issues/1680">#1680</a>.
Previously, because of Jetty’s idle timeout and OkHttp’s silent connection retrying, we would generate an endless stream of lock requests if using HTTP/2 and blocking for more than the Jetty idle timeout for a single lock.
This would lead to starvation of other requests on the TimeLock server, since a lock request blocked on acquiring a lock consumes a server thread.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1727">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-36-0">
<h2>v0.36.0<a class="headerlink" href="#v0-36-0" title="Permalink to this headline"></a></h2>
<p>15 Mar 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed DBKVS sweep OOM issue (<a class="reference external" href="https://github.com/palantir/atlasdb/issues/982">#982</a>) caused by very wide rows.
<code class="docutils literal notranslate"><span class="pre">DbKvs.getRangeOfTimestamps</span></code> uses an adjustable cell batch size to avoid loading too many timestamps.
One can set the batch size by calling <code class="docutils literal notranslate"><span class="pre">DbKvs.setMaxRangeOfTimestampsBatchSize</span></code>.</p>
<p>In case of a single row that is too wide, this may result in <code class="docutils literal notranslate"><span class="pre">getRangeOfTimestamps</span></code> returning multiple <code class="docutils literal notranslate"><span class="pre">RowResult</span></code> to include all timestamps.
It is, however, guaranteed that each <code class="docutils literal notranslate"><span class="pre">RowResult</span></code> will contain all timestamps for each included column.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1678">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Actions run by the <code class="docutils literal notranslate"><span class="pre">ReadOnlyTransactionManager</span></code> can no longer bypass necessary protections when using <code class="docutils literal notranslate"><span class="pre">getRowsColumnRange()</span></code>.
These protections disallow reads against <code class="docutils literal notranslate"><span class="pre">THOROUGH</span></code> swept tables as read only transactions do not acquire the appropriate locks to guarantee transactionality.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1521">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an unnecessarily long-held connection in Oracle table name mapping code.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1593">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue where we excessively log after successful transactions.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1687">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue where the <code class="docutils literal notranslate"><span class="pre">_persisted_locks</span></code> table was unnecessarily logged as not having persisted metadata.
The <code class="docutils literal notranslate"><span class="pre">_persisted_locks</span></code> table is a hidden table, and thus it does not need to have persisted metadata.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1696">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now instruments services to expose aggregate response time and service call metrics for keyvalue, timestamp, and lock services.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1685">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span> <span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TransactionManager</span></code> now explicitly declares a <code class="docutils literal notranslate"><span class="pre">close</span></code> method that does not throw exceptions.
This makes the <code class="docutils literal notranslate"><span class="pre">TransactionManager</span></code> significantly easier to develop against.
Clients who have implemented a concrete <code class="docutils literal notranslate"><span class="pre">TransactionManager</span></code> throwing checked exceptions are encouraged to wrap said exceptions as unchecked exceptions.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1677">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Added the following benchmarks for paging over columns of a very wide row:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TransactionGetRowsColumnRangeBenchmarks</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">KvsGetRowsColumnRangeBenchmarks</span></code></p></li>
</ul>
</div></blockquote>
<p>(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1684">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-deprecated">DEPRECATED</span></p></td>
<td><p>The public <code class="docutils literal notranslate"><span class="pre">PaxosLeaderElectionService</span></code> constructor is now deprecated to mitigate risks of users supplying parameters in the wrong order.
<code class="docutils literal notranslate"><span class="pre">PaxosLeaderElectionServiceBuilder</span></code> should be used instead.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1681">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-35-0">
<h2>v0.35.0<a class="headerlink" href="#v0-35-0" title="Permalink to this headline"></a></h2>
<p>3 Mar 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Timelock server now specifies minimum and maximum heap size of 512 MB.
This should improve GC performance per the comments in <a class="reference external" href="https://github.com/palantir/atlasdb/pull/1594#discussion_r102255336">#1594</a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1647">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The background sweeper now uses deleteRange instead of truncate when clearing the <code class="docutils literal notranslate"><span class="pre">sweep.progress</span></code> table.
This allows users with Postgres to perform backups via the normal pg_dump command while running background sweep.
Previous it was possible for a backup to fail if sweep were performing a truncate at the same time.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1616">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Cassandra now attempts to truncate when performing a <code class="docutils literal notranslate"><span class="pre">deleteRange(RangeRequest.All())</span></code> in an effort to build up less garbage.
This is relevant for when sweep is operating on its own sweep tables.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1617">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Users can now create a Docker image and run containers of the Timelock Server, by running <code class="docutils literal notranslate"><span class="pre">./gradlew</span> <span class="pre">timelock-server:dockerTag</span></code>.
This can be useful for quickly spinning up a Timelock instance (e.g. for testing purposes).
Note that we are not yet publishing this image.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1661">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB <a class="reference internal" href="../cluster_management/clis.html#clis"><span class="std std-ref">CLIs</span></a> run via the Dropwizard bundle can now work with a Timelock block, and will contact the relevant Timelock server for timestamps or locks in this case.
Previously, these CLIs would throw an error that a leader block was not specified.
Note that CLIs will not perform automated migrations.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1661">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Cassandra truncates that are going to fail will do so faster.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1660">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>The persistent lock endpoints now use <code class="docutils literal notranslate"><span class="pre">PersistentLockId</span></code> instead of <code class="docutils literal notranslate"><span class="pre">LockEntry</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1665">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">CheckAndSetException</span></code> now gets mapped to the correct response for compatibility with <a class="reference external" href="https://github.com/palantir/http-remoting">http-remoting</a>.
Previously, any consumer using http-remoting would have to deal with deserialization errors.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1665">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>The persistent lock release endpoint has now been renamed to <code class="docutils literal notranslate"><span class="pre">releaseBackupLock</span></code> since it is currently only supposed to be used for the backup lock.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1674">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-34-0">
<h2>v0.34.0<a class="headerlink" href="#v0-34-0" title="Permalink to this headline"></a></h2>
<p>23 Feb 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Timelock server now supports <a class="reference external" href="https://http2.github.io/">HTTP/2</a>, and the AtlasDB HTTP clients enable a required GCM cipher suite.
This feature improves performance of the Timelock server.
Any client that wishes to connect to the timelock server via HTTP/2 must add jetty_alpn_agent as a javaAgent JVM argument, otherwise connections will fall back to HTTP/1.1 and performance will be considerably slower.</p>
<p>For an example of how to add this dependency, see our <a class="reference external" href="https://github.com/palantir/atlasdb/pull/1594/files#diff-e7db4468f37a8004be3c399d791c323eR57">timelock-server/build.gradle</a> file.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1594">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB <a class="reference internal" href="../performance/benchmarking.html#perf-cli"><span class="std std-ref">Perf CLI</span></a> can now output KVS-agnostic benchmark data (such as <code class="docutils literal notranslate"><span class="pre">HttpBenchmarks</span></code>) to a file.
Previously running these benchmarks whilst attempting to write output to a file would fail.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1635">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-33-0">
<h2>v0.33.0<a class="headerlink" href="#v0-33-0" title="Permalink to this headline"></a></h2>
<p>22 Feb 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB HTTP clients are now compatible with OkHttp 3.3.0+, and no longer assume that header names are specified in Train-Case.
This fix enables the Timelock server and AtlasDB clients to use HTTP/2.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1613">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Canonicalised SQL strings will now have contiguous whitespace rendered as a single space as opposed to the first character of said whitespace.
This is important for backwards compatibility with an internal product.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1603">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Added the option to perform a dry run of sweep via the <a class="reference internal" href="../cluster_management/sweep/standard/sweep-cli.html#atlasdb-sweep-cli"><span class="std std-ref">Sweep CLI</span></a>.
When <code class="docutils literal notranslate"><span class="pre">--dry-run</span></code> is set, sweep will tell you how many cells would have been deleted, but will not actually delete any cells.</p>
<p>This feature was introduced to avoid accidentally generating more tombstones than the Cassandra tombstone threshold (default 100k) introduced in <a class="reference external" href="https://issues.apache.org/jira/browse/CASSANDRA-6117">CASSANDRA-6117</a>.
If you delete more than 100k cells and thus cross the Cassandra threshold, then Cassandra may reject read requests until the tombstones have been compacted away.
Customers wishing to run Sweep should first run with the <code class="docutils literal notranslate"><span class="pre">--dry-run</span></code> option and only continue if the number of cells to be deleted is fewer than 100k.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1598">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed atlasdb-commons Java 1.6 compatibility by removing tracing from <code class="docutils literal notranslate"><span class="pre">InterruptibleProxy</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1599">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Persisted locks table is now considered an Atomic Table.</p>
<p><code class="docutils literal notranslate"><span class="pre">ATOMIC_TABLES</span></code> are those that must always exist on KVSs that support check-and-set (CAS) operations.
This is particularly relevant for AtlasDB clients that make use of the TableSplittingKVS and want to keep tables on different KVSs.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1610">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Reverted PR #1577 in 0.32.0 because this change prevents AtlasDB clients from downgrading to earlier versions of AtlasDB.
We will merge a fix for MRTSE once we have a solution that allows a seamless rollback process.
This change is also reverted on 0.32.1.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1622">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Reduced contention on <code class="docutils literal notranslate"><span class="pre">PersistentTimestampService.getFreshTimestamps</span></code> to provide performance improvements to the Timestamp service under heavy request load.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1618">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-32-1">
<h2>v0.32.1<a class="headerlink" href="#v0-32-1" title="Permalink to this headline"></a></h2>
<p>21 Feb 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Reverted PR #1577 in 0.32.0 because this change prevents AtlasDB clients from downgrading to earlier versions of AtlasDB.
We will merge a fix for MRTSE once we have a solution that allows a seamless rollback process.
This change is also reverted on develop.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1622">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-32-0">
<h2>v0.32.0<a class="headerlink" href="#v0-32-0" title="Permalink to this headline"></a></h2>
<p>16 Feb 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed erroneous occurrence of <code class="docutils literal notranslate"><span class="pre">MultipleRunningTimestampServicesError</span></code> (see <a class="reference external" href="https://github.com/palantir/atlasdb/issues/1000">#1000</a>) where the timestamp service was unaware of successfully writing the new timestamp limit to the DB.
This fix only applies to Cassandra backed AtlasDB clients who are not using the external Timelock service.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1577">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB HTTP clients will now have a user agent of <code class="docutils literal notranslate"><span class="pre">&lt;project.name&gt;-atlasdb</span> <span class="pre">(project.version)</span></code> as opposed to <code class="docutils literal notranslate"><span class="pre">okhttp/2.5.0</span></code>.
This should make distinguishing AtlasDB request logs from application request logs much easier.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1535">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Sweep now takes out a lock to ensure data is not corrupted during online backups.</p>
<p>Users performing live backups should grab this lock before performing a backup of the underlying KVS, and then release the lock once the backup is complete.
This enables the backup to safely run alongside either the <a class="reference internal" href="../cluster_management/sweep/standard/background-sweep.html#background-sweep"><span class="std std-ref">background sweeper</span></a> or the <a class="reference internal" href="../cluster_management/sweep/standard/sweep-cli.html#atlasdb-sweep-cli"><span class="std std-ref">sweep CLI</span></a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1509">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Initial support for tracing Key Value Services integrating with <a class="reference external" href="https://github.com/palantir/http-remoting#tracing">http-remoting tracing</a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1385">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Improved heap usage during heavy DBKVS querying by reducing mallocs in <code class="docutils literal notranslate"><span class="pre">SQLString.canonicalizeString()</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1560">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Removed an unused hamcrest import from the timestamp-impl project.
This should reduce the size of our transitive dependencies, and therefore the size of product binaries.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1578">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed schema generation with Java 8 optionals.
To use Java8 optionals, supply <code class="docutils literal notranslate"><span class="pre">OptionalType.JAVA8</span></code> as an additional constructor argument when creating your <code class="docutils literal notranslate"><span class="pre">Schema</span></code> object.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1501">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Modified the type signature of <code class="docutils literal notranslate"><span class="pre">BatchingVisitableView#of</span></code> to no longer accept <code class="docutils literal notranslate"><span class="pre">final</span> <span class="pre">BatchingVisitable&lt;?</span> <span class="pre">extends</span> <span class="pre">T&gt;</span> <span class="pre">underlyingVisitable</span></code> and instead accept <code class="docutils literal notranslate"><span class="pre">final</span> <span class="pre">BatchingVisitable&lt;T&gt;</span> <span class="pre">underlyingVisitable</span></code>.
This will resolve an issue where newer versions of Intellij fail to compile AtlasDB.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1582">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Reduced logging noise from large Cassandra gets and puts by removing ERROR messages and only providing stacktraces at DEBUG.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1590">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Upon startup of an AtlasDB client with a <code class="docutils literal notranslate"><span class="pre">timeblock</span></code> <a class="reference internal" href="../configuration/external_timelock_service_configs/timelock_client_config.html#timelock-client-configuration"><span class="std std-ref">config block</span></a>, the client will now automatically migrate its timestamp to the the <a class="reference internal" href="../services/timelock_service/index.html#external-timelock-service"><span class="std std-ref">external Timelock cluster</span></a>.</p>
<p>The client will fast-forward the Timelock Server’s timestamp bound to that of the embedded service.
The client will now also <em>invalidate</em> the embedded service’s bound, backing this up in a separate row in the timestamp table.</p>
<p>Automated migration is only supported for Cassandra KVS at the moment.
If using DBKVS or other key-value services, it remains the user’s responsibility to ensure that they have performed the migration detailed in <a class="reference internal" href="../services/timelock_service/migration.html#timelock-migration"><span class="std std-ref">Migration to External Timelock Services</span></a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1569">Pull Request 1</a>,
<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1570">Pull Request 2</a>, and
<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1579">Pull Request 3</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed multiple scenarios where DBKVS can run into deadlocks due to unnecessary connections.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1566">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-31-0">
<h2>v0.31.0<a class="headerlink" href="#v0-31-0" title="Permalink to this headline"></a></h2>
<p>8 Feb 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Improved Oracle performance on DBKVS by preventing excessive reads from the _namespace table when initializing SweepStrategyManager.
Replaced <code class="docutils literal notranslate"><span class="pre">mapToFullTableNames()</span></code> with <code class="docutils literal notranslate"><span class="pre">generateMapToFullTableNames()</span></code> in <code class="docutils literal notranslate"><span class="pre">com.palantir.atlasdb.keyvalue.TableMappingService</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1486">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Removed the unused <code class="docutils literal notranslate"><span class="pre">TieredKeyValueService</span></code> which offered the ability to spread tables across multiple KVSs that exist in a stacked hierarchy (primary &amp; secondary).
If you require this KVS please file a ticket to have it reinstated.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1553">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Fast forwarding a persistent timestamp service to <code class="docutils literal notranslate"><span class="pre">Long.MIN_VALUE</span></code> will now throw an exception, whereas previously it would be a no-op.
Calling the <code class="docutils literal notranslate"><span class="pre">fast-forward</span></code> endpoint without specifying the fast-forward timestamp parameter will now default to submitting <code class="docutils literal notranslate"><span class="pre">Long.MIN_VALUE</span></code>, and thus return a HTTP 400 response.</p>
<p>We are introducing this break to prevent accidental corruption by forgetting to submit the fast-forward timestamp.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1538">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Oracle queries now use the correct hints when generating the query plan.
This will improve performance for Oracle on DB KVS.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1549">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>Oracle table names can now have a maximum length of 27 characters instead of the previous limit of 30.
This is to ensure consistency in naming the primary key constraint which adds a prefix of <code class="docutils literal notranslate"><span class="pre">pk_</span></code> to the table name.
This will break any installation of Oracle with the <code class="docutils literal notranslate"><span class="pre">useTableMapping</span></code> flag set to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<p>Since Oracle support is still in beta, we are not providing an automatic migration path from older versions of AtlasDB.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1552">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Support for Oracle 12c batch responses.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1540">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-30-0">
<h2>v0.30.0<a class="headerlink" href="#v0-30-0" title="Permalink to this headline"></a></h2>
<p>27 Jan 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span> <span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Fixed schema generation with Java 8 optionals.
To use Java8 optionals, supply <code class="docutils literal notranslate"><span class="pre">OptionalType.JAVA8</span></code> as an additional constructor argument when creating your <code class="docutils literal notranslate"><span class="pre">Schema</span></code> object.</p>
<p>Additionally, this fix requires all AtlasDB clients to regenerate their schema, even if they do not use the Java 8 optionals.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1501">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Prevent deadlocks in an edge case where we perform parallel reads with a small connection pool on DB KVS.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1468">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Added support for benchmarking custom Key Value Stores.
In the future this will enable performance regression testing for Oracle.</p>
<p>See our <a class="reference internal" href="../performance/writing.html#performance-writing"><span class="std std-ref">performance writing</span></a> documentation for details.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1459">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Don’t retry interrupted remote calls.</p>
<p>This should have the effect of shutting down faster in situations where we receive a <code class="docutils literal notranslate"><span class="pre">InterruptedException</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1488">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Added request and exception rates metrics in CassandraClientPool. This will provide access to 1-, 5-, and 15-minute moving averages.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1497">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>More informative logging around retrying of transactions.
If a transaction succeeds after being retried, we log the success (at the INFO level).
If a transaction failed, but will be retried, we now also log the number of failures so far (at INFO).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1376">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Updated our dependency on <code class="docutils literal notranslate"><span class="pre">gradle-java-distribution</span></code> from 1.2.0 to 1.3.0.
See gradle-java-distribution <a class="reference external" href="https://github.com/palantir/gradle-java-distribution/releases">release notes</a> for details.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1500">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-29-0">
<h2>v0.29.0<a class="headerlink" href="#v0-29-0" title="Permalink to this headline"></a></h2>
<p>17 Jan 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Returned <code class="docutils literal notranslate"><span class="pre">RemotingKeyValueService</span></code> and associated remoting classes to the AtlasDB code base.
These now live in <code class="docutils literal notranslate"><span class="pre">atlasdb-remoting</span></code>.
This KVS will pass remote calls to a local delegate KVS.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1304">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Stream store compression, introduced in 0.27.0, no longer creates a transaction inside a transaction when streaming directly to a file.
Additionally, a check was added to enforce the condition imposed in 0.28.0, namely that the caller of <code class="docutils literal notranslate"><span class="pre">AbstractGenericStreamStore.loadStream</span></code> should not call <code class="docutils literal notranslate"><span class="pre">InputStream.read()</span></code> within the transaction that was used to fetch the stream.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1460">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>AtlasDB timestamp and lock HTTPS communication now use JVM optimized cipher suite CBC over the slower GCM.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1378">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Added a new <code class="docutils literal notranslate"><span class="pre">KeyValueService</span></code> API method, <code class="docutils literal notranslate"><span class="pre">checkAndSet</span></code>.
This is to be used in upcoming backup lock changes, and is not intended for other usage. If you think your application would benefit from using this directly, please contact the AtlasDB dev team.
This is supported for Cassandra, Postgres, and Oracle, but in the latter case support is only provided for tables which are not overflow tables.
<code class="docutils literal notranslate"><span class="pre">checkAndSet</span></code> is <strong>not</strong> supported for RocksDB or JDBC.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1435">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Reverted the <code class="docutils literal notranslate"><span class="pre">devbreak</span></code> in AtlasDB 0.28.0 by returning the <code class="docutils literal notranslate"><span class="pre">DebugLogger</span></code> to its original location.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1469">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-28-0">
<h2>v0.28.0<a class="headerlink" href="#v0-28-0" title="Permalink to this headline"></a></h2>
<p>13 Jan 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">DebugLogger</span></code> class was moved from package <code class="docutils literal notranslate"><span class="pre">com.palantir.timestamp</span></code> in project <code class="docutils literal notranslate"><span class="pre">timestamp-impl</span></code> to <code class="docutils literal notranslate"><span class="pre">com.palantir.util</span></code> in project <code class="docutils literal notranslate"><span class="pre">atlasdb-commons</span></code>.
This break is reverted in the next release (AtlasDB 0.29.0) and will not affect services who skip this release.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1445">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Increase default Cassandra pool size from minimum of 20 and maximum of 5x the minimum (100 if minimum not modified) connections to minimum of 30 and maximum of 100 connections.
This has empirically shown better handling of bursts of requests that would otherwise require creating many new connections to Cassandra from the clients.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1402">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Added metrics to SnapshotTransaction to monitor durations of various operations such as <code class="docutils literal notranslate"><span class="pre">get</span></code>, <code class="docutils literal notranslate"><span class="pre">getRows</span></code>, <code class="docutils literal notranslate"><span class="pre">commit</span></code>, etc.
AtlasDB users should use <code class="docutils literal notranslate"><span class="pre">AtlasDbMetrics.setMetricRegistry</span></code> to set a <code class="docutils literal notranslate"><span class="pre">MetricRegistry</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1429">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Added metrics in Cassandra clients to record connection pool statistics and exception rates.
These metrics use the global <code class="docutils literal notranslate"><span class="pre">AtlasDbRegistry</span></code> metrics.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1380">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>There is now a <code class="docutils literal notranslate"><span class="pre">TimestampMigrationService</span></code> with the <code class="docutils literal notranslate"><span class="pre">fast-forward</span></code> method that can be used to migrate between timestamp services.
You will simply need to fast-forward the new timestamp service using the latest timestamp from the old service.
This can be done using the <a class="reference internal" href="../cluster_management/clis.html#offline-clis"><span class="std std-ref">timestamp forward cli</span></a> when your AtlasDB services are offline.</p>
<p>This capability was added so we can automate the migration to an external Timelock service in a future release.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1445">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Allow tables declared with <code class="docutils literal notranslate"><span class="pre">SweepStrategy.THOROUGH</span></code> to be migrated during a KVS migration.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1410">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fix an issue with stream store where pre-loading the first block of an input stream caused us to create a transaction inside another transaction.
To avoid this issue, it is now the caller’s responsibility to ensure that <code class="docutils literal notranslate"><span class="pre">InputStream.read()</span></code> is not called within the transaction used to fetch the stream.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1447">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">atlasdb-rocksdb</span></code> is no longer required by <code class="docutils literal notranslate"><span class="pre">atlasdb-cli</span></code> and therefore will no longer be packaged with AtlasDB clients pulling in <code class="docutils literal notranslate"><span class="pre">atlasdb-dropwizard-bundle</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1439">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>All SnapshotTransaction <code class="docutils literal notranslate"><span class="pre">get</span></code> methods are now safe for tables declared with SweepStrategy.THOROUGH.
Previously, a validation check was omitted for <code class="docutils literal notranslate"><span class="pre">getRowsColumnRange</span></code>, <code class="docutils literal notranslate"><span class="pre">getRowsIgnoringLocalWrites</span></code>, and <code class="docutils literal notranslate"><span class="pre">getIgnoringLocalWrites</span></code>, which in very rare cases could have resulted in deleted values being returned by a long-running read transaction.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1421">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>Users must not create a client named <code class="docutils literal notranslate"><span class="pre">leader</span></code>. AtlasDB Timelock Server will fail to start if this is found.
Previously, using <code class="docutils literal notranslate"><span class="pre">leader</span></code> would have silently failed, since the JAXRS 3.7.2 algorithm does not include backtracking over
root resource classes (so either leader election or timestamp requests would have failed).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1442">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-27-2">
<h2>v0.27.2<a class="headerlink" href="#v0-27-2" title="Permalink to this headline"></a></h2>
<p>10 Jan 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue with <code class="docutils literal notranslate"><span class="pre">StreamStore.loadStream</span></code>’s underlying <code class="docutils literal notranslate"><span class="pre">BlockGetter</span></code> where, for non-default block size and in-memory thresholds,
we would incorrectly throw an exception instead of allowing the stream to be created.
This caused an issue when the in-memory threshold was many times larger than the default (47MB for the default block size),
or when the block size was many times smaller (7KB for the default in-memory threshold).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1422">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-27-1">
<h2>v0.27.1<a class="headerlink" href="#v0-27-1" title="Permalink to this headline"></a></h2>
<p>6 Jan 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an edge case in stream stores where we throw an exception for using the exact maximum number of bytes in memory.
This behavior was introduced in 0.27.0 and does not affect stream store usage pre-0.27.0.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1411">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Backoff when receiving a socket timeout to Cassandra to put back pressure on client and to spread out load incurred
on remaining servers when a failover occurs.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1420">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-27-0">
<h2>v0.27.0<a class="headerlink" href="#v0-27-0" title="Permalink to this headline"></a></h2>
<p>6 Jan 2017</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now supports stream store compression.
Streams can be compressed client-side by adding the <code class="docutils literal notranslate"><span class="pre">compressStreamInClient</span></code> option to the stream definition.
Reads from the stream store will transparently decompress the data.</p>
<p>For information on using the stream store, see <a class="reference internal" href="../schemas/streams.html#schemas-streams"><span class="std std-ref">Streams</span></a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1357">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">StreamStore.loadStream</span></code> now actually streams data if it does not fit in memory.
This means that getting the first byte of the stream now has constant-time performance, rather than
linear in terms of stream length as it was previously.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1341">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Increased Cassandra connection pool idle timeout to 10 minutes, and reduced eviction check frequency to 20-30 seconds at 1/10 of connections.
This should reduce bursts of stress on idle Cassandra clusters.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1336">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>There is a new configuration called <code class="docutils literal notranslate"><span class="pre">maxConnectionBurstSize</span></code>, which configures how large the pool is able to grow when receiving a large burst of requests.
Previously this was hard-coded to 5x the <code class="docutils literal notranslate"><span class="pre">poolSize</span></code> (which is now the default for the parameter).</p>
<p>See <a class="reference internal" href="../configuration/key_value_service_configs/cassandra_key_value_service_config.html#cassandra-kvs-config"><span class="std std-ref">Cassandra KVS Config</span></a> for details on configuring AtlasDB with Cassandra.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1336">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Improved the performance of Oracle queries by making the table name cache global to the KVS level.
Keeping the mapping in a cache saves one DB lookup per query, when the table has already been used.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1325">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Oracle value style caching limited in scope to per-KVS, previously per-JVM, which could have in extremely rare cases caused issues for users in non-standard configurations.
This would have caused issues for users doing a KVS migration to move from one Oracle DB to another.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1325">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>We now publish a runnable distribution of AtlasCli that is available for download directly from <a class="reference external" href="https://bintray.com/palantir/releases/atlasdb#files/com/palantir/atlasdb/atlasdb-cli-distribution">Bintray</a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1318">Pull Request 1</a>) and
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1345">Pull Request 2</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Enabled garbage collection logging for CircleCI builds.
This may be useful for investigating pre-merge build failures.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1398">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Updated our dependency on <code class="docutils literal notranslate"><span class="pre">gradle-java-distribution</span></code> from 1.0.1 to 1.2.0.
See gradle-java-distribution <a class="reference external" href="https://github.com/palantir/gradle-java-distribution/releases">release notes</a> for details.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1361">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Add KeyValueStore.deleteRange(); makes large swathes of row deletions faster,
like transaction sweeping. Also can be used as a fallback option for people
having issues with their backup solutions not allowing truncate() during a backup
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1391">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-26-0">
<h2>v0.26.0<a class="headerlink" href="#v0-26-0" title="Permalink to this headline"></a></h2>
<p>5 Dec 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Added Javadocs to <code class="docutils literal notranslate"><span class="pre">CassandraKeyValueService.java</span></code>, <a class="reference external" href="http://palantir.github.io/atlasdb/html/configuration/multinode_cassandra.html">documented</a> the behaviour of <code class="docutils literal notranslate"><span class="pre">CassandraKeyValueService</span></code> when one or more nodes in the Cassandra cluster are down.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1329">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Substantially improved performance of the DBKVS implementation of the single-iterator version of getRowsColumnRange.
Two new performance benchmarks were added as part of this PR:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">KvsGetRowsColumnRangeBenchmarks.getAllColumnsAligned</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">KvsGetRowsColumnRangeBenchmarks.getAllColumnsUnaligned</span></code></p></li>
</ul>
</div></blockquote>
<p>These benchmarks show a 2x improvement on Postgres, and an AtlasDB client has observed an order of magnitude improvement experimentally.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1132">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>OkHttpClient connection pool configured to have 100 idle connections with 10 minute keep-alive, reducing the number of connections that need to be created when a large number of transactions begin.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1294">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Commit timestamp lookups are now cached across transactions.
This provided a near 2x improvement in our performance benchmark testing.
See comments on the pull request for details.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1238">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LockAwareTransactionManager.runTaskWithLocksWithRetry</span></code> now fails faster if given lock tokens that time out in a way that cannot be recovered from.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1322">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>When we hit the <code class="docutils literal notranslate"><span class="pre">MultipleRunningTimestampServicesError</span></code> issue, we now automatically log thread dumps to a separate file (file path specified in service logs).
The full file path of the <code class="docutils literal notranslate"><span class="pre">atlas-timestamps-log</span></code> file will be outputted to the service logs.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1275">Pull Request 1</a>, <a class="reference external" href="https://github.com/palantir/atlasdb/pull/1332">Pull Request 2</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-25-0">
<h2>v0.25.0<a class="headerlink" href="#v0-25-0" title="Permalink to this headline"></a></h2>
<p>25 Nov 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--config-root</span></code> and other global parameters can now be passed into dropwizard CLIs.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1268">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>The migration <code class="docutils literal notranslate"><span class="pre">--config-root</span></code> shorthand (<code class="docutils literal notranslate"><span class="pre">-r</span></code>) can no longer be used as it conflicted with the timestamp command <code class="docutils literal notranslate"><span class="pre">--row</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1268">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Dbkvs: ConnectionSupplier consumers can now choose to receive a brand new unshared connection.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1258">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB now supports Cassandra 3.7 as well as Cassandra 2.2.8.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1206">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Oracle perf improvement; table names now cached, resulting in fewer round trips to the database.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1215">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SweepStatsKeyValueService</span></code> will no longer flush a final batch of statistics during shutdown. This avoids
potentially long pauses that could previously occur when closing a <code class="docutils literal notranslate"><span class="pre">Cleaner</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1232">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Better support for AtlasDB clients running behind load balancers. In particular, if an AtlasDB client falls down and
its load balancer responds with “503: Service Unavailable”, the request will be attempted on other clients rather than aborting.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1175">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Oracle will not drop a table that already exists on  <code class="docutils literal notranslate"><span class="pre">createTable</span></code> calls when multiple AtlasDB clients make the call to create the same table.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1243">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Certain Oracle KVS calls no longer attempt to leak connections created internally.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1215">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>OracleKVS: <code class="docutils literal notranslate"><span class="pre">TableSizeCache</span></code> now invalidates the cache on table delete.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1272">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Our Jackson version has been updated from 2.5.1 to 2.6.7 and Dropwizard version from 0.8.2 to 0.9.3.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1209">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Additional debugging available for those receiving ‘name must be no longer than 1500 bytes’ errors.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1117">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Cell.validateNameValid</span></code> is now private; consider <code class="docutils literal notranslate"><span class="pre">Cell.isNameValid</span></code> instead.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1117">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-24-0">
<h2>v0.24.0<a class="headerlink" href="#v0-24-0" title="Permalink to this headline"></a></h2>
<p>15 Nov 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>All Oracle table names will be truncated and be of the form: <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;_&lt;2-letter-namespace&gt;__&lt;table-name&gt;_&lt;5-digit-int&gt;</span></code>.
Previously we only truncated names that exceeded the character limit for Oracle table names.
This should improve legibility as all table names for a particular application will have identical formatting.</p>
<p>Oracle is in beta, and thus we have not built a migration path from old table names to new table names.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1187">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The fetch timestamp CLI correctly handles <code class="docutils literal notranslate"><span class="pre">--file</span></code> inputs containing non-existent directories by creating any missing intermediate directories.
Previously, the CLI would throw an exception and fail in such cases.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1151">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>When using DBKVS with Oracle, <code class="docutils literal notranslate"><span class="pre">TableRemappingKeyValueService</span></code> does not throw a RuntimeException when performing <code class="docutils literal notranslate"><span class="pre">getMetaData</span></code> and <code class="docutils literal notranslate"><span class="pre">dropTable</span></code> operations on a non-existent table.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1186">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The KVS migration CLI will now decrypt encrypted values in your KVS configuration.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1171">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>If using the Dropwizard command to run a KVS migration, the Dropwizard config will be used as the <code class="docutils literal notranslate"><span class="pre">--migrateConfig</span></code> config if none is specified.
Running the KVS migration command as a deployable CLI still requires <code class="docutils literal notranslate"><span class="pre">--migrateConfig</span></code>.</p>
<p>See the <a class="reference internal" href="../cluster_management/clis.html#clis-migrate"><span class="std std-ref">documentation</span></a> for details on how to use the KVS migration command.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1171">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The timestamp bound store now works with Oracle as a relational backing store.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1224">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>CLIs now output to standard out, standard error, and the service logs, rather than only printing to the service logs.
This should greatly improve usability for service admins using the CLIs.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1177">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Remove usage of <code class="docutils literal notranslate"><span class="pre">createUnsafe</span></code> in generated Schema code. You can regenerate your schema to get rid of the deprecation warnings.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1194">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">atlasdb-cassandra</span></code> now depends on <code class="docutils literal notranslate"><span class="pre">cassandra-thrift</span></code> instead of <code class="docutils literal notranslate"><span class="pre">cassandra-all</span></code>.
Applications that support <a class="reference internal" href="../configuration/key_value_service_configs/cassandra_key_value_service_config.html#cassandra-configuration"><span class="std std-ref">CassandraKVS</span></a> will see a 20MB (10%) decrease in their Cassandra dependency footprint.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1222">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Add support for generating schemas with Java8 Optionals instead of Guava Optionals.
To use Java8 optionals, supply <code class="docutils literal notranslate"><span class="pre">OptionalType.JAVA8</span></code> as an additional constructor argument when creating your <code class="docutils literal notranslate"><span class="pre">Schema</span></code> object.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1162">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-23-0">
<h2>v0.23.0<a class="headerlink" href="#v0-23-0" title="Permalink to this headline"></a></h2>
<p>8 Nov 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>All KVSs now as a guarantee throw a RuntimeException on attempts to truncate a non-existing table, so services should check the existence of a table before attempting to truncate.
Previously we would only throw exceptions for the Cassandra KVS.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1114">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The KVS <a class="reference internal" href="../cluster_management/clis.html#clis-migrate"><span class="std std-ref">migration</span></a> command now supports the <code class="docutils literal notranslate"><span class="pre">--offline</span></code> flag and can be run as an offline CLI.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1149">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-deprecated">DEPRECATED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TableReference.createUnsafe</span></code> is now deprecated to prevent mishandling of table names.
<code class="docutils literal notranslate"><span class="pre">createWithEmptyNamespace</span></code> or <code class="docutils literal notranslate"><span class="pre">createFromFullyQualifiedName</span></code> should be used instead.</p>
<p>Schema generated code still contains use of <code class="docutils literal notranslate"><span class="pre">TableReference.createUnsafe</span></code> and is being tracked for removal on <a class="reference external" href="https://github.com/palantir/atlasdb/issues/1172">#1172</a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1121">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>We now provide Oracle support (beta) for all valid schemas.
Oracle table names exceeding 30 characters are now mapped to shorter names by truncating and appending a sequence number.
Support for Oracle is currently in beta and services wishing to deploy against Oracle should contact the AtlasDB team.</p>
<p>See <a class="reference internal" href="../schemas/oracle_table_mapping.html#oracle-table-mapping"><span class="std std-ref">Oracle Table Mapping</span></a> for details on how table names are mapped.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1076">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>We now test against Cassandra 2.2.8, rather than Cassandra 2.2.7.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1112">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Added a significant amount of logging aimed at tracking down the <code class="docutils literal notranslate"><span class="pre">MultipleRunningTimestampServicesError</span></code>.
If clients are hitting this error, then they should add TRACE logging for <code class="docutils literal notranslate"><span class="pre">com.palantir.timestamp</span></code>.
These logs can also be directed to a separate file, see the <a class="reference internal" href="../configuration/logging.html#logging-configuration"><span class="std std-ref">documentation</span></a> for more details.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1098">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Retrying a Cassandra operation now retries against distinct hosts.
Previously, this would independently select hosts randomly, meaning that we might unintentionally try the same operation on the same servers.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1139">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB clients can start when a single Cassandra node is unreachable.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1045">Pull Request</a>).</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Removed spurious error logging during first-time startup against a brand new Cassandra cluster.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1033">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Improved the reliability of starting up against a degraded Cassandra cluster.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1033">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>No longer publish a spurious junit dependency in atlasdb-client compile.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1176">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-22-0">
<h2>v0.22.0<a class="headerlink" href="#v0-22-0" title="Permalink to this headline"></a></h2>
<p>28 Oct 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">clean-cass-locks-state</span></code> CLI clears the schema mutation lock by setting it to a special “cleared” value in the same way that normal lockholders clear the lock.
Previously the CLI would would drop the whole <code class="docutils literal notranslate"><span class="pre">_locks</span></code> table to clear the schema mutation lock.</p>
<p>See <a class="reference internal" href="../schemas/migrating_schemas.html#schema-mutation-lock"><span class="std std-ref">Schema Mutation Lock (Cassandra only)</span></a> for details on how the schema mutation lock works.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1056">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue where some locks were not being tracked for continuous refreshing due to one of the lock methods not being overridden by the <code class="docutils literal notranslate"><span class="pre">LockRefreshingLockService</span></code>.
This resulted in locks that appeared to be refreshed properly, but then would mysteriously time out at the end of a long-running operation.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1134">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Sweep no longer immediately falls back to a <code class="docutils literal notranslate"><span class="pre">sweepBatchSize</span></code> of 1 after receiving an error.</p>
<p>See <a class="reference internal" href="../cluster_management/sweep/standard-sweep.html#sweep-tunable-parameters"><span class="std std-ref">sweep tuning</span></a> documentation for more information on sweep tuning parameters.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1093">Pull Request</a>)</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="v0-21-1">
<h2>v0.21.1<a class="headerlink" href="#v0-21-1" title="Permalink to this headline"></a></h2>
<p>24 Oct 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a regression with Cassandra KVS where you could no longer create a table if it has the same name as another table in a different namespace.</p>
<p>To illustrate the issue, assume you have namespace <code class="docutils literal notranslate"><span class="pre">namespace1</span></code> and the table <code class="docutils literal notranslate"><span class="pre">table1</span></code>, and you would like to add a column to <code class="docutils literal notranslate"><span class="pre">table1</span></code> and <cite>version</cite> the table by using the new namespace <code class="docutils literal notranslate"><span class="pre">namespace2</span></code>.
On disk you already have the Cassandra table <code class="docutils literal notranslate"><span class="pre">namespace1__table1</span></code>, and now you are trying to create <code class="docutils literal notranslate"><span class="pre">namespace2__table1</span></code>.
Creating <code class="docutils literal notranslate"><span class="pre">namespace2__table1</span></code> would fail because Cassandra KVS believes that the table already exists.
This is relevant if you use multiple namespaces when performing schema migrations.</p>
<p>Note that namespace is an application level abstraction defined as part of a AtlasDB schema and is not the same as Cassandra keyspace.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1110">Pull Request</a>)</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="v0-21-0">
<h2>v0.21.0<a class="headerlink" href="#v0-21-0" title="Permalink to this headline"></a></h2>
<p>21 Oct 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Sweep now supports batching on a per-cell level via the <code class="docutils literal notranslate"><span class="pre">sweepCellBatchSize</span></code> parameter in your AtlasDB config.
This can decrease Sweep memory consumption on the client side if your tables have large cells or many columns (i.e. wide rows).
For information on how to configure Sweep batching, see the <a class="reference internal" href="../cluster_management/sweep/standard/sweep-cli.html#atlasdb-sweep-cli"><span class="std std-ref">sweep documentation</span></a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1068">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>If <code class="docutils literal notranslate"><span class="pre">hashFirstRowComponent()</span></code> is used in a table or index definition, we no longer throw <code class="docutils literal notranslate"><span class="pre">IllegalStateException</span></code> when generating schema code.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1091">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-20-0">
<h2>v0.20.0<a class="headerlink" href="#v0-20-0" title="Permalink to this headline"></a></h2>
<p>19 Oct 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Hotspotting warnings, previously logged at ERROR, will now throw <code class="docutils literal notranslate"><span class="pre">IllegalStateException</span></code> when generating your schema code.
Products who hit this warning will need to add <code class="docutils literal notranslate"><span class="pre">ignoreHotspottingChecks()</span></code> to the relevant tables of their schema, or modify their schemas such that the first row component is not a VAR_STRING, a VAR_LONG, a VAR_SIGNED_LONG, or a SIZED_BLOB.</p>
<p>See documentation on <a class="reference internal" href="../schemas/overview.html#primitive-valuetypes"><span class="std std-ref">primitive value types</span></a> and <a class="reference internal" href="../schemas/tables_and_indices.html#tables-and-indices-partitioners"><span class="std std-ref">partitioners</span></a> for information on how to address your schemas.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/947">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The AtlasDB Console included in the Dropwizard bundle can startup in an “online” mode, i.e. it can connect to a running cluster.</p>
<p>See <a class="reference internal" href="../cluster_management/console.html#console"><span class="std std-ref">AtlasDB Console</span></a> for information on how to use AtlasDB console.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1063">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">atlasdb-dagger</span></code> project now publishes a shadowed version so we do not rely on the version of dagger on the classpath.
This fixes the issue where running the CLIs would cause a <code class="docutils literal notranslate"><span class="pre">ClassNotFoundException</span></code> if your application also makes use of dagger.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1065">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Oracle is supported via DBKVS if you have runtime dependency on an Oracle driver that resolves the JsonType “jdbcHandler”.
Due to an Oracle limitation, all table names in the schema must be less than 30 characters long.</p>
<p>See <a class="reference internal" href="../configuration/key_value_service_configs/oracle_key_value_service_config.html#oracle-configuration"><span class="std std-ref">Oracle KVS Configuration</span></a> for details on how to configure your service to use Oracle.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/985">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The DBKVS config now enforces that the namespace must always be empty for <code class="docutils literal notranslate"><span class="pre">metadataTable</span></code> in the <code class="docutils literal notranslate"><span class="pre">ddl</span></code> block.
The <code class="docutils literal notranslate"><span class="pre">metadataTable</span></code> parameter defaults to an empty name space, and if this was configured to be anything else previously, DBKVS would not start.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/985">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>We have changed the default <code class="docutils literal notranslate"><span class="pre">tablePrefix</span></code> for <code class="docutils literal notranslate"><span class="pre">OracleDdlConfig</span></code> to be <code class="docutils literal notranslate"><span class="pre">a_</span></code>.
Previously this would default to be empty and so user-defined tables could have a leading underscore, which is an invalid table name for Oracle.
This change is specific to Oracle and does not affect DBKVS on Postgres.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/985">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">metadataTableName</span></code> for Oracle is now <code class="docutils literal notranslate"><span class="pre">atlasdb_metadata</span></code> instead of <code class="docutils literal notranslate"><span class="pre">_metadata</span></code>.
This is due to Oracle’s restriction of not allowing table names with a leading underscore.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/985">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-19-0">
<h2>v0.19.0<a class="headerlink" href="#v0-19-0" title="Permalink to this headline"></a></h2>
<p>11 Oct 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Removed KeyValueService <code class="docutils literal notranslate"><span class="pre">initializeFromFreshInstance</span></code>, <code class="docutils literal notranslate"><span class="pre">tearDown</span></code>, and <code class="docutils literal notranslate"><span class="pre">getRangeWithHistory</span></code>.
It is likely all callers of tearDown just want to call close, and getRangeWithHistory has been replaced with <code class="docutils literal notranslate"><span class="pre">getRangeOfTimestamps</span></code>.
Also removed Partitioning and Remoting KVSs, which were unused and had many unimplemented methods.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1041">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>In Cassandra KVS, we now no longer take out the schema mutation lock in calls to <code class="docutils literal notranslate"><span class="pre">createTables</span></code> if tables already exist.
This fixes the issue that prevented the <code class="docutils literal notranslate"><span class="pre">clean-cass-locks-state</span></code> CLI from running correctly.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/991">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Added a wait period before declaring someone dead based on lack of heartbeat.
This will ensure we handle delayed heartbeats in high load situations (eg. on circleci).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1035">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><dl class="simple">
<dt>Removed the following classes and interfaces that appeared to be unused:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">AbstractStringCollector</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BatchRowVisitor</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ChunkedRowVisitor</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CloseShieldedKeyValueService</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DBMgrConfigurationException</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IdGenerator</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ManyHostPoolingContainer</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MapCollector</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PalantirSequenceEnabledSqlConnection</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PalantirSqlConnectionRunner</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PaxosLearnerPersistence</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PaxosPingablePersistence</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PaxosProtos</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PostgresBlobs</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RowWrapper</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SqlConnectionImpl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SqlStackLogWrapper</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">StringCollector</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TLongQueue</span></code></p></li>
</ul>
</dd>
</dl>
<p>Please reach out to us if you are adversely affected by these removals.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1027">Pull Request 1</a> and <a class="reference external" href="https://github.com/palantir/atlasdb/pull/1027">Pull Request 2</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>The SQL connection manager will no longer temporarily increase the pool size by <a class="reference external" href="https://github.com/palantir/atlasdb/pull/971/files#diff-f0027e21eb0fc2a30cf8b011cc0a1adbL358">eleven</a> connections when the pool is exhausted.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/971">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-18-0">
<h2>v0.18.0<a class="headerlink" href="#v0-18-0" title="Permalink to this headline"></a></h2>
<p>3 Oct 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed a bug introduced in 0.17.0, where products upgraded to 0.17.0 would see a “dead heartbeat” error on first start-up, requiring users to manually truncate the <code class="docutils literal notranslate"><span class="pre">_locks</span></code> table.
Upgrading to AtlasDB 0.18.0 from any previous version will work correctly without requiring manual intervention.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1016">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Dropping a table and then creating it again no longer adds an additional row to the <code class="docutils literal notranslate"><span class="pre">_metadata</span></code> table.
Historical versions of the metadata entry before the most recent one are <strong>not</strong> deleted, so if you routinely drop and recreate the same table, you might consider <a class="reference internal" href="../cluster_management/sweep.html#sweep"><span class="std std-ref">sweeping</span></a> the <code class="docutils literal notranslate"><span class="pre">_metadata</span></code> table.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/946">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Users of DBKVS can now set arbitrary connection parameters.
This is useful if, for example, you wish to boost performance by adjusting the default batch size for fetching rows from the underlying database.
See the <a class="reference internal" href="../configuration/key_value_service_configs/postgres_key_value_service_config.html#postgres-configuration"><span class="std std-ref">documentation</span></a> for how to set these parameters, and <a class="reference external" href="https://jdbc.postgresql.org/documentation/head/connect.html">the JDBC docs</a> for a full list.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/1001">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-17-0">
<h2>v0.17.0<a class="headerlink" href="#v0-17-0" title="Permalink to this headline"></a></h2>
<p>28 Sept 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The schema mutation lock holder now writes a “heartbeat” to the database to indicate that it is still responsive.
Other processes that are waiting for the schema mutation lock will now be able to see this heartbeat, infer that the lock holder is still working, and wait for longer.
This should reduce the need to manually truncate the locks table.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/934">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">hashFirstRowComponent</span></code> can now be used on index definitions to prevent hotspotting when creating schemas.
For more information on using <code class="docutils literal notranslate"><span class="pre">hashFirstRowComponent</span></code>, see the <a class="reference internal" href="../schemas/tables_and_indices.html#tables-and-indices-partitioners"><span class="std std-ref">Partitioners</span></a> documentation.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/986">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-16-0">
<h2>v0.16.0<a class="headerlink" href="#v0-16-0" title="Permalink to this headline"></a></h2>
<p>26 Sept 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Removed <code class="docutils literal notranslate"><span class="pre">TransactionManager</span></code> implementations <code class="docutils literal notranslate"><span class="pre">ShellAwareReadOnlyTransactionManager</span></code> and <code class="docutils literal notranslate"><span class="pre">AtlasDbBackendDebugTransactionManager</span></code>.
These are no longer supported by AtlasDB and products are not expected to use them.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/939">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TransactionMangers.create()</span></code> now accepts <code class="docutils literal notranslate"><span class="pre">LockServerOptions</span></code> which can be used to apply configurations to the embedded LockServer instance running in the product.
The other <code class="docutils literal notranslate"><span class="pre">create()</span></code> methods will continue to use <code class="docutils literal notranslate"><span class="pre">LockServerOptions.DEFAULT</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/984">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p><a class="reference internal" href="../configuration/key_value_service_configs/cassandra_key_value_service_config.html#cassandra-sweep-config"><span class="std std-ref">Column paging Sweep</span></a> (in beta) correctly handles cases where table names have both upper and lowercase characters and cases where sweep is run multiple times on the same table.
If you are using the regular implementation of Sweep (i.e. you do not specify <code class="docutils literal notranslate"><span class="pre">timestampsGetterBatchSize</span></code> in your AtlasDB config), then you are not affected.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/951">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-15-0">
<h2>v0.15.0<a class="headerlink" href="#v0-15-0" title="Permalink to this headline"></a></h2>
<p>14 Sept 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>We have removed references to temp tables and no longer attempt to drop temp tables when aborting transactions.</p>
<p>Temp tables are not currently being used by any KVSs, yet we were still calling <code class="docutils literal notranslate"><span class="pre">dropTempTables()</span></code> when we abort transactions.
Since dropping tables is a schema mutation, this has the side effect of increasing the likelihood that we lose the schema mutation lock when there are many concurrent transactions.
Removing temp tables entirely should reduce the need to manually truncate the locks table.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/916">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>All TransactionManagers are now AutoCloseable and implement a close method that will free up the underlying resources.</p>
<p>If your service implements a <code class="docutils literal notranslate"><span class="pre">TransactionManager</span></code> and does not extend <code class="docutils literal notranslate"><span class="pre">AbstractTransactionManager</span></code>, you now have to add a close method to the implementation.
No operations can be performed using the TransactionManager once it is closed.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/907">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p><a class="reference internal" href="../schemas/physical_cleanup.html#physical-cleanup-sweep"><span class="std std-ref">AtlasDB Sweep</span></a> now uses <a class="reference internal" href="../configuration/key_value_service_configs/cassandra_key_value_service_config.html#cassandra-sweep-config"><span class="std std-ref">column paging</span></a> via the <code class="docutils literal notranslate"><span class="pre">timestampsGetterBatchSize</span></code> parameter to better handle sweeping cells with many historical versions.</p>
<p>By paging over historical versions of cells during sweeping, we can avoid out of memory exceptions in Cassandra when we have particularly large cells or many historical versions of cells.
This feature is only implemented for Cassandra KVS and is disabled by default; please reach out to the AtlasDB dev team if you would like to enable it.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/834">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Added a second implementation of <code class="docutils literal notranslate"><span class="pre">getRowsColumnRange</span></code> method which allows you to page through dynamic columns in a single iterator.
This is expected to perform better than the previous <code class="docutils literal notranslate"><span class="pre">getRowsColumnRange</span></code>, which allows you to page through columns per row with certain KVS stores (e.g. DB KVS).
The new method should be preferred unless it is necessary to page through the results for different rows separately.</p>
<p>Products or clients using wide rows should consider using <code class="docutils literal notranslate"><span class="pre">getRowsColumnRange</span></code> instead of <code class="docutils literal notranslate"><span class="pre">getRows</span></code> in <code class="docutils literal notranslate"><span class="pre">KeyValueService</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/724">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>Added an <a class="reference internal" href="../cluster_management/clis.html#offline-clis"><span class="std std-ref">offline CLI</span></a> called <code class="docutils literal notranslate"><span class="pre">clean-cass-locks-state</span></code> to truncate the locks table when the schema mutation lock has been lost.</p>
<p>This is useful on Cassandra KVS if an AtlasDB client goes down during a schema mutation and does not release the schema mutation lock, preventing other clients from continuing.
Previously an error message would direct users to manually truncate this table with CQL, but now this error message references the CLI.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/888">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Reverted our Dagger dependency from 2.4 to 2.0.2 and shadowed it so that it won’t conflict with internal products.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/926">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-14-0">
<h2>v0.14.0<a class="headerlink" href="#v0-14-0" title="Permalink to this headline"></a></h2>
<p>8 Sept 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TransactionManagers.create()</span></code> no longer takes in an argument of <code class="docutils literal notranslate"><span class="pre">Optional&lt;SSLSocketFactory&gt;</span> <span class="pre">sslSocketFactory</span></code>.
Instead, security settings between AtlasDB clients are now specified directly in configuration via the new optional parameter <code class="docutils literal notranslate"><span class="pre">sslConfiguration</span></code> located in the <code class="docutils literal notranslate"><span class="pre">leader</span></code>, <code class="docutils literal notranslate"><span class="pre">timestamp</span></code>, and <code class="docutils literal notranslate"><span class="pre">lock</span></code> blocks.
Details can be found in the <a class="reference internal" href="../configuration/leader_config.html#leader-config"><span class="std std-ref">Leader Configuration</span></a> documentation.</p>
<p>To assist with back compatibility, we have introduced a helper method <code class="docutils literal notranslate"><span class="pre">AtlasDbConfigs.addFallbackSslConfigurationToAtlasDbConfig</span></code>, which will add the provided <code class="docutils literal notranslate"><span class="pre">sslConfiguration</span></code> to <code class="docutils literal notranslate"><span class="pre">config</span></code> if the SSL configuration is not specified directly in the <code class="docutils literal notranslate"><span class="pre">leader</span></code>, <code class="docutils literal notranslate"><span class="pre">timestamp</span></code>, or <code class="docutils literal notranslate"><span class="pre">lock</span></code> blocks.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/873">Pull Request 1</a> and <a class="reference external" href="https://github.com/palantir/atlasdb/pull/906">Pull Request 2</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB could startup with a leader configuration that is nonsensical, such as specifying both a <code class="docutils literal notranslate"><span class="pre">leader</span></code> block as well as a remote <code class="docutils literal notranslate"><span class="pre">timestamp</span></code> and <code class="docutils literal notranslate"><span class="pre">lock</span></code> blocks.
AtlasDB will now fail to start if your configuration is invalid with a sensible message, per <a class="reference external" href="https://github.com/palantir/atlasdb/issues/790">#790</a>, rather than potentially breaking in unexpected ways.
Please refer to <a class="reference internal" href="../configuration/leader_config.html#leader-config-examples"><span class="std std-ref">Example Leader Configurations</span></a> for guidance on valid configurations.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/854">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed and standardized serialization and deserialization of AtlasDBConfig.
This prevented CLIs deployed via the Dropwizard bundle from loading configuration properly.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/875">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Updated our Dagger dependency from 2.0.2 to 2.4, so that our generated code matches with that of internal products.
This also bumps our Guava dependency from 18.0 to 19.0 to accommodate a Dagger compile dependency.
We plan on shading Dagger in the next release of AtlasDB, but products can force a Guava 18.0 runtime dependency to workaround the issue in the meantime.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/878">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-13-0">
<h2>v0.13.0<a class="headerlink" href="#v0-13-0" title="Permalink to this headline"></a></h2>
<p>30 Aug 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">AtlasDbServer</span></code> has been renamed to <code class="docutils literal notranslate"><span class="pre">AtlasDbServiceServer</span></code>.
Any products that are using this should switch to using the standard AtlasDB java API instead.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/801">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The method <code class="docutils literal notranslate"><span class="pre">updateManyUnregisteredQuery(String</span> <span class="pre">sql)</span></code> has been removed from the <code class="docutils literal notranslate"><span class="pre">SqlConnection</span></code> interface, as it was broken, unused, and unnecessary.
Use <code class="docutils literal notranslate"><span class="pre">updateManyUnregisteredQuery(String</span> <span class="pre">sql,</span> <span class="pre">Iterable&lt;Object[]</span> <span class="pre">list&gt;)</span></code> instead.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/796">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Improved logging for schema mutation lock timeouts and added logging for obtaining and releasing locks.
Removed the advice to restart the client, as it will not help in this scenario.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/805">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Connections to Cassandra can be established over arbitrary ports.
Previously AtlasDB clients would assume the default Cassandra port of 9160 despite what is specified in the <a class="reference internal" href="../configuration/key_value_service_configs/cassandra_key_value_service_config.html#cassandra-kvs-config"><span class="std std-ref">Cassandra keyValueService configuration</span></a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/771">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Fixed an issue when starting an AtlasDB client using the Cassandra KVS where we always grab the schema mutation lock, even if we are not making schema mutations.
This reduces the likelihood of clients losing the schema mutation lock and having to manually truncate the _locks table.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/771">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Performance and reliability enhancements to the in-beta CQL KVS.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/771">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-12-0">
<h2>v0.12.0<a class="headerlink" href="#v0-12-0" title="Permalink to this headline"></a></h2>
<p>22 Aug 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>AtlasDB will always try to register timestamp and lock endpoints for your application, whereas previously this only occurred if you specify a <a class="reference internal" href="../configuration/leader_config.html#leader-config"><span class="std std-ref">Leader Configuration</span></a>.
This ensures that CLIs will be able to run against your service even in the single node case.
For Dropwizard applications, this is only a breaking change if you try to initialize your KeyValueService after having initialized the Dropwizard application.
Note: If you are initializing the KVS post-Dropwizard initialization, then your application will already fail when starting multiple AtlasDB clients.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/708">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>There is now a Dropwizard bundle which can be added to Dropwizard applications.
This will add startup commands to launch the AtlasDB console and <a class="reference internal" href="../cluster_management/clis.html#clis"><span class="std std-ref">CLIs</span></a> suchs as <code class="docutils literal notranslate"><span class="pre">sweep</span></code> and <code class="docutils literal notranslate"><span class="pre">timestamp</span></code>, which is needed to perform backup-restore.
These commands will only work if the server is started with a leader block in its configuration.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/629">Pull Request 1</a> and <a class="reference external" href="https://github.com/palantir/atlasdb/pull/696">Pull Request 2</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>DB passwords are no longer output as part of the connection configuration <code class="docutils literal notranslate"><span class="pre">toString()</span></code> methods.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/755">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>All KVSs now come wrapped with ProfilingKeyValueService, which at the TRACE level provides timing information per KVS operation performed by AtlasDB.
See <a class="reference internal" href="../configuration/logging.html#logging-configuration"><span class="std std-ref">Logging Configuration</span></a> for more details.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/798">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-11-4">
<h2>v0.11.4<a class="headerlink" href="#v0-11-4" title="Permalink to this headline"></a></h2>
<p>29 Jul 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Correctly checks the Cassandra client version that determines if Cassandra supports Check And Set operations.
This is a critical bug fix that ensures we actually use our implementation from <a class="reference external" href="https://github.com/palantir/atlasdb/pull/436">#436</a>, which prevents data loss due to the Cassandra concurrent table creation bug described in <a class="reference external" href="https://github.com/palantir/atlasdb/issues/431">#431</a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/751">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-11-2">
<h2>v0.11.2<a class="headerlink" href="#v0-11-2" title="Permalink to this headline"></a></h2>
<p>29 Jul 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">USER BREAK</span></p></td>
<td><p>Reverting behavior introduced in AtlasDB 0.11.0 so the <code class="docutils literal notranslate"><span class="pre">ssl</span></code> property continues to take precedence over the <code class="docutils literal notranslate"><span class="pre">sslConfiguration</span></code> block to allow back-compatibility when using SSL with CassandraKVS.
This means that products can add default truststore and keystore configuration to their AtlasDB config without overriding previously made SSL decisions (setting <code class="docutils literal notranslate"><span class="pre">ssl:</span> <span class="pre">false</span></code> should cause SSL to not be used).</p>
<p>This only affects end users who have deployed products with AtlasDB 0.11.0 or 0.11.1; users upgrading from earlier versions will not see changed behavior.
See <a class="reference internal" href="../configuration/key_value_service_configs/cassandra_key_value_service_config.html#cass-config-ssl"><span class="std std-ref">Communicating Over SSL</span></a> for details on how to configure CassandraKVS with SSL.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/745">Pull Request</a>)</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="v0-11-1">
<h2>v0.11.1<a class="headerlink" href="#v0-11-1" title="Permalink to this headline"></a></h2>
<p>28 Jul 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Removed a check enforcing a leader block config when one was not required.
This prevents AtlasDB 0.11.0 clients from starting if a leader configuration is not specified (i.e. single node clusters).
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/741">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Updated schema table generation to optimize reads with no ColumnSelection specified against tables with fixed columns.
To benefit from this improvement you will need to re-generate your schemas.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/713">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-11-0">
<h2>v0.11.0<a class="headerlink" href="#v0-11-0" title="Permalink to this headline"></a></h2>
<p>27 Jul 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Clarified the logging when multiple timestamp servers are running to state that CLIs could be causing the issue.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/719">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Updated cassandra client from 2.2.1 to 2.2.7 and cassandra docker testing version from 2.2.6 to 2.2.7.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/699">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The leader config now contains a new <code class="docutils literal notranslate"><span class="pre">lockCreator</span></code> option, which specifies the single node that creates the locks table when starting your cluster for the very first time.
This configuration prevents an extremely unlikely race condition where multiple clients can create the locks table simultaneously.
Full details on the failure scenario can be found on <a class="reference external" href="https://github.com/palantir/atlasdb/issues/444#issuecomment-221612886">#444</a>.</p>
<p>If left blank, <code class="docutils literal notranslate"><span class="pre">lockCreator</span></code> will default to the first host in the <code class="docutils literal notranslate"><span class="pre">leaders</span></code> list, but we recommend setting this explicitly to ensure that the lockCreater is the same value across all your clients for a specific service.
This configuration is only relevant for new clusters and does not affect existing AtlasDB clusters.</p>
<p>Full details for configuring the leader block, see <a class="reference external" href="https://palantir.github.io/atlasdb/html/configuration/cassandra_KVS_configuration.html">cassandra configuration</a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/594">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>A utility method was removed in the previous release, breaking an internal product that relied on it.
This method has now been added back.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/661">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Removed unnecessary error message for missing _timestamp metadata table.
_timestamp is a hidden table, and it is expected that _timestamp metadata should not be retrievable from public API.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/716">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Trace logging is more informative and will log all failed calls.
To enable trace logging, see <a class="reference external" href="https://palantir.github.io/atlasdb/html/configuration/enabling_cassandra_tracing.html#enabling-cassandra-tracing">Enabling Cassandra Tracing</a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/700">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>The Cassandra KVS now supports specifying SSL options via the new <code class="docutils literal notranslate"><span class="pre">sslConfiguration</span></code> block, which takes precedence over the now deprecated <code class="docutils literal notranslate"><span class="pre">ssl</span></code> property.
The <code class="docutils literal notranslate"><span class="pre">ssl</span></code> property will be removed in a future release, and consumers leveraging the Cassandra KVS are encouraged to use the <code class="docutils literal notranslate"><span class="pre">sslConfiguration</span></code> block instead.
See the <a class="reference external" href="https://palantir.github.io/atlasdb/html/configuration/cassandra_KVS_configuration.html#communicating-over-ssl">Cassandra SSL Configuration</a> documentation for more details.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/638">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-10-0">
<h2>v0.10.0<a class="headerlink" href="#v0-10-0" title="Permalink to this headline"></a></h2>
<p>13 Jul 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Updated HikariCP dependency from 2.4.3 to 2.4.7 to comply with updates in internal products.
Details of the HikariCP changes can be found <a class="reference external" href="https://github.com/brettwooldridge/HikariCP/blob/dev/CHANGES">here</a>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/662">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB currently allows you to create dynamic columns (wide rows), but you can only retrieve entire rows or specific columns.
Typically with dynamic columns, you do not know all the columns you have in advance, and this features allows you to page through dynamic columns per row, reducing pressure on the underlying KVS.
Products or clients (such as AtlasDB Sweep) making use of wide rows should consider using <code class="docutils literal notranslate"><span class="pre">getRowsColumnRange</span></code> instead of <code class="docutils literal notranslate"><span class="pre">getRows</span></code> in <code class="docutils literal notranslate"><span class="pre">KeyValueService</span></code>.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/582">Pull Request</a>)</p>
<p>Note: This is considered a beta feature and is not yet being used by AtlasDB Sweep.</p>
</td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>We properly check that cells are not set to empty (zero-byte) or null.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/663">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Cassandra client connection pooling will now evict idle connections over a longer period of time and has improved logic for deciding whether or not a node should be blacklisted.
This should result in less connection churn and therefore lower latency.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/667">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-9-0">
<h2>v0.9.0<a class="headerlink" href="#v0-9-0" title="Permalink to this headline"></a></h2>
<p>11 Jul 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-breaking">DEV BREAK</span></p></td>
<td><p>Inserting an empty (size = 0) value into a <code class="docutils literal notranslate"><span class="pre">Cell</span></code> will now throw an <code class="docutils literal notranslate"><span class="pre">IllegalArgumentException</span></code>. (<a class="reference external" href="https://github.com/palantir/atlasdb/issues/156">#156</a>) Likely empty
values include empty strings and empty protobufs.</p>
<p>AtlasDB cannot currently distinguish between empty and deleted cells. In previous versions of AtlasDB, inserting
an empty value into a <code class="docutils literal notranslate"><span class="pre">Cell</span></code> would delete that cell. Thus, in this snippet,</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">ImmutableMap</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">myCell</span><span class="p">,</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">))</span>
<span class="n">Transaction</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">ImmutableSet</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">myCell</span><span class="p">)).</span><span class="na">get</span><span class="p">(</span><span class="n">myCell</span><span class="p">)</span>
</pre></div>
</div>
<p>the second line will return <code class="docutils literal notranslate"><span class="pre">null</span></code> instead of a zero-length byte array.</p>
<p>To minimize confusion, we explicitly disallow inserting an empty value into a cell by throwing an
<code class="docutils literal notranslate"><span class="pre">IllegalArgumentException</span></code>.</p>
<p>In particular, this change will break calls to <code class="docutils literal notranslate"><span class="pre">Transaction.put(TableReference</span> <span class="pre">tableRef,</span> <span class="pre">Map&lt;Cell,</span> <span class="pre">byte[]&gt;</span> <span class="pre">values)</span></code>,
as well as generated code which uses this method, if any entry in <code class="docutils literal notranslate"><span class="pre">values</span></code> contains a zero-byte array. If your
product does not need to distinguish between empty and non-existent values, simply make sure all the <code class="docutils literal notranslate"><span class="pre">values</span></code>
entries have positive length. If the distinction is necessary, you will need to explicitly differentiate the
two cases (for example, by introducing a sentinel value for empty cells).</p>
<p>If any code deletes cells by calling <code class="docutils literal notranslate"><span class="pre">Transaction.put(...)</span></code> with an empty array, use
<code class="docutils literal notranslate"><span class="pre">Transaction.delete(...)</span></code> instead.</p>
<p><em>Note</em>: Existing cells with empty values will be interpreted as deleted cells, and will not lead to Exceptions when read.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/524">Pull Request</a>)</p>
</td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>The warning emitted when an attempted leadership election fails is now more descriptive.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/630">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Code generation for the <code class="docutils literal notranslate"><span class="pre">hashCode</span></code> of <code class="docutils literal notranslate"><span class="pre">*IdxColumn</span></code> classes now uses <code class="docutils literal notranslate"><span class="pre">deepHashCode</span></code> for its arrays such that it returns
consistent hash codes for use with hash-based collections (HashMap, HashSet, HashTable).
This issue will only appear if you are instantiating columns in multiple places and storing columns in hash collections.</p>
<p>If you are using <a class="reference external" href="https://palantir.github.io/atlasdb/html/schemas/tables_and_indices.html#indices">Indices</a> we recommend you upgrade as a precaution and ensure you are not relying on logic related to the <code class="docutils literal notranslate"><span class="pre">hashCode</span></code> of auto-generated <code class="docutils literal notranslate"><span class="pre">*IdxColumn</span></code> classes.
You will need to regenerate your schema code in order to see this fix.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/600">Pull Request</a>)</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="v0-8-0">
<h2>v0.8.0<a class="headerlink" href="#v0-8-0" title="Permalink to this headline"></a></h2>
<p>5 Jul 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Some logging was missing important information due to use of the wrong substitution placeholder. This version should be taken in preference to 0.7.0 to ensure logging is correct.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/642">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-7-0">
<h2>v0.7.0<a class="headerlink" href="#v0-7-0" title="Permalink to this headline"></a></h2>
<p>4 Jul 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-new">NEW</span></p></td>
<td><p>AtlasDB can now be backed by Postgres via DB KVS. This is a very early release for this feature, so please contact us if you
plan on using it. Please see <a class="reference internal" href="../configuration/key_value_service_configs/postgres_key_value_service_config.html#postgres-configuration"><span class="std std-ref">the documentation</span></a> for more details.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>The In Memory Key Value Service now makes defensive copies of any data stored or retrieved. This may lead to a slight performance degradation to users of In Memory Key Value Service.
In Memory Key Value Service is recommended for testing environments only and production instances should use DB KVS or Cassandra KVS for data that needs to be persisted.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/552">Pull Request</a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>AtlasDB will no longer log incorrect errors stating “Couldn’t grab new token ranges for token aware cassandra mapping” when running against a single node and single token Cassandra cluster.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/634">Pull Request</a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-improved">IMPROVED</span></p></td>
<td><p>Read heavy workflows with Cassandra KVS will now use substantially less heap. In worst-case testing this change resulted in a 10-100x reduction in client side heap size.
However, this is very dependent on the particular scenario AtlasDB is being used in and most consumers should not expect a difference of this size.
(<a class="reference external" href="https://github.com/palantir/atlasdb/pull/568">Pull Request</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-6-0">
<h2>v0.6.0<a class="headerlink" href="#v0-6-0" title="Permalink to this headline"></a></h2>
<p>26 May 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>A potential race condition could cause timestamp allocation to never complete on a particular node (#462).</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>An innocuous error was logged once for each TransactionManager about not being able to allocate enough timestamps.
The error has been downgraded to INFO and made less scary.</p></td>
</tr>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Serializable Transactions that read a column selection could consistently report conflicts when there were none.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>An excessively long Cassandra related logline was sometimes printed (#501).</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-5-0">
<h2>v0.5.0<a class="headerlink" href="#v0-5-0" title="Permalink to this headline"></a></h2>
<p>16 May 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-changed">CHANGED</span></p></td>
<td><p>Only bumping double minor version in artifacts for long-term stability fixes.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v0-4-1">
<h2>v0.4.1<a class="headerlink" href="#v0-4-1" title="Permalink to this headline"></a></h2>
<p>17 May 2016</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Change</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Prevent _metadata tables from triggering the Cassandra 2.x schema mutation bug <a class="reference external" href="https://github.com/palantir/atlasdb/issues/431">431</a> (<a class="reference external" href="https://github.com/palantir/atlasdb/issues/444">444</a> not yet fixed).</p></td>
</tr>
<tr class="row-odd"><td><p><span class="changetype changetype-fixed">FIXED</span></p></td>
<td><p>Required projects are now Java 6 compliant.</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Releases" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="release-process.html" class="btn btn-neutral float-right" title="Release Process" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Palantir Technologies.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>