

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Targeted Sweep &mdash; OSS AtlasDB develop documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/release-notes.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Services" href="../../services/index.html" />
    <link rel="prev" title="Background Sweep Inner Workings and Logs" href="standard/sweep-logs.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> OSS AtlasDB
          

          
          </a>

          
            
            
              <div class="version">
                develop
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../schemas/index.html">Schemas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../transactions/index.html">Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/index.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Cluster Management</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../backup-restore.html">Backup and Restore</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clis.html">Command Line Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../console.html">Console</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../sweep.html">AtlasDB Sweep</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="freeing-space.html">Freeing space after sweep</a></li>
<li class="toctree-l3"><a class="reference internal" href="standard-sweep.html">Standard Sweep</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Targeted Sweep</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../miscellaneous/index.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes/index.html">Releases</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OSS AtlasDB</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Cluster Management</a> &raquo;</li>
        
          <li><a href="../sweep.html">AtlasDB Sweep</a> &raquo;</li>
        
      <li>Targeted Sweep</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/palantir/atlasdb/blob/develop/docs/source/cluster_management/sweep/targeted-sweep.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="targeted-sweep">
<span id="id1"></span><h1>Targeted Sweep<a class="headerlink" href="#targeted-sweep" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Targeted sweep is still under active development and some of its functionality is not implemented yet.
Consult with the AtlasDB team if you wish to use targeted sweep in addition to, or instead of, standard sweep.</p>
</div>
<p>Targeted sweep persists the information about each transactional write as it is performed, and then uses this information to delete all older versions of each of the cells using a single ranged tombstone.</p>
<div class="section" id="persisting-to-the-sweep-queue">
<h2>Persisting to the Sweep Queue<a class="headerlink" href="#persisting-to-the-sweep-queue" title="Permalink to this headline">¶</a></h2>
<p>As long as <code class="docutils literal notranslate"><span class="pre">enableSweepQueueWrites</span></code> is enabled, whenever a transaction is about to commit, the necessary information for deleting stale versions of cells is persisted to the sweep queue.</p>
</div>
<div class="section" id="running-background-targeted-sweep">
<h2>Running Background Targeted Sweep<a class="headerlink" href="#running-background-targeted-sweep" title="Permalink to this headline">¶</a></h2>
<p>Background targeted sweep can be enabled in the live reloadable runtime targeted sweep configuration.
As long as targeted sweep is enabled, background threads will read the information persisted in the sweep queue, and will use ranged tombstones to delete any stale versions of the cells that have been written to.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">While sweep queue writes are disabled, nothing will be persisted to the sweep queue.
This can result in targeted sweep being unable to delete older versions of cells written to while sweep queue writes are disabled even if they are later enabled again.
In this case, running standard sweep may be necessary, to delete any stale versions that targeted sweep has missed.</p>
</div>
</div>
<div class="section" id="configuration-options">
<h2>Configuration Options<a class="headerlink" href="#configuration-options" title="Permalink to this headline">¶</a></h2>
<p>Targeted sweep uses a combination of <a class="reference internal" href="../../configuration/index.html#atlas-config"><span class="std std-ref">install and runtime AtlasDB configurations</span></a>, as follows:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="25%" />
<col width="13%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">AtlasDB Install Config</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">enableSweepQueueWrites</span></code></td>
<td>false</td>
<td>Whether information about writes should be persisted to the sweep queue. If set to false, the targeted sweep runtime configurations will be ignored.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">conservativeThreads</span></code></td>
<td>1</td>
<td>Number of threads to use for targeted sweep of tables with sweep strategy conservative. Maximum supported value is 256.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">thoroughThreads</span></code></td>
<td>1</td>
<td>Number of threads to use for targeted sweep of tables with sweep strategy thorough. Maximum supported value is 256.</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="25%" />
<col width="13%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">AtlasDB Runtime Config</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">enabled</span></code></td>
<td>false</td>
<td>Whether targeted sweep should be run by background threads. Note that enableSweepQueueWrites must be set to true before targeted sweep can be run.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">shards</span></code></td>
<td>1</td>
<td>Number of shards to use for persisting information to the sweep queue, enabling better parallelization of targeted sweep. The number of shards should be greater than or equal to the number of threads used for background targeted sweep. Note that this number must be monotonically increasing, and attempts to lower may be ignored. Maximum supported value is 256.</td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../services/index.html" class="btn btn-neutral float-right" title="Services" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="standard/sweep-logs.html" class="btn btn-neutral" title="Background Sweep Inner Workings and Logs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Palantir Technologies.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'develop',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>