<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asynchronous Initialization &mdash; OSS AtlasDB develop documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/release-notes.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Contributing to AtlasDB" href="contributing.html" />
    <link rel="prev" title="Miscellaneous" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> OSS AtlasDB
          </a>
              <div class="version">
                develop
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schemas/index.html">Schemas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transactions/index.html">Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster_management/index.html">Cluster Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/index.html">Performance Testing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Miscellaneous</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Asynchronous Initialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contributing to AtlasDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc/adr/index.html">Architecture Decision Records</a></li>
<li class="toctree-l2"><a class="reference internal" href="kvs-status-check.html">KeyValueService Status</a></li>
<li class="toctree-l2"><a class="reference internal" href="dropwizard-metrics.html">AtlasDB Metrics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes/index.html">Releases</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OSS AtlasDB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Miscellaneous</a> &raquo;</li>
      <li>Asynchronous Initialization</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/palantir/atlasdb/blob/develop/docs/source/miscellaneous/asynchronous-initialization.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="asynchronous-initialization">
<h1>Asynchronous Initialization<a class="headerlink" href="#asynchronous-initialization" title="Permalink to this headline"></a></h1>
<p>If the <code class="docutils literal notranslate"><span class="pre">initializeAsync</span></code> parameter of the AtlasDB configuration is set to true, AtlasDB will be able to start even when some of
the necessary resources are not ready yet. The main use of this feature is to avoid race conditions when starting multiple
services simultaneously and allow AtlasDB to start even if, e.g., the KVS is still starting up.</p>
<p>To simplify initialization of objects depending on a transaction manager that may be asynchronously initialized,
<code class="docutils literal notranslate"><span class="pre">TransactionManagers</span></code> has an <code class="docutils literal notranslate"><span class="pre">asyncInitializationCallback()</span></code> parameter allowing users to specify a custom callback
that should be executed when ready.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">initializeAsync</span></code> is set to false, the callback will be run synchronously (blocking until it is done) as the last step in creating the transaction manager.
If <code class="docutils literal notranslate"><span class="pre">initializeAsync</span></code> is set to true, the callback will also be run asynchronously:</p>
<ol class="arabic simple">
<li><p>Once all the resources for the transaction manager have become ready, <strong>but before the transaction manager becomes initialized</strong>, the registered callback will be run asynchronously.
Note that calls to the transaction manager from the callback at this time bypass the initialization checks.</p></li>
<li><p>If the callback fails and should not be retried, the transaction manager will be closed.</p></li>
<li><p>If the callback is successful, the transaction manager then becomes initialized.</p></li>
</ol>
<section id="using-callbacks">
<h2>Using Callbacks<a class="headerlink" href="#using-callbacks" title="Permalink to this headline"></a></h2>
<p>For an example of using callbacks, refer to <code class="docutils literal notranslate"><span class="pre">TargetedSweeper</span></code>. The simplest way of using this functionality is to
implement the <code class="docutils literal notranslate"><span class="pre">CallbackInitializable</span></code> interface. The <code class="docutils literal notranslate"><span class="pre">initialize</span></code> method should initialize all the
resources that require an initialized transaction manager, and the <code class="docutils literal notranslate"><span class="pre">onInitializationFailureCleanup</span></code> should specify any
cleanup to be done in case of failure, if necessary. The callback that should be passed to the <cite>TransactionManagers</cite>
builder is then given by the interface:</p>
<ol class="arabic simple">
<li><p>If initialization should not be retried on failure use <code class="docutils literal notranslate"><span class="pre">singleAttemptCallback()</span></code>.</p></li>
<li><p>If initialization should be retried on failure use <code class="docutils literal notranslate"><span class="pre">retryUnlessCleanupThrowsCallback()</span></code>.</p></li>
<li><p>If initialization should be conditionally retried on failure also use <code class="docutils literal notranslate"><span class="pre">retryUnlessCleanupThrowsCallback()</span></code>, but the <code class="docutils literal notranslate"><span class="pre">onInitializationFailureCleanup</span></code> method should throw when the condition is not satisfied.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Miscellaneous" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="contributing.html" class="btn btn-neutral float-right" title="Contributing to AtlasDB" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Palantir Technologies.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>