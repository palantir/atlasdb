

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Cassandra Best Practices &mdash; OSS AtlasDB develop documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/release-notes.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Dynamic Columns" href="dynamic_columns.html" />
    <link rel="prev" title="Tables and Indices" href="tables_and_indices.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> OSS AtlasDB
          

          
          </a>

          
            
            
              <div class="version">
                develop
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Schemas</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="tables_and_indices.html">Tables and Indices</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Cassandra Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamic_columns.html">Dynamic Columns</a></li>
<li class="toctree-l2"><a class="reference internal" href="streams.html">Streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="cleanup_tasks.html">Cleanup Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="physical_cleanup.html">Physical Cleanup</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating_schemas.html">Schema Migrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="oracle_table_mapping.html">Oracle Table Mapping</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../transactions/index.html">Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster_management/index.html">Cluster Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miscellaneous/index.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes/index.html">Releases</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OSS AtlasDB</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Schemas</a> &raquo;</li>
        
      <li>Cassandra Best Practices</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/palantir/atlasdb/blob/develop/docs/source/schemas/best_practices.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="cassandra-best-practices">
<h1>Cassandra Best Practices<a class="headerlink" href="#cassandra-best-practices" title="Permalink to this headline">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This section is intended to provide guidelines for maintaining good performance for atlasdb queries when using Cassandra as a backing store.</p>
<p>The advice here is meant to serve as a safeguard against using atlas in ways that are known to cause performance issues, but it is not all encompassing. In general, you can feel safe if you follow the guidelines below; however, if you need to bend any of these rules, you should make sure that you understand why it’s ok to do so.</p>
</section>
<section id="range-scans">
<h2>Range Scans<a class="headerlink" href="#range-scans" title="Permalink to this headline">¶</a></h2>
<p><strong>Range Scans vs Exact Key Lookups</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>Prefer exact key lookups over range scans</dt><dd><ul>
<li><p>The performance of exact key lookups do not degrade with frequent updates to the key</p></li>
<li><p>Exact key lookups will never fetch more data than you expect</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Row vs Dynamic Column Range Scans</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>Prefer dynamic column range scans</dt><dd><ul>
<li><p>Range scanning over dynamic columns within a row can be 2 or more times faster than range scanning across rows</p></li>
<li><p>Dynamic column scans are more efficient, and Cassandra is optimized for them</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>However, when used properly, row-based range scans can still provide acceptable performance.</p></li>
</ul>
<p><strong>Range Scan Caveats</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>Avoid range scanning across rows or dynamic columns where data is updated / overwritten / deleted</dt><dd><ul>
<li><p>Range scans will fetch all historical versions of every cell. This means that range scan performance degrades linearly with the number of updates to cells in the range</p></li>
<li><p>The impact of overwrites can be alleviated over time by background sweep, but in general, you should design your schema in such a way that your queries do not rely on sweep to maintain good performance</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>You can improve the performance of range scans by requesting a single column</dt><dd><ul>
<li><p>As of AtlasDB v0.62.0, we only request the latest version of the specific column requested, if only one column is requested. Previous behaviour was consistent with the item below.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Do not attempt to “filter” row keys by selecting multiple columns in your range scan</dt><dd><ul>
<li><p>Atlas will retrieve all column values for every row returned in a range scan, regardless of which columns are requested.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Consider the impact on data distribution when designing a table for range scans</dt><dd><ul>
<li><p>Range scans inherently lead to hotspotting, because keys that are close to one another in a range will end up on the same Cassandra node.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>When using dynamic columns for range scans, do not allow the total size of your row to grow above ~100MB.</dt><dd><ul>
<li><p>Large rows reduce performance of compactions and create heap pressure in Cassandra</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="stream-stores">
<h2>Stream Stores<a class="headerlink" href="#stream-stores" title="Permalink to this headline">¶</a></h2>
<p>The use of <code class="docutils literal notranslate"><span class="pre">hashRowComponents</span></code> for stream stores is strongly recommended as this avoids hotspotting.
This is because the row key of a stream store value table is an ordered pair (stream ID, block ID).
Hashing the first row component is not enough, because it still means that every block of the same stream will (likely)
be stored on the same token range, and so loading the stream may heavily load the nodes responsible for that range.</p>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="dynamic_columns.html" class="btn btn-neutral float-right" title="Dynamic Columns" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="tables_and_indices.html" class="btn btn-neutral float-left" title="Tables and Indices" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017, Palantir Technologies.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>