

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Schemas &mdash; AtlasDB 0.3.34 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/release-notes.css" type="text/css" />
  

  
    <link rel="top" title="AtlasDB 0.3.34 documentation" href="../index.html"/>
        <link rel="next" title="Tables and Indices" href="tables_and_indices.html"/>
        <link rel="prev" title="Getting Started" href="../overview/getting_started.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> AtlasDB
          

          
          </a>

          
            
            
              <div class="version">
                0.3.34
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Schemas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tables_and_indices.html">Tables and Indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="streams.html">Streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="cleanup_tasks.html">Cleanup Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="physical_cleanup.html">Physical Cleanup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../transactions/index.html">Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster_management/index.html">Cluster Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miscellaneous/index.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes/index.html">Releases</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">AtlasDB</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Schemas</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/palantir/atlasdb/blob/develop/docs/source/schemas/index.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="schemas">
<h1>Schemas<a class="headerlink" href="#schemas" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="tables_and_indices.html">Tables and Indices</a></li>
<li class="toctree-l1"><a class="reference internal" href="streams.html">Streams</a></li>
<li class="toctree-l1"><a class="reference internal" href="cleanup_tasks.html">Cleanup Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="physical_cleanup.html">Physical Cleanup</a></li>
</ul>
</div>
<div class="section" id="what-to-expect">
<h2>What to Expect<a class="headerlink" href="#what-to-expect" title="Permalink to this headline">¶</a></h2>
<p>This guide should give you the basics on:</p>
<ol class="arabic simple">
<li>How an atlasdb schema file is organized.</li>
<li>What commands are available.</li>
<li>When they can be used and what they do.</li>
<li>How they translate to the underlying database.</li>
</ol>
</div>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>Data in AtlasDB is stored as a series of key-value pairs, structured
into tables, grouped into namespaces. An atlasdb <strong>schema</strong> defines a
set of named tables, and for each <strong>table</strong> defines the key-value pairs
which can be stored, the kind of operations which can be performed, and
any relations between tables which should be maintained. A <strong>namespace</strong>
is a named instantiation of a schema in the database. A table whose data
is explicitly derived from another table in the schema is called an
<strong>index</strong>. Indexes defined in a schema can have some of the
synchronization between the parent table and the index managed
automatically.</p>
<p>Each key-value pair in a table is actually specified by a triple: a
<strong>row</strong> part (potentially made up of several components), a <strong>column</strong>
part (potentially made up of several components), and a <strong>value</strong> part
which together form the value. The row and column together make up a
<strong>cell</strong>, which is always associated with a single value, i.e, within a
table, a cell forms a primary key. Puts and Gets on the table are done
in terms of cells; a Put of an existing cell overwrites the existing
cell and can be thought of as an update to that cell. A table is said to
contain a given row if there is at least one cell with the given row.</p>
<p>The definition of a key-value pair as a row-column-value triplet allows
for two different kinds of column layouts for a table, called &#8220;named&#8221;
columns and &#8220;dynamic&#8221; columns. In a <strong>named column</strong> layout, the columns
come from a pre-defined set of string labels, and the type of the value
can vary based on the column. In a <strong>dynamic column</strong> layout, the (sole)
column type is a tuple of values with pre-defined types. Every value in
a table with dynamic columns has the same type. One way to compare the
two layouts is that the named layout is akin to a SQL table with
primary-key and multiple columns, while the dynamic layout is akin to a
one-key-to-many-rows SQL map. Another way to compare the two layouts is
that both layout have defined rows and columns, but the named column
layout allows a row to have a subset of the named columns, whereas the
dynamic layout allows a row to have more than one full column set.</p>
<p>There are four main operations which can be conducted against an atlasdb
table: get, getRange, put, and delete. The <strong>get</strong> operation retrieves
all cell-value pairs with the specified row values. The <strong>getRange</strong>
operation retrieves all cell-value pairs whose row values either fall
between two specified rows or begin with the specified prefix. The
<strong>put</strong> operation adds or overrides cells with new values as specified
by the operation arguments, updating any indexes needed. The <strong>delete</strong>
operation removes the specified cell-value pairs from the table.</p>
</div>
<div class="section" id="sample-schema-file">
<h2>Sample Schema File<a class="headerlink" href="#sample-schema-file" title="Permalink to this headline">¶</a></h2>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">BlankSchema</span> <span class="p">{</span>
    <span class="n">private</span> <span class="n">BlankSchema</span><span class="p">()</span> <span class="p">{</span>
        <span class="o">//</span><span class="n">private</span>
    <span class="p">}</span>

    <span class="n">private</span> <span class="n">static</span> <span class="n">final</span> <span class="n">Schema</span> <span class="n">SCHEMA</span> <span class="o">=</span> <span class="n">generateSchema</span><span class="p">();</span>

    <span class="n">private</span> <span class="n">static</span> <span class="n">Schema</span> <span class="n">generateSchema</span><span class="p">()</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">Define</span> <span class="n">the</span> <span class="n">prefix</span> <span class="ow">and</span> <span class="n">package</span> <span class="k">for</span> <span class="n">generated</span> <span class="n">code</span>
        <span class="n">Schema</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">(</span><span class="s2">&quot;BlankSchema&quot;</span><span class="p">,</span> <span class="s2">&quot;com.palantir.atlasdb.blankschema&quot;</span><span class="p">);</span>

        <span class="o">/*</span> <span class="n">Schema</span> <span class="n">definition</span> <span class="n">start</span> <span class="o">*/</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">addTableDefinition</span><span class="p">(</span><span class="s2">&quot;TableName&quot;</span><span class="p">,</span> <span class="n">new</span> <span class="n">TableDefinition</span><span class="p">()</span> <span class="p">{{</span>
            <span class="o">...</span>
        <span class="p">}});</span>

        <span class="n">schema</span><span class="o">.</span><span class="n">addIndexDefinition</span><span class="p">(</span><span class="s2">&quot;IndexName&quot;</span><span class="p">,</span> <span class="n">new</span> <span class="n">IndexDefinition</span><span class="p">()</span> <span class="p">{{</span>
            <span class="o">..</span>
        <span class="p">}});</span>
        <span class="o">/*</span> <span class="n">Schema</span> <span class="n">definition</span> <span class="n">end</span> <span class="o">*/</span>

        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span> <span class="o">//</span> <span class="n">ensure</span> <span class="n">that</span> <span class="n">the</span> <span class="n">schema</span> <span class="k">as</span> <span class="n">constructed</span> <span class="ow">is</span> <span class="n">valid</span><span class="o">.</span>
        <span class="k">return</span> <span class="n">schema</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span> <span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">generate</span> <span class="n">the</span> <span class="n">java</span> <span class="n">classes</span><span class="p">,</span> <span class="ow">and</span> <span class="n">write</span> <span class="n">them</span> <span class="n">to</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">source</span> <span class="n">folder</span><span class="o">.</span>
        <span class="n">SCHEMA</span><span class="o">.</span><span class="n">renderTablesWithNamespace</span><span class="p">(</span><span class="n">new</span> <span class="n">File</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">),</span> <span class="n">Namespace</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;pt_met&quot;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Contrary to the standard SQL format, an atlasdb schema is written in
java, in a java class, as a sequence of calls to a schema builder and
anonymous inner classes. The java class is then run, which generates
java classes for creating, accessing, and manipulating these tables.</p>
<div class="section" id="value-types">
<h3>Value Types<a class="headerlink" href="#value-types" title="Permalink to this headline">¶</a></h3>
<p>AtlasDB understands three kinds of data: primitive ValueTypes, protocol
buffer GeneratedMessages, and palantir Persistables.</p>
<div class="section" id="primitive-valuetypes">
<h4>Primitive ValueTypes<a class="headerlink" href="#primitive-valuetypes" title="Permalink to this headline">¶</a></h4>
<p>For simple data types, atlasdb represents them by ValueType. Note that a
java primitive type can have multiple ValueTypes associated with it.
Each ValueType represents a different method of storing that type in the
database, and thus affects storage efficiency and search
characteristics, among others. The types are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="14%" />
<col width="15%" />
<col width="22%" />
<col width="16%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Java Type</th>
<th class="head">Format</th>
<th class="head">Anywhere in table?</th>
<th class="head">Range Scans?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>FIXED_LONG</td>
<td>long</td>
<td>byte[8]</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-odd"><td>FIXED_LONG_LITTLE_ENDIAN</td>
<td>long</td>
<td>byte[8]</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-even"><td>NULLABLE_FIXED_LONG</td>
<td>long</td>
<td>byte[9]</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-odd"><td>VAR_LONG</td>
<td>long</td>
<td>byte[len]*</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-even"><td>VAR_SIGNED_LONG</td>
<td>long</td>
<td>byte[len*]</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-odd"><td>SHA_256_HASH</td>
<td>Sha256Hash</td>
<td>byte[32]</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-even"><td>STRING</td>
<td>String</td>
<td>byte[]</td>
<td>NO**</td>
<td>YES</td>
</tr>
<tr class="row-odd"><td>VAR_STRING</td>
<td>String</td>
<td>byte[len]</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-even"><td>BLOB</td>
<td>byte[]</td>
<td>byte[]</td>
<td>NO**</td>
<td>YES</td>
</tr>
<tr class="row-odd"><td>SIZED_BLOB</td>
<td>byte[]</td>
<td>byte[len]</td>
<td>YES</td>
<td>NO</td>
</tr>
</tbody>
</table>
<p>note: * var long: the smaller the value, the fewer bytes used. For
signed, the closer to zero, the fewer bytes used. negative values for
VAR_LONG are always 10 bytes. 0 to 127 are 1 byte for VAR_LONG. -64 to
63 are 1 byte or SIGNED_VAR_LONG</p>
<p>note: ** can only be a row or column component if it is the last
component of the component list.</p>
<p>Note that all long data types are signed, but VAR_SIGNED_LONG is
encoded in a manner which stores negative numbers more efficiently than
VAR_LONG. (The latter will always use 10 bytes to encode negative
values, but the former will not.)</p>
</div>
<div class="section" id="protobufs-and-persistables">
<h4>Protobufs and Persistables<a class="headerlink" href="#protobufs-and-persistables" title="Permalink to this headline">¶</a></h4>
<p>For protobufs and persistables, atlasdb will handle persisting and
hydrating objects to and from byte arrays. Otherwise, they function
similarly to ValueType.BLOB. However, for structured data it is
recommended that you store them as protobufs or persistables rather than
BLOBs - this is because atlasdb can then extract component values from
the structs to create indexes.</p>
</div>
</div>
<div class="section" id="schema-objects">
<h3>Schema Objects<a class="headerlink" href="#schema-objects" title="Permalink to this headline">¶</a></h3>
<p>The atlasdb schema contains four kinds of top level objects - tables,
indexes, stream stores, and cleanup tasks.</p>
<ul class="simple">
<li><strong>Tables</strong> are the base structure for storing information in atlasdb.
Similar to SQL tables in idea, with base layout described in the
section above.</li>
<li><strong>Indexes</strong> are tables which explicitly base their content off of a
parent table. They are useful for optimizing access patterns on a
table.</li>
<li><strong>Stream Stores</strong> store large/oversized binary data. They are similar
to SQL overflow/LOB stores.</li>
<li><strong>Cleanup Tasks</strong> are useful for cleaning up tables when the data
they reference is deleted. Similar to ON DELETE CASCADE in SQL.</li>
</ul>
<p>In this section, we&#8217;ll give you a overview of what each object does and
how to add it to a schema. Stream stores and CleanupTasks will have all
definitions explained in detail, but table/index definition will be
covered in the following section (Table/Index Definition) as it&#8217;s a much
more complicated monster.</p>
<p>NOTE: AtlasDB does not try to fully replicate a SQL language - many of
the high-level constructs (cascades, joins, etc.) are not implemented.
This is because we practically don&#8217;t have the time to replicate every
conceivable feature and philosophically want to be more explicit with
our performance than with SQL queries. Things will not map 1:1 with SQL.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tables_and_indices.html" class="btn btn-neutral float-right" title="Tables and Indices" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../overview/getting_started.html" class="btn btn-neutral" title="Getting Started" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Palantir Technologies.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.3.34',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>