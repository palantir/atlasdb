types:
  imports:
    LeaderTime:
      base-type: any
      external:
        java: com.palantir.lock.v2.LeaderTime
    NanoTime:
      base-type: safelong
      external:
        java: com.palantir.common.time.NanoTime
    PartitionedTimestamps:
      base-type: any
      external:
        java: com.palantir.lock.v2.PartitionedTimestamps
    LockImmutableTimestampResponse:
      base-type: any
      external:
        java: com.palantir.lock.v2.LockImmutableTimestampResponse
    Lease:
      base-type: any
      external:
        java: com.palantir.lock.v2.Lease
    CommitTimestampsWithWatches:
      base-type: any
      external:
        java: com.palantir.lock.watch.CommitTimestampsWithWatches
    Long:
      base-type: any
      external:
        java: java.lang.Long
  definitions:
    default-package: com.palantir.atlasdb.timelock.api
    objects:
      ConjureStartTransactionsRequest:
        fields:
          requestId: uuid
          requestorId: uuid
          numTransactions: integer
      ConjureStartTransactionsResponse:
        fields:
          immutableTimestamp: LockImmutableTimestampResponse
          timestamps: PartitionedTimestamps
          lease: Lease
      GetCommitTimestampsRequest:
        fields:
          numTimestamps: integer
          lastKnownVersion: optional<Long>

services:
  ConjureTimelockService:
    name: Timelock service
    default-auth: header
    package: com.palantir.atlasdb.timelock.api
    base-path: /tl
    endpoints:
      startTransactions:
        http: POST /st/{namespace}
        args:
          namespace: string
          request: ConjureStartTransactionsRequest
        returns: ConjureStartTransactionsResponse
      leaderTime:
        http: POST /lt/{namespace}
        args:
          namespace: string
        returns: LeaderTime
      getCommitTimestamps:
        http: POST /gct/{namespace}
        args:
          namespace: string
          request: GetCommitTimestampsRequest
        returns: CommitTimestampsWithWatches
        docs: |
          Batched endpoint for acquiring commit timestamps (a list of fresh timestamps) and the list of all lock watch
          events since the last known version up to after the commit timestamps have been issued.